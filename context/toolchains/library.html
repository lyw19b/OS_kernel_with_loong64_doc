<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2.6. 一些常用的库函数 &mdash; 龙芯实验室文档 V1.0 文档</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=b01b2dd9" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />

  
    <link rel="shortcut icon" href="../../_static/favicon.jpg"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=3f0bcac8"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script src="../../_static/translations.js?v=beaddf03"></script>
        <script src="../../_static/design-tabs.js?v=f930bc37"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="3. 特权态指令" href="../privilege_isa/index.html" />
    <link rel="prev" title="2.5. 汇编代码与链接脚本" href="assembly.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <img src="../../_static/logo.svg" class="logo" alt="Logo"/>
          <a href="../../index.html" class="icon icon-home">
            龙芯实验室文档
          </a>
              <div class="version">
                V1.0
              </div>
<div role="search">
  <form id="evas-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../preparation/index.html">1. 准备工作</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../preparation/preface.html">1.1. 前言</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../preparation/preface.html#id2">1.1.1. 更新说明</a></li>
<li class="toctree-l3"><a class="reference internal" href="../preparation/preface.html#id3">1.1.2. 仓库地址</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../preparation/tools.html">1.2. 工具链说明</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../preparation/tools.html#gcc">1.2.1. GCC</a></li>
<li class="toctree-l3"><a class="reference internal" href="../preparation/tools.html#llvm">1.2.2. LLVM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../preparation/tools.html#rust">1.2.3. Rust</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../preparation/tools.html#id2">1.3. 模拟器</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../preparation/tools.html#qemu">1.3.1. QEMU</a></li>
<li class="toctree-l3"><a class="reference internal" href="../preparation/tools.html#la-emu">1.3.2. LA_EMU</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../preparation/tools.html#id3">1.4. 操作系统编译</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../preparation/tools.html#loongnix">1.4.1. LoongNix</a></li>
<li class="toctree-l3"><a class="reference internal" href="../preparation/tools.html#uos">1.4.2. UOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../preparation/tools.html#deepin">1.4.3. Deepin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../preparation/tools.html#aosc">1.4.4. AOSC(安同)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../preparation/tools.html#linux-kernel">1.4.5. Linux kernel</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">2. 工具链</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="gcc.html">2.1. GCC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="gcc.html#id1">2.1.1. GCC的相关概念</a><ul>
<li class="toctree-l4"><a class="reference internal" href="gcc.html#id2">2.1.1.1. GCC的基本定义与起源</a></li>
<li class="toctree-l4"><a class="reference internal" href="gcc.html#id4">2.1.1.2. GCC支持的语言与平台</a></li>
<li class="toctree-l4"><a class="reference internal" href="gcc.html#id5">2.1.1.3. GCC的核心功能与特点</a></li>
<li class="toctree-l4"><a class="reference internal" href="gcc.html#id6">2.1.1.4. GCC的最新进展</a></li>
<li class="toctree-l4"><a class="reference internal" href="gcc.html#id7">2.1.1.5. GCC的应用场景</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="gcc.html#id8">2.1.2. 交叉编译器</a></li>
<li class="toctree-l3"><a class="reference internal" href="gcc.html#id9">2.1.3. 常见的类别组合</a></li>
<li class="toctree-l3"><a class="reference internal" href="gcc.html#id12">2.1.4. 如何编译交叉编译器</a><ul>
<li class="toctree-l4"><a class="reference internal" href="gcc.html#loongarch64-linux-gnu-sf">2.1.4.1. 如何编译loongarch64-linux-gnu[sf]</a></li>
<li class="toctree-l4"><a class="reference internal" href="gcc.html#loongarch64-linux-musl-sf">2.1.4.2. 如何编译loongarch64-linux-musl[sf]</a></li>
<li class="toctree-l4"><a class="reference internal" href="gcc.html#crtn-crti-crtbegin-crtend">2.1.4.3. crtn, crti, crtbegin, crtend有什么区别</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="gcc.html#id22">2.1.5. 常用的参数与选项</a><ul>
<li class="toctree-l4"><a class="reference internal" href="gcc.html#id23">2.1.5.1. GCC常见的参数</a></li>
<li class="toctree-l4"><a class="reference internal" href="gcc.html#picpie">2.1.5.2. PIC与PIE的区别是什么</a></li>
<li class="toctree-l4"><a class="reference internal" href="gcc.html#loongarch">2.1.5.3. 与LoongArch相关的选项说明</a></li>
<li class="toctree-l4"><a class="reference internal" href="gcc.html#c-c">2.1.5.4. C/C++ 预处理器内嵌的宏定义</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="binutils.html">2.2. Binutils</a><ul>
<li class="toctree-l3"><a class="reference internal" href="binutils.html#gnu-binutils">2.2.1. GNU Binutils的相关说明</a><ul>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id1">2.2.1.1. <strong>核心定位与背景</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id2">2.2.1.2. <strong>重要组成部分与功能</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id5">2.2.1.3. <strong>应用场景</strong></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="binutils.html#ld">2.2.2. ld链接器</a><ul>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id6">2.2.2.1. LD的参数说明</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="binutils.html#readelf">2.2.3. 如何正确的使用readelf</a><ul>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id7">2.2.3.1. 基础用法与核心选项</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id11">2.2.3.2. 二、高级用法</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id14">2.2.3.3. 三、实战示例</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id18">2.2.3.4. 四、与其他工具对比</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="binutils.html#objdump">2.2.4. objdump</a><ul>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id19">2.2.4.1. 一、基础用法与核心选项</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id25">2.2.4.2. 二、高级用法</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id31">2.2.4.3. 三、典型应用场景</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id36">2.2.4.4. 四、与其他工具对比</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id37">2.2.4.5. 五、注意事项</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id38">2.2.4.6. 六、实战示例</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="binutils.html#objcopy">2.2.5. objcopy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id42">2.2.5.1. 一、基础用法与核心选项</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id46">2.2.5.2. 二、高级功能</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id51">2.2.5.3. 三、参数详解</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id52">2.2.5.4. 四、典型应用场景</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id56">2.2.5.5. 五、常见问题与解决</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id60">2.2.5.6. 六、与其他工具对比</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id61">2.2.5.7. 七、总结</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="rust.html">2.3. Rust</a><ul>
<li class="toctree-l3"><a class="reference internal" href="rust.html#id1">2.3.1. Rust的概念</a><ul>
<li class="toctree-l4"><a class="reference internal" href="rust.html#id2">2.3.1.1. Rust的起源与发展</a></li>
<li class="toctree-l4"><a class="reference internal" href="rust.html#id3">2.3.1.2. Rust的核心特性</a></li>
<li class="toctree-l4"><a class="reference internal" href="rust.html#id4">2.3.1.3. Rust的应用场景</a></li>
<li class="toctree-l4"><a class="reference internal" href="rust.html#id5">2.3.1.4. Rust的最新进展</a></li>
<li class="toctree-l4"><a class="reference internal" href="rust.html#id6">2.3.1.5. Rust的优缺点</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rust.html#loongarchtarget">2.3.2. LoongArch支持的target有哪些</a></li>
<li class="toctree-l3"><a class="reference internal" href="rust.html#loongarch">2.3.3. 与LoongArch相关的具体参数那些</a></li>
<li class="toctree-l3"><a class="reference internal" href="rust.html#laexe">2.3.4. 简单的例子说明如何编译成LA架构的EXE文件</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="builtin.html">2.4. 内嵌的函数与指令包装</a><ul>
<li class="toctree-l3"><a class="reference internal" href="builtin.html#gcc">2.4.1. GCC</a></li>
<li class="toctree-l3"><a class="reference internal" href="builtin.html#llvm">2.4.2. LLVM</a></li>
<li class="toctree-l3"><a class="reference internal" href="builtin.html#rust">2.4.3. Rust</a><ul>
<li class="toctree-l4"><a class="reference internal" href="builtin.html#loongarch">2.4.3.1. LoongArch包的相关内容</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="assembly.html">2.5. 汇编代码与链接脚本</a><ul>
<li class="toctree-l3"><a class="reference internal" href="assembly.html#loongarch">2.5.1. 与LoongArch相关的汇编指令</a><ul>
<li class="toctree-l4"><a class="reference internal" href="assembly.html#id2">2.5.1.1. 伪汇编指令</a></li>
<li class="toctree-l4"><a class="reference internal" href="assembly.html#id3">2.5.1.2. 地址加载指令</a></li>
<li class="toctree-l4"><a class="reference internal" href="assembly.html#id4">2.5.1.3. 内嵌汇编</a></li>
<li class="toctree-l4"><a class="reference internal" href="assembly.html#id5">2.5.1.4. 参考阅读</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="assembly.html#id6">2.5.2. 链接脚本</a><ul>
<li class="toctree-l4"><a class="reference internal" href="assembly.html#id7">2.5.2.1. 一、基础语法结构</a></li>
<li class="toctree-l4"><a class="reference internal" href="assembly.html#id8">2.5.2.2. 二、核心命令与操作</a></li>
<li class="toctree-l4"><a class="reference internal" href="assembly.html#id13">2.5.2.3. 三、高级功能</a></li>
<li class="toctree-l4"><a class="reference internal" href="assembly.html#id17">2.5.2.4. 四、典型应用场景</a></li>
<li class="toctree-l4"><a class="reference internal" href="assembly.html#id21">2.5.2.5. 五、实战示例</a></li>
<li class="toctree-l4"><a class="reference internal" href="assembly.html#id24">2.5.2.6. 六、调试与验证</a></li>
<li class="toctree-l4"><a class="reference internal" href="assembly.html#id25">2.5.2.7. 七、总结</a></li>
<li class="toctree-l4"><a class="reference internal" href="assembly.html#id26">2.5.2.8. 以LoongArch为例说明链接脚本</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">2.6. 一些常用的库函数</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#glibc">2.6.1. GLIBC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">2.6.1.1. 一、核心功能与作用</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">2.6.1.2. 二、架构与实现细节</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">2.6.1.3. 三、版本演进与升级风险</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">2.6.1.4. 四、与其他运行库的对比</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">2.6.1.5. 五、开发与调试工具</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#musl">2.6.2. MUSL</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#musl-c">2.6.2.1. Musl C 库详解</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id15">2.6.2.2. 总结</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#memcpy">2.6.3. memcpy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#memmove">2.6.4. memmove</a></li>
<li class="toctree-l3"><a class="reference internal" href="#memset">2.6.5. memset</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../privilege_isa/index.html">3. 特权态指令</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../privilege_isa/csr.html">3.1. CSR寄存器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../privilege_isa/csr.html#id1">3.2. CSR指令</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../privilege_isa/csr.html#csrrd">3.2.1. CSRRD指令</a></li>
<li class="toctree-l3"><a class="reference internal" href="../privilege_isa/csr.html#csrwr">3.2.2. CSRWR指令</a></li>
<li class="toctree-l3"><a class="reference internal" href="../privilege_isa/csr.html#csrxchg">3.2.3. CSRXCHG指令</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../privilege_isa/csr.html#iocsr">3.3. IOCSR指令</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../privilege_isa/csr.html#iocsrrd">3.3.1. IOCSRRD指令</a></li>
<li class="toctree-l3"><a class="reference internal" href="../privilege_isa/csr.html#iocsrwr">3.3.2. IOCSRWR指令</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../privilege_isa/cacop_insn.html">3.4. CPUCFG 指令</a></li>
<li class="toctree-l2"><a class="reference internal" href="../privilege_isa/cacop_insn.html#cacop">3.5. CACOP 指令</a></li>
<li class="toctree-l2"><a class="reference internal" href="../privilege_isa/tlb_insn.html">3.6. TLB 与页表指令</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../privilege_isa/tlb_insn.html#id1">3.6.1. TLB 相关指令</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../privilege_isa/tlb_insn.html#tlbsrch">3.6.1.1. TLBSRCH</a></li>
<li class="toctree-l4"><a class="reference internal" href="../privilege_isa/tlb_insn.html#tlbrd">3.6.1.2. TLBRD</a></li>
<li class="toctree-l4"><a class="reference internal" href="../privilege_isa/tlb_insn.html#tlbwr">3.6.1.3. TLBWR</a></li>
<li class="toctree-l4"><a class="reference internal" href="../privilege_isa/tlb_insn.html#tlbfill">3.6.1.4. TLBFILL</a></li>
<li class="toctree-l4"><a class="reference internal" href="../privilege_isa/tlb_insn.html#tlbclr">3.6.1.5. TLBCLR</a></li>
<li class="toctree-l4"><a class="reference internal" href="../privilege_isa/tlb_insn.html#tlbflush">3.6.1.6. TLBFLUSH</a></li>
<li class="toctree-l4"><a class="reference internal" href="../privilege_isa/tlb_insn.html#invtlb">3.6.1.7. INVTLB</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../privilege_isa/tlb_insn.html#id2">3.6.2. 页表查找指令</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../privilege_isa/tlb_insn.html#lddir">3.6.2.1. LDDIR</a></li>
<li class="toctree-l4"><a class="reference internal" href="../privilege_isa/tlb_insn.html#ldpte">3.6.2.2. LDPTE</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../privilege_isa/tlb_insn.html#id3">3.6.3. 应用示例</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../privilege_isa/misc_insn.html">3.7. ERTN指令</a></li>
<li class="toctree-l2"><a class="reference internal" href="../privilege_isa/misc_insn.html#idle">3.8. IDLE指令</a></li>
<li class="toctree-l2"><a class="reference internal" href="../privilege_isa/misc_insn.html#syscall">3.9. SysCALL指令</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../mmu/index.html">4. 内存管理</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../mmu/tlb_struct.html">4.1. LoongArch的地址管理</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_struct.html#id2">4.1.1. 直接地址翻译模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_struct.html#id3">4.1.2. 映射地址翻译模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_struct.html#id4">4.1.3. 存储访问的类型</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../mmu/tlb_struct.html#loongarchtlb">4.2. LoongArch的TLB结构</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_struct.html#id5">4.2.1. 逻辑组织结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_struct.html#tlb-cpu">4.2.2. TLB的表项（以CPU的视觉）</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../mmu/tlb_struct.html#tlb">4.3. TLB的管理</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_struct.html#id6">4.3.1. TLB的一些概念区分</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_struct.html#id7">4.3.2. TLB相关的指令</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_struct.html#tlbcsr">4.3.3. TLB相关的CSR</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_struct.html#tlb-excption-handle">4.3.4. TLB相关的例外</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_struct.html#cputlb">4.3.5. CPU内部TLB查找流程示例</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../mmu/dmw.html">4.4. 直接映射翻译模式</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../mmu/dmw.html#csr-dmw-0-3">4.4.1. CSR.DMW[0-3]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/dmw.html#id2">4.4.2. 操作系统中如何使用</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../mmu/dmw.html#dmw">4.4.2.1. DMW的优点</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/dmw.html#id3">4.4.2.2. DMW的缺点</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/dmw.html#id4">4.4.2.3. 代码示例如何在内核中使用</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../mmu/tlb_ptw.html">4.5. 多级页表结构</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_ptw.html#id2">4.5.1. 设计背景与必要性</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id3">4.5.1.1. 多级页表的结构与层级</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id4">4.5.1.2. 地址转换流程</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id5">4.5.1.3. 多级页表的优势</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id6">4.5.1.4. 优化机制</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id7">4.5.1.5. 对比不同架构的页表设计</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_ptw.html#loongarch">4.5.2. LoongArch的多级页表结构</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#kernel">4.5.2.1. Kernel如何初始化设置多级页表结构</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#kb">4.5.2.2. 二级页表，4KB页大小</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id8">4.5.2.3. 二级页表，16KB页大小</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id9">4.5.2.4. 三级页表，4KB页大小</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id10">4.5.2.5. 三级页表，16KB页大小</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id11">4.5.2.6. 四级页表，4KB页大小</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id12">4.5.2.7. 四级页表，16KB页大小</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_ptw.html#id13">4.5.3. 内存中的页表表项（Kernel视角）</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id14">4.5.3.1. 基本页表（叶子节点）</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id15">4.5.3.2. 大页页表（叶子节点）</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#no-leaf-pg-entry">4.5.3.3. 中间指向下一级目录的地址的页表(非叶子节点页表)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_ptw.html#id17">4.5.4. 页表的遍历</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#k">4.5.4.1. 以一个例子4K页为例说明：</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#m">4.5.4.2. 以一个例子2M页为例说明：</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../mmu/tlb_ptw.html#cputlb">4.6. 从内存中的页表表项到CPU中的TLB</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_ptw.html#tlbrefill-softeware-ptw">4.6.1. TLBRefill (Softeware PTW)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#csr">4.6.1.1. 相关的CSR寄存器</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id18">4.6.1.2. 重填示例代码</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id19">4.6.1.3. 两级页表的示例代码</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#three-level-page-table-refill">4.6.1.4. 三级页表的示例代码</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id21">4.6.1.5. 四级页表的示例代码</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_ptw.html#hardware-ptw">4.6.2. Hardware PTW</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_ptw.html#id22">4.6.3. 页表的刷新</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id23">4.6.3.1. 页表为什么需要刷新</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id24">4.6.3.2. 页表刷新的指令</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id25">4.6.3.3. 页表刷新的例子</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../mmu/page_table_in_kernel.html">4.7. Kernel与MMU</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../mmu/page_table_in_kernel.html#id1">4.7.1. 地址翻译相关的初始化</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/page_table_in_kernel.html#id2">4.7.2. 如何从直接地址翻译模式到映射地址翻译模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/page_table_in_kernel.html#id3">4.7.3. 如何建立虚拟地址到物理地址的映射关系</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/page_table_in_kernel.html#id4">4.7.4. 页表的遍历页表</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/page_table_in_kernel.html#tlb">4.7.5. 情况1. 如果TLB中没有映射</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/page_table_in_kernel.html#v-0">4.7.6. 情况2. 如果页表项的V=0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/page_table_in_kernel.html#d-0">4.7.7. 情况3. 如果写操作页表项D=0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/page_table_in_kernel.html#id5">4.7.8. 情况4. 如果权限不合法</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/page_table_in_kernel.html#ptw">4.7.9. 如果使能硬件PTW</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../trap/index.html">5. 中断与异常系统</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../trap/interrupt.html">5.1. 中断</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../trap/interrupt.html#id2">5.1.1. 线中断</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../trap/interrupt.html#ipi">5.1.1.1. 核间中断IPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../trap/interrupt.html#id3">5.1.1.2. 定时器中断</a></li>
<li class="toctree-l4"><a class="reference internal" href="../trap/interrupt.html#id4">5.1.1.3. 性能计数器中断</a></li>
<li class="toctree-l4"><a class="reference internal" href="../trap/interrupt.html#id5">5.1.1.4. 外部硬中断</a></li>
<li class="toctree-l4"><a class="reference internal" href="../trap/interrupt.html#id6">5.1.1.5. 内部软中断</a></li>
<li class="toctree-l4"><a class="reference internal" href="../trap/interrupt.html#id7">5.1.1.6. 中断号</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../trap/interrupt.html#id8">5.1.2. 消息中断</a></li>
<li class="toctree-l3"><a class="reference internal" href="../trap/interrupt.html#id9">5.1.3. 中断的优先级</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../trap/interrupt.html#id10">5.1.3.1. 线中断的优先级</a></li>
<li class="toctree-l4"><a class="reference internal" href="../trap/interrupt.html#id11">5.1.3.2. 消息中断的优先级</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../trap/interrupt.html#id12">5.1.4. 中断的打开与关闭</a></li>
<li class="toctree-l3"><a class="reference internal" href="../trap/interrupt.html#id13">5.1.5. 中断的入口地址</a></li>
<li class="toctree-l3"><a class="reference internal" href="../trap/interrupt.html#id14">5.1.6. 中断的处理流程</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../trap/exception.html">5.2. 例外</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../trap/exception.html#id2">5.2.1. 例外的优先级</a></li>
<li class="toctree-l3"><a class="reference internal" href="../trap/exception.html#id3">5.2.2. 例外的入口地址</a></li>
<li class="toctree-l3"><a class="reference internal" href="../trap/exception.html#id4">5.2.3. 例外的处理过程</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../trap/exception.html#id5">5.2.3.1. 普通例外的处理过程</a></li>
<li class="toctree-l4"><a class="reference internal" href="../trap/exception.html#tlb">5.2.3.2. TLB 重填例外硬件处理过程</a></li>
<li class="toctree-l4"><a class="reference internal" href="../trap/exception.html#id6">5.2.3.3. 机器错误例外硬件处理过程</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../trap/trap_in_kernel.html">5.3. Kernel与异常</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../trap/trap_in_kernel.html#expection-entry-selection">5.3.1. 异常的入口地址选择</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../trap/trap_in_kernel.html#id2">5.3.1.1. “统一式”的入口地址</a></li>
<li class="toctree-l4"><a class="reference internal" href="../trap/trap_in_kernel.html#id3">5.3.1.2. “分离式”的入口地址</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../trap/trap_in_kernel.html#id4">5.3.2. 异常的初始化</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../trap/trap_in_kernel.html#id5">5.3.2.1. 统一式的初始化</a></li>
<li class="toctree-l4"><a class="reference internal" href="../trap/trap_in_kernel.html#id7">5.3.2.2. 分离式的初始化</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../trap/trap_in_kernel.html#cpu">5.3.3. 异常发生时，CPU做了什么</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../trap/trap_in_kernel.html#id9">5.4. 特殊异常的处理</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../trap/trap_in_kernel.html#id10">5.4.1. 定时器中断</a></li>
<li class="toctree-l3"><a class="reference internal" href="../trap/trap_in_kernel.html#id11">5.4.2. 系统调用</a></li>
<li class="toctree-l3"><a class="reference internal" href="../trap/trap_in_kernel.html#id12">5.4.3. 非对齐访问</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../smp/index.html">6. SMP多核系统</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../smp/smp.html">6.1. SMP与LoongArch</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../smp/smp.html#ipi">6.1.1. IPI中断</a></li>
<li class="toctree-l3"><a class="reference internal" href="../smp/smp.html#id1">6.1.2. 如何通信</a></li>
<li class="toctree-l3"><a class="reference internal" href="../smp/smp.html#id2">6.1.3. 如何初始化</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../smp/smp.html#linuxsmp">6.2. Linux中SMP的处理（与架构相关）</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../abi/index.html">7. 程序二进制接口</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../abi/new_and_old_world.html">7.1. 新旧世界</a></li>
<li class="toctree-l2"><a class="reference internal" href="../abi/new_and_old_world.html#id2">7.2. 旧世界</a></li>
<li class="toctree-l2"><a class="reference internal" href="../abi/new_and_old_world.html#id3">7.3. 新世界</a></li>
<li class="toctree-l2"><a class="reference internal" href="../abi/new_and_old_world.html#id4">7.4. 新旧世界的区分</a></li>
<li class="toctree-l2"><a class="reference internal" href="../abi/abi.html">7.5. ABI 2.0</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../debug/index.html">8. 调试方法与技巧</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../debug/debug_env.html">8.1. LoongArch最小debug环境搭建</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../debug/debug_env.html#linux-ramdisk">8.1.1. 制作Linux RamDisk</a></li>
<li class="toctree-l3"><a class="reference internal" href="../debug/debug_env.html#qemu">8.1.2. 如何在 QEMU 中调试</a></li>
<li class="toctree-l3"><a class="reference internal" href="../debug/debug_env.html#id1">8.1.3. 设置断点</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../debug/debug_gdb.html">8.2. GDB的使用</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../debug/debug_gdb.html#id1">8.2.1. 交叉编译环境中的GDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../debug/debug_gdb.html#id2">8.2.2. 常见的GDB命令示例</a></li>
<li class="toctree-l3"><a class="reference internal" href="../debug/debug_gdb.html#id3">8.2.3. 调试指令常见失效状况</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../platform/index.html">9. 平台相关</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../platform/qemu.html">9.1. QEMU</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../platform/qemu.html#virt">9.1.1. Virt</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/qemu.html#id1">9.1.2. 设备</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../platform/3a5000.html">9.2. 3A5000芯片</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../platform/3a5000.html#id1">9.2.1. 芯片参数</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/3a5000.html#id2">9.2.2. 芯片架构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/3a5000.html#id3">9.2.3. 地址空间</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../platform/3a5000.html#id4">9.2.3.1. 结点间物理地址空间</a></li>
<li class="toctree-l4"><a class="reference internal" href="../platform/3a5000.html#id5">9.2.3.2. 结点内物理地址空间</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../platform/3a6000.html">9.3. 3A6000芯片</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../platform/3a6000.html#id1">9.3.1. 芯片参数</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/3a6000.html#id2">9.3.2. 芯片架构</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../platform/2k3000.html">9.4. 2k3000芯片</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k3000.html#id1">9.4.1. 芯片参数</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../platform/2k1000la.html">9.5. 2k1000LA芯片</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k1000la.html#id1">9.5.1. 芯片参数</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k1000la.html#id2">9.5.2. 芯片架构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k1000la.html#id3">9.5.3. 芯片功能</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k1000la.html#id4">9.5.4. 地址空间</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../platform/2k0500.html">9.6. 2k0500芯片</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k0500.html#id1">9.6.1. 芯片架构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k0500.html#id2">9.6.2. 芯片架构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k0500.html#id3">9.6.3. 芯片架构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k0500.html#id4">9.6.4. 芯片功能</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k0500.html#id5">9.6.5. 地址空间</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k0500.html#id6">9.6.6. 中断配置</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../platform/2k0300.html">9.7. 2k0300芯片</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k0300.html#id1">9.7.1. 芯片参数</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k0300.html#id2">9.7.2. 芯片架构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k0300.html#id3">9.7.3. 芯片功能</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k0300.html#id4">9.7.4. 地址空间</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k0300.html#id5">9.7.5. 中断配置及路由</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../simd/index.html">10. 高级应用：SMID与向量指令</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../simd/todo.html">10.1. TODO</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../virt/index.html">11. 高级应用：LVZ与虚拟化扩展</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../virt/todo.html">11.1. TODO</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">12. FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../faq/faq-25.html">12.1. FAQ-25</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">龙芯实验室文档</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html"><span class="section-number">2. </span>工具链</a></li>
      <li class="breadcrumb-item active"><span class="section-number">2.6. </span>一些常用的库函数</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1><span class="section-number">2.6. </span>一些常用的库函数<a class="headerlink" href="#id1" title="Link to this heading"></a></h1>
<section id="glibc">
<h2><span class="section-number">2.6.1. </span>GLIBC<a class="headerlink" href="#glibc" title="Link to this heading"></a></h2>
<p>GLIBC（GNU C Library）是 GNU 项目为 Linux 系统开发的 C 标准库实现，是 Linux 生态中<strong>最核心的系统运行库</strong>，几乎所有应用程序和系统工具都直接或间接依赖它。以下是其核心解析：</p>
<hr class="docutils" />
<section id="id2">
<h3><span class="section-number">2.6.1.1. </span>一、核心功能与作用<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>系统调用封装</strong></p>
<ul class="simple">
<li><p>提供对 Linux 内核的系统调用接口（如文件操作 <code class="docutils literal notranslate"><span class="pre">open()</span></code>、进程控制 <code class="docutils literal notranslate"><span class="pre">fork()</span></code>），屏蔽底层硬件差异。</p></li>
<li><p>实现 POSIX 标准接口（如线程 <code class="docutils literal notranslate"><span class="pre">pthread_create()</span></code>），确保跨 UNIX 系统兼容性。</p></li>
</ul>
</li>
<li><p><strong>基础功能模块</strong></p>
<ul class="simple">
<li><p><strong>内存管理</strong>：<code class="docutils literal notranslate"><span class="pre">malloc()</span></code>/<code class="docutils literal notranslate"><span class="pre">free()</span></code> 动态内存分配，支持多线程安全优化。</p></li>
<li><p><strong>字符串处理</strong>：<code class="docutils literal notranslate"><span class="pre">strcpy()</span></code>、<code class="docutils literal notranslate"><span class="pre">strlen()</span></code> 等函数，优化字符串操作效率。</p></li>
<li><p><strong>国际化支持</strong>：通过 <code class="docutils literal notranslate"><span class="pre">iconv</span></code> 实现字符集转换，支持多语言环境。</p></li>
</ul>
</li>
<li><p><strong>动态链接支持</strong></p>
<ul class="simple">
<li><p>作为动态链接器 <code class="docutils literal notranslate"><span class="pre">ld-linux.so</span></code> 的核心依赖，管理共享库加载（如 <code class="docutils literal notranslate"><span class="pre">libc.so.6</span></code>）。</p></li>
<li><p>提供 <code class="docutils literal notranslate"><span class="pre">dlopen()</span></code>/<code class="docutils literal notranslate"><span class="pre">dlsym()</span></code> 接口，支持运行时动态加载插件或库。</p></li>
</ul>
</li>
</ol>
</section>
<hr class="docutils" />
<section id="id3">
<h3><span class="section-number">2.6.1.2. </span>二、架构与实现细节<a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>代码结构</strong></p>
<ul class="simple">
<li><p><strong>头文件</strong>：位于 <code class="docutils literal notranslate"><span class="pre">/usr/include</span></code>，定义函数原型和宏（如 <code class="docutils literal notranslate"><span class="pre">stdio.h</span></code>）。</p></li>
<li><p><strong>静态库与动态库</strong>：</p>
<ul>
<li><p>静态库 <code class="docutils literal notranslate"><span class="pre">.a</span></code>：用于不依赖外部共享库的编译场景。</p></li>
<li><p>动态库 <code class="docutils literal notranslate"><span class="pre">.so</span></code>：如 <code class="docutils literal notranslate"><span class="pre">libc.so.6</span></code>，通过 <code class="docutils literal notranslate"><span class="pre">ldconfig</span></code> 管理版本和路径。</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>线程与进程管理</strong></p>
<ul class="simple">
<li><p>封装 Linux 线程（<code class="docutils literal notranslate"><span class="pre">pthread</span></code>）接口，支持多线程同步（互斥锁、条件变量）。</p></li>
<li><p>实现进程间通信（IPC）机制，如管道、信号量和共享内存。</p></li>
</ul>
</li>
<li><p><strong>安全与兼容性</strong></p>
<ul class="simple">
<li><p>通过 <code class="docutils literal notranslate"><span class="pre">mprotect()</span></code> 实现内存保护，防止非法访问。</p></li>
<li><p>兼容旧版 Linux 系统调用（如 <code class="docutils literal notranslate"><span class="pre">syscall()</span></code> 的封装），确保二进制向后兼容。</p></li>
</ul>
</li>
</ol>
</section>
<hr class="docutils" />
<section id="id4">
<h3><span class="section-number">2.6.1.3. </span>三、版本演进与升级风险<a class="headerlink" href="#id4" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>版本历史</strong></p>
<ul class="simple">
<li><p><strong>libc5</strong>：早期版本，不支持 ELF 共享库，国际化能力弱。</p></li>
<li><p><strong>glibc 2.x</strong>：引入 ELF 支持、POSIX 兼容性，成为 Linux 主流标准。</p></li>
<li><p><strong>现代版本</strong>（如 2.38）：优化性能（如内存分配算法）、增强安全（如堆溢出防护）。</p></li>
</ul>
</li>
<li><p><strong>升级风险</strong></p>
<ul class="simple">
<li><p><strong>二进制兼容性</strong>：新版本可能破坏旧程序的 ABI（应用二进制接口），导致崩溃。</p></li>
<li><p><strong>系统稳定性</strong>：直接替换系统默认 glibc 可能引发段错误（如 <code class="docutils literal notranslate"><span class="pre">libc.so.6</span></code> 软链接错误）。</p></li>
<li><p><strong>解决方案</strong>：</p>
<ul>
<li><p>使用容器（Docker）隔离不同 glibc 版本。</p></li>
<li><p>通过 <code class="docutils literal notranslate"><span class="pre">patchelf</span></code> 修改程序的动态链接器路径，指向特定版本。</p></li>
</ul>
</li>
</ul>
</li>
</ol>
</section>
<hr class="docutils" />
<section id="id5">
<h3><span class="section-number">2.6.1.4. </span>四、与其他运行库的对比<a class="headerlink" href="#id5" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>库</strong></p></th>
<th class="head"><p><strong>特点</strong></p></th>
<th class="head"><p><strong>适用场景</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>glibc</strong></p></td>
<td><p>GNU 标准实现，功能全面，兼容 POSIX，Linux 系统默认</p></td>
<td><p>通用 Linux 应用开发</p></td>
</tr>
<tr class="row-odd"><td><p><strong>musl</strong></p></td>
<td><p>轻量级、静态链接友好，符合 ISO C 标准，兼容性较差</p></td>
<td><p>嵌入式系统、Alpine Linux</p></td>
</tr>
<tr class="row-even"><td><p><strong>MSVCRT</strong></p></td>
<td><p>Windows 下的 C 运行库，依赖 Windows API</p></td>
<td><p>Windows 应用开发</p></td>
</tr>
</tbody>
</table>
</section>
<hr class="docutils" />
<section id="id6">
<h3><span class="section-number">2.6.1.5. </span>五、开发与调试工具<a class="headerlink" href="#id6" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>调试工具</strong></p>
<ul class="simple">
<li><p><strong>gdb</strong>：结合 glibc 的调试符号（<code class="docutils literal notranslate"><span class="pre">.debug</span></code> 文件），分析内存泄漏或崩溃。</p></li>
<li><p><strong>valgrind</strong>：检测内存非法访问（需 glibc 的 <code class="docutils literal notranslate"><span class="pre">malloc</span></code> 钩子支持）。</p></li>
</ul>
</li>
<li><p><strong>多版本管理</strong></p>
<ul class="simple">
<li><p><strong>glibc-all-in-one</strong>：一键下载、编译多版本 glibc，支持版本共存。</p></li>
<li><p><strong>LD_LIBRARY_PATH</strong>：临时指定程序使用的 glibc 库路径，避免污染系统环境。</p></li>
</ul>
</li>
</ol>
</section>
</section>
<hr class="docutils" />
<section id="musl">
<h2><span class="section-number">2.6.2. </span>MUSL<a class="headerlink" href="#musl" title="Link to this heading"></a></h2>
<section id="musl-c">
<h3><span class="section-number">2.6.2.1. </span>Musl C 库详解<a class="headerlink" href="#musl-c" title="Link to this heading"></a></h3>
<section id="id7">
<h4><span class="section-number">2.6.2.1.1. </span>一、核心概念与架构<a class="headerlink" href="#id7" title="Link to this heading"></a></h4>
<p><strong>Musl libc</strong> 是 GNU 项目之外的轻量级 C 标准库实现，专注于 <strong>高性能、低内存占用和代码简洁性</strong>，遵循 ISO C 和 POSIX 标准。其核心特点包括：</p>
<ol class="arabic simple">
<li><p><strong>轻量化设计</strong></p>
<ul class="simple">
<li><p>静态链接时最小仅需 <strong>10KB</strong>，动态链接后约 <strong>50KB</strong>，远低于 glibc 的数 MB 级体积。</p></li>
<li><p>无动态内存分配（如 <code class="docutils literal notranslate"><span class="pre">malloc</span></code> 需自行实现或通过第三方库），减少运行时开销。</p></li>
</ul>
</li>
<li><p><strong>模块化架构</strong></p>
<ul class="simple">
<li><p>分离基础库（<code class="docutils literal notranslate"><span class="pre">libc</span></code>）、数学库（<code class="docutils literal notranslate"><span class="pre">libm</span></code>）和动态链接器（<code class="docutils literal notranslate"><span class="pre">libdl</span></code>），实际在 OpenHarmony 中通过符号链接整合为单一库。</p></li>
<li><p>支持多架构（ARM64、x86_64、LoongArch 等），适配嵌入式设备和服务器场景。</p></li>
</ul>
</li>
<li><p><strong>安全增强</strong></p>
<ul class="simple">
<li><p>默认启用地址空间布局随机化（ASLR）和堆内存混淆（<code class="docutils literal notranslate"><span class="pre">mallocng</span></code>），防御缓冲区溢出等漏洞。</p></li>
<li><p>符号版本控制（Symbol Versioning）确保接口兼容性。</p></li>
</ul>
</li>
</ol>
</section>
<section id="id8">
<h4><span class="section-number">2.6.2.1.2. </span>二、与 glibc 的关键差异<a class="headerlink" href="#id8" title="Link to this heading"></a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>特性</strong></p></th>
<th class="head"><p><strong>Musl</strong></p></th>
<th class="head"><p><strong>glibc</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>体积</strong></p></td>
<td><p>静态链接 10-50KB，动态 50KB+</p></td>
<td><p>静态链接 2MB+，动态 10MB+</p></td>
</tr>
<tr class="row-odd"><td><p><strong>许可证</strong></p></td>
<td><p>MIT（商业友好）</p></td>
<td><p>LGPL（限制闭源分发）</p></td>
</tr>
<tr class="row-even"><td><p><strong>兼容性</strong></p></td>
<td><p>部分 POSIX 扩展不支持（如 <code class="docutils literal notranslate"><span class="pre">gethostbyname</span></code>）</p></td>
<td><p>完全兼容 Linux 系统调用和传统接口</p></td>
</tr>
<tr class="row-odd"><td><p><strong>线程模型</strong></p></td>
<td><p>独立线程栈（默认 80KB），无历史包袱</p></td>
<td><p>依赖 NPTL，兼容旧版线程库</p></td>
</tr>
<tr class="row-even"><td><p><strong>动态加载</strong></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">dlopen</span></code> 无法卸载库（<code class="docutils literal notranslate"><span class="pre">dlclose</span></code> 无效）</p></td>
<td><p>支持动态卸载和延迟绑定（Lazy Binding）</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id9">
<h4><span class="section-number">2.6.2.1.3. </span>三、核心功能与实现<a class="headerlink" href="#id9" title="Link to this heading"></a></h4>
<ol class="arabic simple">
<li><p><strong>标准库支持</strong></p>
<ul class="simple">
<li><p><strong>C11/C17 兼容</strong>：完整实现线程、原子操作、Unicode 处理（<code class="docutils literal notranslate"><span class="pre">char16_t</span></code>/<code class="docutils literal notranslate"><span class="pre">char32_t</span></code>）。</p></li>
<li><p><strong>数学函数优化</strong>：使用硬件指令（如 SSE/AVX）加速浮点运算，避免 glibc 的软浮点回退。</p></li>
</ul>
</li>
<li><p><strong>动态链接器（<code class="docutils literal notranslate"><span class="pre">ld-musl</span></code>）</strong></p>
<ul class="simple">
<li><p><strong>扁平化命名空间</strong>：所有动态库直接加载到进程地址空间，避免 glibc 的 <code class="docutils literal notranslate"><span class="pre">rpath</span></code> 和 <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> 复杂性。</p></li>
<li><p><strong>符号解析策略</strong>：优先使用最新符号版本，避免旧版接口污染。</p></li>
</ul>
</li>
<li><p><strong>国际化支持</strong></p>
<ul class="simple">
<li><p>默认启用 <code class="docutils literal notranslate"><span class="pre">C.UTF-8</span></code> 区域设置，严格遵循 Unicode 标准，拒绝无效 UTF-8 序列。</p></li>
<li><p>通过 <code class="docutils literal notranslate"><span class="pre">iconv</span></code> 实现字符集转换，但仅支持有限编码（如 UTF-8/UCS-2，不支持 GBK）。</p></li>
</ul>
</li>
</ol>
</section>
<section id="id10">
<h4><span class="section-number">2.6.2.1.4. </span>四、应用场景与最佳实践<a class="headerlink" href="#id10" title="Link to this heading"></a></h4>
<ol class="arabic simple">
<li><p><strong>嵌入式系统</strong></p>
<ul class="simple">
<li><p><strong>鸿蒙 OS</strong>：作为默认 C 库，支持高安全性和低内存设备（如智能手表、IoT 终端）。</p></li>
<li><p><strong>Alpine Linux</strong>：替代 glibc 减少镜像体积（Docker 镜像可减小 50% 以上）。</p></li>
</ul>
</li>
<li><p><strong>容器与云原生</strong></p>
<ul class="simple">
<li><p>静态编译二进制文件，避免依赖宿主机的动态库，提升部署一致性。</p></li>
<li><p>结合 <code class="docutils literal notranslate"><span class="pre">musl-gcc</span></code> 工具链交叉编译，优化边缘计算节点性能。</p></li>
</ul>
</li>
<li><p><strong>安全关键系统</strong></p>
<ul class="simple">
<li><p>内存保护机制（如堆元数据混淆）降低漏洞利用风险，适用于金融、军工领域。</p></li>
</ul>
</li>
</ol>
</section>
<section id="id11">
<h4><span class="section-number">2.6.2.1.5. </span>五、开发与调试<a class="headerlink" href="#id11" title="Link to this heading"></a></h4>
<ol class="arabic">
<li><p><strong>交叉编译</strong></p>
<ul>
<li><p>使用 <code class="docutils literal notranslate"><span class="pre">musl-gcc</span></code> 工具链（如 <code class="docutils literal notranslate"><span class="pre">aarch64-linux-musl-gcc</span></code>）编译目标平台代码。</p></li>
<li><p>示例命令：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>loongarch64-linux-musl-gcc<span class="w"> </span>-static<span class="w"> </span>hello.c<span class="w"> </span>-o<span class="w"> </span>hello
</pre></div>
</div>
</li>
</ul>
</li>
<li><p><strong>调试工具</strong></p>
<ul class="simple">
<li><p><strong>动态日志</strong>：通过 <code class="docutils literal notranslate"><span class="pre">param</span> <span class="pre">set</span> <span class="pre">musl.log.enable</span> <span class="pre">true</span></code> 开启运行时日志，定位内存分配或加载器异常。</p></li>
<li><p><strong>Valgrind 替代</strong>：由于 musl 无 <code class="docutils literal notranslate"><span class="pre">malloc</span></code> 钩子，需使用专用工具（如 <code class="docutils literal notranslate"><span class="pre">musl-valgrind</span></code>）检测内存泄漏。</p></li>
</ul>
</li>
</ol>
</section>
<section id="id12">
<h4><span class="section-number">2.6.2.1.6. </span>六、兼容性解决方案<a class="headerlink" href="#id12" title="Link to this heading"></a></h4>
<ol class="arabic simple">
<li><p><strong>glibc 兼容层</strong></p>
<ul class="simple">
<li><p>使用 <code class="docutils literal notranslate"><span class="pre">glibc-compat</span></code> 库提供 <code class="docutils literal notranslate"><span class="pre">pthread</span></code>、<code class="docutils literal notranslate"><span class="pre">dlfcn</span></code> 等接口的兼容实现。</p></li>
<li><p>示例：在 Alpine Linux 中安装 <code class="docutils literal notranslate"><span class="pre">glibc</span></code> 包以运行依赖 glibc 的软件。</p></li>
</ul>
</li>
<li><p><strong>接口适配</strong></p>
<ul class="simple">
<li><p>对不支持的函数（如 <code class="docutils literal notranslate"><span class="pre">gethostbyname</span></code>）封装自定义实现，或切换至 <code class="docutils literal notranslate"><span class="pre">musl</span></code> 兼容的替代库（如 <code class="docutils literal notranslate"><span class="pre">musl-nss</span></code>）。</p></li>
</ul>
</li>
</ol>
</section>
<section id="id13">
<h4><span class="section-number">2.6.2.1.7. </span>七、性能优化技巧<a class="headerlink" href="#id13" title="Link to this heading"></a></h4>
<ol class="arabic simple">
<li><p><strong>编译优化</strong></p>
<ul class="simple">
<li><p>启用 <code class="docutils literal notranslate"><span class="pre">-fno-stack-protector</span></code> 减少栈保护开销（需权衡安全性）。</p></li>
<li><p>使用 <code class="docutils literal notranslate"><span class="pre">-flto</span></code>（链接时优化）提升代码密度。</p></li>
</ul>
</li>
<li><p><strong>内存管理</strong></p>
<ul class="simple">
<li><p>预分配线程栈空间（<code class="docutils literal notranslate"><span class="pre">pthread_attr_setstacksize</span></code>），避免动态扩展导致的性能波动。</p></li>
<li><p>禁用不必要的 locale 支持（通过 <code class="docutils literal notranslate"><span class="pre">--disable-locale</span></code> 配置），减少初始化时间。</p></li>
</ul>
</li>
</ol>
</section>
<section id="id14">
<h4><span class="section-number">2.6.2.1.8. </span>八、生态与社区<a class="headerlink" href="#id14" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><strong>开源协议</strong>：MIT License，允许闭源商用，无专利限制。</p></li>
<li><p><strong>社区支持</strong>：GitHub 仓库（https://github.com/bminor/musl）活跃，但企业级支持较少。</p></li>
<li><p><strong>工具链集成</strong>：主流编译器（GCC、Clang）均提供 musl 交叉编译支持，但需手动配置。</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="id15">
<h3><span class="section-number">2.6.2.2. </span>总结<a class="headerlink" href="#id15" title="Link to this heading"></a></h3>
<p>Musl C 库凭借轻量化、高安全性和模块化设计，成为嵌入式系统和容器化应用的首选。其与 glibc 的差异主要体现在兼容性、性能和资源占用上。开发者需根据场景权衡选择：<strong>追求极致性能或资源受限时选 musl，需广泛兼容性时选 glibc</strong>。对于混合环境，可通过兼容层或接口适配实现平滑过渡。</p>
</section>
</section>
<section id="memcpy">
<h2><span class="section-number">2.6.3. </span>memcpy<a class="headerlink" href="#memcpy" title="Link to this heading"></a></h2>
<p>内存拷贝函数 memcpy <code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*memcpy(void</span> <span class="pre">*dst,</span> <span class="pre">const</span> <span class="pre">void</span> <span class="pre">*src,</span> <span class="pre">size_t</span> <span class="pre">n)</span></code></p>
<p><strong>下面是C语言编写</strong>：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">memcpy</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="kr">restrict</span><span class="w"> </span><span class="n">dest</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="kr">restrict</span><span class="w"> </span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dest</span><span class="p">;</span>
<span class="w">	</span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src</span><span class="p">;</span>
<span class="w">	</span>
<span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">n</span><span class="o">--</span><span class="p">)</span><span class="w"> </span>
<span class="w">		</span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span>
<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="n">dest</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<hr class="docutils" />
<p><strong>下面是优化的C语言编写</strong>：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">memcpy</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="kr">restrict</span><span class="w"> </span><span class="n">dest</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="kr">restrict</span><span class="w"> </span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dest</span><span class="p">;</span>
<span class="w">	</span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src</span><span class="p">;</span>

<span class="w">	</span><span class="k">typedef</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">__attribute__</span><span class="p">((</span><span class="n">__may_alias__</span><span class="p">))</span><span class="w"> </span><span class="n">u32</span><span class="p">;</span>
<span class="w">	</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>

<span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="p">(</span><span class="kt">uintptr_t</span><span class="p">)</span><span class="n">s</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">n</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span>

<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="kt">uintptr_t</span><span class="p">)</span><span class="n">d</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="k">for</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="n">n</span><span class="o">&gt;=</span><span class="mi">16</span><span class="p">;</span><span class="w"> </span><span class="n">s</span><span class="o">+=</span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="o">+=</span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">-=</span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">			</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">d</span><span class="o">+</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">0</span><span class="p">);</span>
<span class="w">			</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">d</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">4</span><span class="p">);</span>
<span class="w">			</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">d</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">8</span><span class="p">);</span>
<span class="w">			</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">d</span><span class="o">+</span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">12</span><span class="p">);</span>
<span class="w">		</span><span class="p">}</span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="o">&amp;</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">			</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">d</span><span class="o">+</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">0</span><span class="p">);</span>
<span class="w">			</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">d</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">4</span><span class="p">);</span>
<span class="w">			</span><span class="n">d</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span>
<span class="w">		</span><span class="p">}</span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="o">&amp;</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">			</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">d</span><span class="o">+</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">0</span><span class="p">);</span>
<span class="w">			</span><span class="n">d</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">		</span><span class="p">}</span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="o">&amp;</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">			</span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span>
<span class="w">		</span><span class="p">}</span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">			</span><span class="o">*</span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="p">;</span>
<span class="w">		</span><span class="p">}</span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">dest</span><span class="p">;</span>
<span class="w">	</span><span class="p">}</span>

<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">((</span><span class="kt">uintptr_t</span><span class="p">)</span><span class="n">d</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="k">case</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span>
<span class="w">		</span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">s</span><span class="p">;</span>
<span class="w">		</span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span>
<span class="w">		</span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span>
<span class="w">		</span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span>
<span class="w">		</span><span class="n">n</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">		</span><span class="k">for</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="n">n</span><span class="o">&gt;=</span><span class="mi">17</span><span class="p">;</span><span class="w"> </span><span class="n">s</span><span class="o">+=</span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="o">+=</span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">-=</span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">			</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="w">			</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">d</span><span class="o">+</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">w</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">24</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">8</span><span class="p">);</span>
<span class="w">			</span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">5</span><span class="p">);</span>
<span class="w">			</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">d</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">24</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">w</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">8</span><span class="p">);</span>
<span class="w">			</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">9</span><span class="p">);</span>
<span class="w">			</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">d</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">w</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">24</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">8</span><span class="p">);</span>
<span class="w">			</span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">13</span><span class="p">);</span>
<span class="w">			</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">d</span><span class="o">+</span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">24</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">w</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">8</span><span class="p">);</span>
<span class="w">		</span><span class="p">}</span>
<span class="w">		</span><span class="k">break</span><span class="p">;</span>
<span class="w">	</span><span class="k">case</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span>
<span class="w">		</span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">s</span><span class="p">;</span>
<span class="w">		</span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span>
<span class="w">		</span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span>
<span class="w">		</span><span class="n">n</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">		</span><span class="k">for</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="n">n</span><span class="o">&gt;=</span><span class="mi">18</span><span class="p">;</span><span class="w"> </span><span class="n">s</span><span class="o">+=</span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="o">+=</span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">-=</span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">			</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">2</span><span class="p">);</span>
<span class="w">			</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">d</span><span class="o">+</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">w</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">16</span><span class="p">);</span>
<span class="w">			</span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">6</span><span class="p">);</span>
<span class="w">			</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">d</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">w</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">16</span><span class="p">);</span>
<span class="w">			</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">10</span><span class="p">);</span>
<span class="w">			</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">d</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">w</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">16</span><span class="p">);</span>
<span class="w">			</span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">14</span><span class="p">);</span>
<span class="w">			</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">d</span><span class="o">+</span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">w</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">16</span><span class="p">);</span>
<span class="w">		</span><span class="p">}</span>
<span class="w">		</span><span class="k">break</span><span class="p">;</span>
<span class="w">	</span><span class="k">case</span><span class="w"> </span><span class="mi">3</span><span class="p">:</span>
<span class="w">		</span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">s</span><span class="p">;</span>
<span class="w">		</span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span>
<span class="w">		</span><span class="n">n</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">		</span><span class="k">for</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="n">n</span><span class="o">&gt;=</span><span class="mi">19</span><span class="p">;</span><span class="w"> </span><span class="n">s</span><span class="o">+=</span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="o">+=</span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">-=</span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">			</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">3</span><span class="p">);</span>
<span class="w">			</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">d</span><span class="o">+</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">w</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">24</span><span class="p">);</span>
<span class="w">			</span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">7</span><span class="p">);</span>
<span class="w">			</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">d</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">w</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">24</span><span class="p">);</span>
<span class="w">			</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">11</span><span class="p">);</span>
<span class="w">			</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">d</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">w</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">24</span><span class="p">);</span>
<span class="w">			</span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">15</span><span class="p">);</span>
<span class="w">			</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">d</span><span class="o">+</span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">w</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">24</span><span class="p">);</span>
<span class="w">		</span><span class="p">}</span>
<span class="w">		</span><span class="k">break</span><span class="p">;</span>
<span class="w">	</span><span class="p">}</span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="o">&amp;</span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span>
<span class="w">		</span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span>
<span class="w">		</span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span>
<span class="w">		</span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span>
<span class="w">	</span><span class="p">}</span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="o">&amp;</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span>
<span class="w">		</span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span>
<span class="w">	</span><span class="p">}</span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="o">&amp;</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span>
<span class="w">	</span><span class="p">}</span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="o">&amp;</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span>
<span class="w">	</span><span class="p">}</span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="o">*</span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="p">;</span>
<span class="w">	</span><span class="p">}</span>
<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="n">dest</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<hr class="docutils" />
<p><strong>下面是基于LoongArch的汇编指令编写</strong>：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// 定义</span>
<span class="cp">#define SYM_FUNC_START(name) \</span>
<span class="cp">    .globl name;   \</span>
<span class="cp">    name: </span>

<span class="cp">#define SYM_FUNC_END(name)</span>

<span class="n">SYM_FUNC_START</span><span class="p">(</span><span class="n">memcpy</span><span class="p">)</span>
<span class="w">	</span><span class="cm">/*</span>
<span class="cm">	 * Some CPUs support hardware unaligned access</span>
<span class="cm">	 */</span>
<span class="w">	</span><span class="c1">// 常用型内存拷贝</span>
<span class="w">	</span><span class="n">b</span><span class="w"> </span><span class="n">__memcpy_generic</span>
<span class="w">	</span>
<span class="w">	</span><span class="c1">// 快速的拷贝，注意需要硬件支持非对齐访问</span>
<span class="w">	</span><span class="n">b</span><span class="w"> </span><span class="n">__memcpy_fast</span>
<span class="n">SYM_FUNC_END</span><span class="p">(</span><span class="n">memcpy</span><span class="p">)</span>

<span class="cm">/*</span>
<span class="cm"> * void *__memcpy_generic(void *dst, const void *src, size_t n)</span>
<span class="cm"> *</span>
<span class="cm"> * a0: dst</span>
<span class="cm"> * a1: src</span>
<span class="cm"> * a2: n</span>
<span class="cm"> */</span>
<span class="n">SYM_FUNC_START</span><span class="p">(</span><span class="n">__memcpy_generic</span><span class="p">)</span>
<span class="w">	</span><span class="n">move</span><span class="w">	</span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span>
<span class="w">	</span><span class="n">beqz</span><span class="w">	</span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="mf">2f</span>

<span class="mi">1</span><span class="o">:</span><span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">b</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">b</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span>
<span class="w">	</span><span class="n">bgt</span><span class="w">	    </span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="n">$zero</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">b</span>

<span class="mi">2</span><span class="o">:</span><span class="w">	</span><span class="n">move</span><span class="w">	</span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span>
<span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$ra</span>
<span class="n">SYM_FUNC_END</span><span class="p">(</span><span class="n">__memcpy_generic</span><span class="p">)</span>

<span class="w">	</span><span class="p">.</span><span class="n">align</span><span class="w">	</span><span class="mi">5</span>
<span class="n">SYM_FUNC_START_NOALIGN</span><span class="p">(</span><span class="n">__memcpy_small</span><span class="p">)</span>
<span class="w">	</span><span class="n">pcaddi</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span>
<span class="w">	</span><span class="n">slli</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span>
<span class="w">	</span><span class="n">add</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a2</span>
<span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$t0</span>

<span class="w">	</span><span class="p">.</span><span class="n">align</span><span class="w">	</span><span class="mi">5</span>
<span class="mi">0</span><span class="o">:</span><span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$ra</span>

<span class="w">	</span><span class="p">.</span><span class="n">align</span><span class="w">	</span><span class="mi">5</span>
<span class="mi">1</span><span class="o">:</span><span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">b</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">b</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$ra</span>

<span class="w">	</span><span class="p">.</span><span class="n">align</span><span class="w">	</span><span class="mi">5</span>
<span class="mi">2</span><span class="o">:</span><span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">h</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">h</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$ra</span>

<span class="w">	</span><span class="p">.</span><span class="n">align</span><span class="w">	</span><span class="mi">5</span>
<span class="mi">3</span><span class="o">:</span><span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">h</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">b</span><span class="w">	</span><span class="n">$t1</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">h</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">b</span><span class="w">	</span><span class="n">$t1</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span>
<span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$ra</span>

<span class="w">	</span><span class="p">.</span><span class="n">align</span><span class="w">	</span><span class="mi">5</span>
<span class="mi">4</span><span class="o">:</span><span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">w</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">w</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$ra</span>

<span class="w">	</span><span class="p">.</span><span class="n">align</span><span class="w">	</span><span class="mi">5</span>
<span class="mi">5</span><span class="o">:</span><span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">w</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">b</span><span class="w">	</span><span class="n">$t1</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">w</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">b</span><span class="w">	</span><span class="n">$t1</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span>
<span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$ra</span>

<span class="w">	</span><span class="p">.</span><span class="n">align</span><span class="w">	</span><span class="mi">5</span>
<span class="mi">6</span><span class="o">:</span><span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">w</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">h</span><span class="w">	</span><span class="n">$t1</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">w</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">h</span><span class="w">	</span><span class="n">$t1</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span>
<span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$ra</span>

<span class="w">	</span><span class="p">.</span><span class="n">align</span><span class="w">	</span><span class="mi">5</span>
<span class="mi">7</span><span class="o">:</span><span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">w</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">w</span><span class="w">	</span><span class="n">$t1</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">w</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">w</span><span class="w">	</span><span class="n">$t1</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span>
<span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$ra</span>

<span class="w">	</span><span class="p">.</span><span class="n">align</span><span class="w">	</span><span class="mi">5</span>
<span class="mi">8</span><span class="o">:</span><span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$ra</span>
<span class="n">SYM_FUNC_END</span><span class="p">(</span><span class="n">__memcpy_small</span><span class="p">)</span>

<span class="cm">/*</span>
<span class="cm"> * void *__memcpy_fast(void *dst, const void *src, size_t n)</span>
<span class="cm"> *</span>
<span class="cm"> * a0: dst</span>
<span class="cm"> * a1: src</span>
<span class="cm"> * a2: n</span>
<span class="cm"> */</span>
<span class="n">SYM_FUNC_START</span><span class="p">(</span><span class="n">__memcpy_fast</span><span class="p">)</span>
<span class="w">	</span><span class="n">sltui</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span>
<span class="w">	</span><span class="n">bnez</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">__memcpy_small</span>

<span class="w">	</span><span class="n">add</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a2</span>
<span class="w">	</span><span class="n">add</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="n">$a2</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a6</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a7</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">-8</span>

<span class="w">	</span><span class="cm">/* align up destination address */</span>
<span class="w">	</span><span class="n">andi</span><span class="w">	</span><span class="n">$t1</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span>
<span class="w">	</span><span class="n">sub</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$zero</span><span class="p">,</span><span class="w"> </span><span class="n">$t1</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span>
<span class="w">	</span><span class="n">add</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$t0</span>
<span class="w">	</span><span class="n">add</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="n">$t0</span>

<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">-64</span>
<span class="w">	</span><span class="n">bgeu</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">Llt64</span>

<span class="w">	</span><span class="cm">/* copy 64 bytes at a time */</span>
<span class="p">.</span><span class="n">Lloop64</span><span class="o">:</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t1</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t2</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t3</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">24</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t4</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t5</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t6</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">48</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t7</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">56</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">64</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t1</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t2</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t3</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">24</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t4</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t5</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t6</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">48</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t7</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">56</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">64</span>
<span class="w">	</span><span class="n">bltu</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">Lloop64</span>

<span class="w">	</span><span class="cm">/* copy the remaining bytes */</span>
<span class="p">.</span><span class="n">Llt64</span><span class="o">:</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">-32</span>
<span class="w">	</span><span class="n">bgeu</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">Llt32</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t1</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t2</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t3</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">24</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t1</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t2</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t3</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">24</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span>

<span class="p">.</span><span class="n">Llt32</span><span class="o">:</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">-16</span>
<span class="w">	</span><span class="n">bgeu</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">Llt16</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t1</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t1</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span>

<span class="p">.</span><span class="n">Llt16</span><span class="o">:</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">-8</span>
<span class="w">	</span><span class="n">bgeu</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">Llt8</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>

<span class="p">.</span><span class="n">Llt8</span><span class="o">:</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a6</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a7</span><span class="p">,</span><span class="w"> </span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="mi">-8</span>

<span class="w">	</span><span class="cm">/* return */</span>
<span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$ra</span>
<span class="n">SYM_FUNC_END</span><span class="p">(</span><span class="n">__memcpy_fast</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="memmove">
<h2><span class="section-number">2.6.4. </span>memmove<a class="headerlink" href="#memmove" title="Link to this heading"></a></h2>
<p>内存移动 <code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*memmove(void</span> <span class="pre">*dest,</span> <span class="pre">const</span> <span class="pre">void</span> <span class="pre">*src,</span> <span class="pre">size_t</span> <span class="pre">n)</span></code></p>
<p><strong>下面是基础C语言编写</strong>：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">memmove</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">dest</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dest</span><span class="p">;</span>
<span class="w">	</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src</span><span class="p">;</span>
<span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">n</span><span class="o">--</span><span class="p">)</span><span class="w"> </span>
<span class="w">		</span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span>
<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="n">dest</span><span class="p">;</span>
<span class="p">}</span>

</pre></div>
</div>
<hr class="docutils" />
<p><strong>下面是C语言优化编写</strong>：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">memmove</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">dest</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dest</span><span class="p">;</span>
<span class="w">	</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src</span><span class="p">;</span>

<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="o">==</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="kt">uintptr_t</span><span class="p">)</span><span class="n">s</span><span class="o">-</span><span class="p">(</span><span class="kt">uintptr_t</span><span class="p">)</span><span class="n">d</span><span class="o">-</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">-2</span><span class="o">*</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">memcpy</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>

<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="o">&lt;</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="cp">#ifdef __GNUC__</span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="kt">uintptr_t</span><span class="p">)</span><span class="n">s</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">(</span><span class="kt">uintptr_t</span><span class="p">)</span><span class="n">d</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">size_t</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">			</span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="kt">uintptr_t</span><span class="p">)</span><span class="n">d</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">size_t</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">				</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">n</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">dest</span><span class="p">;</span>
<span class="w">				</span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span>
<span class="w">			</span><span class="p">}</span>
<span class="w">			</span><span class="k">for</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="n">n</span><span class="o">&gt;=</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">size_t</span><span class="p">);</span><span class="w"> </span><span class="n">n</span><span class="o">-=</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">size_t</span><span class="p">),</span><span class="w"> </span><span class="n">d</span><span class="o">+=</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">size_t</span><span class="p">),</span><span class="w"> </span><span class="n">s</span><span class="o">+=</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">size_t</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">WT</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">WT</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">s</span><span class="p">;</span>
<span class="w">		</span><span class="p">}</span>
<span class="cp">#endif</span>
<span class="w">		</span><span class="k">for</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">n</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span>
<span class="w">	</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="cp">#ifdef __GNUC__</span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="kt">uintptr_t</span><span class="p">)</span><span class="n">s</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">(</span><span class="kt">uintptr_t</span><span class="p">)</span><span class="n">d</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">size_t</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">			</span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="kt">uintptr_t</span><span class="p">)(</span><span class="n">d</span><span class="o">+</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">size_t</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">				</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">n</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">dest</span><span class="p">;</span>
<span class="w">				</span><span class="n">d</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
<span class="w">			</span><span class="p">}</span>
<span class="w">			</span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="o">&gt;=</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">size_t</span><span class="p">))</span><span class="w"> </span><span class="n">n</span><span class="o">-=</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">size_t</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">WT</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">d</span><span class="o">+</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">WT</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="n">n</span><span class="p">);</span>
<span class="w">		</span><span class="p">}</span>
<span class="cp">#endif</span>
<span class="w">		</span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="n">n</span><span class="o">--</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
<span class="w">	</span><span class="p">}</span>

<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="n">dest</span><span class="p">;</span>
<span class="p">}</span>

</pre></div>
</div>
<hr class="docutils" />
<p><strong>下面是基于LoongArch的汇编指令编写</strong>：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// 定义</span>
<span class="cp">#define SYM_FUNC_START(name) \</span>
<span class="cp">    .globl name;   \</span>
<span class="cp">    name: </span>

<span class="cp">#define SYM_FUNC_END(name)</span>


<span class="n">SYM_FUNC_START</span><span class="p">(</span><span class="n">memmove</span><span class="p">)</span>
<span class="w">	</span><span class="n">blt</span><span class="w">	</span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">__memcpy</span><span class="w">	</span><span class="cm">/* dst &lt; src, memcpy */</span>
<span class="w">	</span><span class="n">blt</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="n">__rmemcpy</span><span class="w">	</span><span class="cm">/* src &lt; dst, rmemcpy */</span>
<span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$ra</span><span class="w">			</span><span class="cm">/* dst == src, return */</span>
<span class="n">SYM_FUNC_END</span><span class="p">(</span><span class="n">memmove</span><span class="p">)</span>

<span class="n">SYM_FUNC_START</span><span class="p">(</span><span class="n">__rmemcpy</span><span class="p">)</span>
<span class="w">	</span><span class="cm">/*</span>
<span class="cm">	 * Some CPUs support hardware unaligned access</span>
<span class="cm">	 */</span>

<span class="w">	</span><span class="c1">// 常用型内存拷贝</span>
<span class="w">	</span><span class="n">b</span><span class="w"> </span><span class="n">__rmemcpy_generic</span>
<span class="w">	</span>
<span class="w">	</span><span class="c1">// 快速的拷贝，注意需要硬件支持非对齐访问</span>
<span class="w">	</span><span class="n">b</span><span class="w"> </span><span class="n">__rmemcpy_fast</span>

<span class="n">SYM_FUNC_END</span><span class="p">(</span><span class="n">__rmemcpy</span><span class="p">)</span>

<span class="cm">/*</span>
<span class="cm"> * void *__rmemcpy_generic(void *dst, const void *src, size_t n)</span>
<span class="cm"> *</span>
<span class="cm"> * a0: dst</span>
<span class="cm"> * a1: src</span>
<span class="cm"> * a2: n</span>
<span class="cm"> */</span>
<span class="n">SYM_FUNC_START</span><span class="p">(</span><span class="n">__rmemcpy_generic</span><span class="p">)</span>
<span class="w">	</span><span class="n">move</span><span class="w">	</span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span>
<span class="w">	</span><span class="n">beqz</span><span class="w">	</span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="mf">2f</span>

<span class="w">	</span><span class="n">add</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="n">$a2</span>
<span class="w">	</span><span class="n">add</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a2</span>

<span class="mi">1</span><span class="o">:</span><span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">b</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">b</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span>
<span class="w">	</span><span class="n">bgt</span><span class="w">	    </span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="n">$zero</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">b</span>

<span class="mi">2</span><span class="o">:</span><span class="w">	</span><span class="n">move</span><span class="w">	</span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span>
<span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$ra</span>
<span class="n">SYM_FUNC_END</span><span class="p">(</span><span class="n">__rmemcpy_generic</span><span class="p">)</span>

<span class="cm">/*</span>
<span class="cm"> * void *__rmemcpy_fast(void *dst, const void *src, size_t n)</span>
<span class="cm"> *</span>
<span class="cm"> * a0: dst</span>
<span class="cm"> * a1: src</span>
<span class="cm"> * a2: n</span>
<span class="cm"> */</span>
<span class="n">SYM_FUNC_START</span><span class="p">(</span><span class="n">__rmemcpy_fast</span><span class="p">)</span>
<span class="w">	</span><span class="n">sltui</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span>
<span class="w">	</span><span class="n">bnez</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">__memcpy_small</span>

<span class="w">	</span><span class="n">add</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a2</span>
<span class="w">	</span><span class="n">add</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="n">$a2</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a6</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a7</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">-8</span>

<span class="w">	</span><span class="cm">/* align up destination address */</span>
<span class="w">	</span><span class="n">andi</span><span class="w">	</span><span class="n">$t1</span><span class="p">,</span><span class="w"> </span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span>
<span class="w">	</span><span class="n">sub</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="n">$t1</span>
<span class="w">	</span><span class="n">sub</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="n">$t1</span>

<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">64</span>
<span class="w">	</span><span class="n">bgeu</span><span class="w">	</span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">Llt64</span>

<span class="w">	</span><span class="cm">/* copy 64 bytes at a time */</span>
<span class="p">.</span><span class="n">Lloop64</span><span class="o">:</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">-8</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t1</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">-16</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t2</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">-24</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t3</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">-32</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t4</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">-40</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t5</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">-48</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t6</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">-56</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t7</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">-64</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">-64</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">-8</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t1</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">-16</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t2</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">-24</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t3</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">-32</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t4</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">-40</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t5</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">-48</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t6</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">-56</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t7</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">-64</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">-64</span>
<span class="w">	</span><span class="n">bltu</span><span class="w">	</span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">Lloop64</span>

<span class="w">	</span><span class="cm">/* copy the remaining bytes */</span>
<span class="p">.</span><span class="n">Llt64</span><span class="o">:</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span>
<span class="w">	</span><span class="n">bgeu</span><span class="w">	</span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">Llt32</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">-8</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t1</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">-16</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t2</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">-24</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t3</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">-32</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">-32</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">-8</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t1</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">-16</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t2</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">-24</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t3</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">-32</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">-32</span>

<span class="p">.</span><span class="n">Llt32</span><span class="o">:</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span>
<span class="w">	</span><span class="n">bgeu</span><span class="w">	</span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">Llt16</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">-8</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t1</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">-16</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">-16</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">-8</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t1</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">-16</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">-16</span>

<span class="p">.</span><span class="n">Llt16</span><span class="o">:</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span>
<span class="w">	</span><span class="n">bgeu</span><span class="w">	</span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">Llt8</span>
<span class="w">	</span><span class="n">ld</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">-8</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a5</span><span class="p">,</span><span class="w"> </span><span class="mi">-8</span>

<span class="p">.</span><span class="n">Llt8</span><span class="o">:</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a6</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a7</span><span class="p">,</span><span class="w"> </span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="mi">-8</span>

<span class="w">	</span><span class="cm">/* return */</span>
<span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$ra</span>
<span class="n">SYM_FUNC_END</span><span class="p">(</span><span class="n">__rmemcpy_fast</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="memset">
<h2><span class="section-number">2.6.5. </span>memset<a class="headerlink" href="#memset" title="Link to this heading"></a></h2>
<p>将内存范围全部使用特定的值填充。</p>
<p><strong>下面是基础C语言编写</strong>：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">memset</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">dest</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dest</span><span class="p">;</span>

<span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">n</span><span class="o">--</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="o">++</span><span class="p">)</span><span class="w"> </span>
<span class="w">		</span><span class="o">*</span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="n">dest</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<hr class="docutils" />
<p><strong>下面是C语言优化编写</strong>：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">memset</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">dest</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">	</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dest</span><span class="p">;</span>
<span class="w">	</span><span class="kt">size_t</span><span class="w"> </span><span class="n">k</span><span class="p">;</span>

<span class="w">	</span><span class="cm">/* Fill head and tail with minimal branching. Each</span>
<span class="cm">	 * conditional ensures that all the subsequently used</span>
<span class="cm">	 * offsets are well-defined and in the dest region. </span>
<span class="cm">	 */</span>

<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">dest</span><span class="p">;</span>
<span class="w">	</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="w">	</span><span class="n">s</span><span class="p">[</span><span class="n">n</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">dest</span><span class="p">;</span>
<span class="w">	</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="w">	</span><span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="w">	</span><span class="n">s</span><span class="p">[</span><span class="n">n</span><span class="mi">-2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="w">	</span><span class="n">s</span><span class="p">[</span><span class="n">n</span><span class="mi">-3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">dest</span><span class="p">;</span>
<span class="w">	</span><span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="w">	</span><span class="n">s</span><span class="p">[</span><span class="n">n</span><span class="mi">-4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">dest</span><span class="p">;</span>

<span class="w">	</span><span class="cm">/* Advance pointer to align it at a 4-byte boundary,</span>
<span class="cm">	 * and truncate n to a multiple of 4. The previous code</span>
<span class="cm">	 * already took care of any head/tail that get cut off</span>
<span class="cm">	 * by the alignment. */</span>

<span class="w">	</span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="p">(</span><span class="kt">uintptr_t</span><span class="p">)</span><span class="n">s</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">	</span><span class="n">s</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">k</span><span class="p">;</span>
<span class="w">	</span><span class="n">n</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">k</span><span class="p">;</span>
<span class="w">	</span><span class="n">n</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="mi">-4</span><span class="p">;</span>

<span class="w">	</span><span class="k">typedef</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">__attribute__</span><span class="p">((</span><span class="n">__may_alias__</span><span class="p">))</span><span class="w"> </span><span class="n">u32</span><span class="p">;</span>
<span class="w">	</span><span class="k">typedef</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">__attribute__</span><span class="p">((</span><span class="n">__may_alias__</span><span class="p">))</span><span class="w"> </span><span class="n">u64</span><span class="p">;</span>

<span class="w">	</span><span class="n">u32</span><span class="w"> </span><span class="n">c32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">u32</span><span class="p">)</span><span class="mi">-1</span><span class="p">)</span><span class="o">/</span><span class="mi">255</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="p">)</span><span class="n">c</span><span class="p">;</span>

<span class="w">	</span><span class="cm">/* In preparation to copy 32 bytes at a time, aligned on</span>
<span class="cm">	 * an 8-byte bounary, fill head/tail up to 28 bytes each.</span>
<span class="cm">	 * As in the initial byte-based head/tail fill, each</span>
<span class="cm">	 * conditional below ensures that the subsequent offsets</span>
<span class="cm">	 * are valid (e.g. !(n&lt;=24) implies n&gt;=28). */</span>

<span class="w">	</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c32</span><span class="p">;</span>
<span class="w">	</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="n">n</span><span class="mi">-4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c32</span><span class="p">;</span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">dest</span><span class="p">;</span>
<span class="w">	</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c32</span><span class="p">;</span>
<span class="w">	</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c32</span><span class="p">;</span>
<span class="w">	</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="n">n</span><span class="mi">-12</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c32</span><span class="p">;</span>
<span class="w">	</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="n">n</span><span class="mi">-8</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c32</span><span class="p">;</span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">24</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">dest</span><span class="p">;</span>
<span class="w">	</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c32</span><span class="p">;</span>
<span class="w">	</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c32</span><span class="p">;</span>
<span class="w">	</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c32</span><span class="p">;</span>
<span class="w">	</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">24</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c32</span><span class="p">;</span>
<span class="w">	</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="n">n</span><span class="mi">-28</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c32</span><span class="p">;</span>
<span class="w">	</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="n">n</span><span class="mi">-24</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c32</span><span class="p">;</span>
<span class="w">	</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="n">n</span><span class="mi">-20</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c32</span><span class="p">;</span>
<span class="w">	</span><span class="o">*</span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="n">n</span><span class="mi">-16</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c32</span><span class="p">;</span>

<span class="w">	</span><span class="cm">/* Align to a multiple of 8 so we can fill 64 bits at a time,</span>
<span class="cm">	 * and avoid writing the same bytes twice as much as is</span>
<span class="cm">	 * practical without introducing additional branching. */</span>

<span class="w">	</span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="kt">uintptr_t</span><span class="p">)</span><span class="n">s</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
<span class="w">	</span><span class="n">s</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">k</span><span class="p">;</span>
<span class="w">	</span><span class="n">n</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">k</span><span class="p">;</span>

<span class="w">	</span><span class="cm">/* If this loop is reached, 28 tail bytes have already been</span>
<span class="cm">	 * filled, so any remainder when n drops below 32 can be</span>
<span class="cm">	 * safely ignored. */</span>

<span class="w">	</span><span class="n">u64</span><span class="w"> </span><span class="n">c64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c32</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">((</span><span class="n">u64</span><span class="p">)</span><span class="n">c32</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">32</span><span class="p">);</span>
<span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">32</span><span class="p">;</span><span class="w"> </span><span class="n">n</span><span class="o">-=</span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="o">+=</span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="o">*</span><span class="p">(</span><span class="n">u64</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c64</span><span class="p">;</span>
<span class="w">		</span><span class="o">*</span><span class="p">(</span><span class="n">u64</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c64</span><span class="p">;</span>
<span class="w">		</span><span class="o">*</span><span class="p">(</span><span class="n">u64</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c64</span><span class="p">;</span>
<span class="w">		</span><span class="o">*</span><span class="p">(</span><span class="n">u64</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s</span><span class="o">+</span><span class="mi">24</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c64</span><span class="p">;</span>
<span class="w">	</span><span class="p">}</span>
<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="n">dest</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<hr class="docutils" />
<p><strong>下面是基于LoongArch的汇编指令编写</strong>：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">memset</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">dest</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// 定义</span>
<span class="cp">#define SYM_FUNC_START(name) \</span>
<span class="cp">    .globl name;   \</span>
<span class="cp">    name: </span>

<span class="cp">#define SYM_FUNC_END(name)</span>


<span class="n">SYM_FUNC_START</span><span class="p">(</span><span class="n">memset</span><span class="p">)</span>
<span class="w">	</span><span class="cm">/*</span>
<span class="cm">	 * Some CPUs support hardware unaligned access</span>
<span class="cm">	 */</span>

<span class="w">	</span><span class="c1">// 常用型内存设置</span>
<span class="w">	</span><span class="n">b</span><span class="w"> </span><span class="n">__memset_generic</span>
<span class="w">	</span>
<span class="w">	</span><span class="c1">// 快速的设置，注意需要硬件支持非对齐访问</span>
<span class="w">	</span><span class="n">b</span><span class="w"> </span><span class="n">__memset_fast</span>
<span class="n">SYM_FUNC_END</span><span class="p">(</span><span class="n">memset</span><span class="p">)</span>

<span class="cm">/*</span>
<span class="cm"> * void *__memset_generic(void *s, int c, size_t n)</span>
<span class="cm"> *</span>
<span class="cm"> * a0: s</span>
<span class="cm"> * a1: c</span>
<span class="cm"> * a2: n</span>
<span class="cm"> */</span>
<span class="n">SYM_FUNC_START</span><span class="p">(</span><span class="n">__memset_generic</span><span class="p">)</span>
<span class="w">	</span><span class="n">move</span><span class="w">	</span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span>
<span class="w">	</span><span class="n">beqz</span><span class="w">	</span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="mf">2f</span>

<span class="mi">1</span><span class="o">:</span><span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">b</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span>
<span class="w">	</span><span class="n">bgt</span><span class="w">	    </span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="n">$zero</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">b</span>

<span class="mi">2</span><span class="o">:</span><span class="w">	</span><span class="n">move</span><span class="w">	</span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span>
<span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$ra</span>
<span class="n">SYM_FUNC_END</span><span class="p">(</span><span class="n">__memset_generic</span><span class="p">)</span>

<span class="cm">/*</span>
<span class="cm"> * void *__memset_fast(void *s, int c, size_t n)</span>
<span class="cm"> *</span>
<span class="cm"> * a0: s</span>
<span class="cm"> * a1: c</span>
<span class="cm"> * a2: n</span>
<span class="cm"> */</span>
<span class="n">SYM_FUNC_START</span><span class="p">(</span><span class="n">__memset_fast</span><span class="p">)</span>
<span class="w">	</span><span class="cm">/* fill a1 to 64 bits */</span>
<span class="w">	</span><span class="n">bstrins</span><span class="p">.</span><span class="n">d</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span>
<span class="w">	</span><span class="n">bstrins</span><span class="p">.</span><span class="n">d</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span>
<span class="w">	</span><span class="n">bstrins</span><span class="p">.</span><span class="n">d</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="mi">63</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span>

<span class="w">	</span><span class="n">sltui</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span>
<span class="w">	</span><span class="n">bnez</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">Lsmall</span>

<span class="w">	</span><span class="n">add</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="n">$a2</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>

<span class="w">	</span><span class="cm">/* align up address */</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span>
<span class="w">	</span><span class="n">bstrins</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="n">$zero</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>

<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="mi">-64</span>
<span class="w">	</span><span class="n">bgeu</span><span class="w">	</span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">Llt64</span>

<span class="w">	</span><span class="cm">/* set 64 bytes at a time */</span>
<span class="p">.</span><span class="n">Lloop64</span><span class="o">:</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">24</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">48</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">56</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">64</span>
<span class="w">	</span><span class="n">bltu</span><span class="w">	</span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">Lloop64</span>

<span class="w">	</span><span class="cm">/* set the remaining bytes */</span>
<span class="p">.</span><span class="n">Llt64</span><span class="o">:</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="mi">-32</span>
<span class="w">	</span><span class="n">bgeu</span><span class="w">	</span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">Llt32</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">24</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span>

<span class="p">.</span><span class="n">Llt32</span><span class="o">:</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="mi">-16</span>
<span class="w">	</span><span class="n">bgeu</span><span class="w">	</span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">Llt16</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span>

<span class="p">.</span><span class="n">Llt16</span><span class="o">:</span>
<span class="w">	</span><span class="n">addi</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="mi">-8</span>
<span class="w">	</span><span class="n">bgeu</span><span class="w">	</span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="n">$a4</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">Llt8</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a3</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>

<span class="p">.</span><span class="n">Llt8</span><span class="o">:</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="mi">-8</span>

<span class="w">	</span><span class="cm">/* return */</span>
<span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$ra</span>

<span class="w">	</span><span class="p">.</span><span class="n">align</span><span class="w">	</span><span class="mi">4</span>
<span class="p">.</span><span class="n">Lsmall</span><span class="o">:</span>
<span class="w">	</span><span class="n">pcaddi</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span>
<span class="w">	</span><span class="n">slli</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="n">$a2</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span>
<span class="w">	</span><span class="n">add</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$t0</span><span class="p">,</span><span class="w"> </span><span class="n">$a2</span>
<span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$t0</span>

<span class="w">	</span><span class="p">.</span><span class="n">align</span><span class="w">	</span><span class="mi">4</span>
<span class="mi">0</span><span class="o">:</span><span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$ra</span>

<span class="w">	</span><span class="p">.</span><span class="n">align</span><span class="w">	</span><span class="mi">4</span>
<span class="mi">1</span><span class="o">:</span><span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">b</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$ra</span>

<span class="w">	</span><span class="p">.</span><span class="n">align</span><span class="w">	</span><span class="mi">4</span>
<span class="mi">2</span><span class="o">:</span><span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">h</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$ra</span>

<span class="w">	</span><span class="p">.</span><span class="n">align</span><span class="w">	</span><span class="mi">4</span>
<span class="mi">3</span><span class="o">:</span><span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">h</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">b</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span>
<span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$ra</span>

<span class="w">	</span><span class="p">.</span><span class="n">align</span><span class="w">	</span><span class="mi">4</span>
<span class="mi">4</span><span class="o">:</span><span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">w</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$ra</span>

<span class="w">	</span><span class="p">.</span><span class="n">align</span><span class="w">	</span><span class="mi">4</span>
<span class="mi">5</span><span class="o">:</span><span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">w</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">b</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span>
<span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$ra</span>

<span class="w">	</span><span class="p">.</span><span class="n">align</span><span class="w">	</span><span class="mi">4</span>
<span class="mi">6</span><span class="o">:</span><span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">w</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">h</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span>
<span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$ra</span>

<span class="w">	</span><span class="p">.</span><span class="n">align</span><span class="w">	</span><span class="mi">4</span>
<span class="mi">7</span><span class="o">:</span><span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">w</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">w</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span>
<span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$ra</span>

<span class="w">	</span><span class="p">.</span><span class="n">align</span><span class="w">	</span><span class="mi">4</span>
<span class="mi">8</span><span class="o">:</span><span class="w">	</span><span class="n">st</span><span class="p">.</span><span class="n">d</span><span class="w">	</span><span class="n">$a1</span><span class="p">,</span><span class="w"> </span><span class="n">$a0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">	</span><span class="n">jr</span><span class="w">	</span><span class="n">$ra</span>
<span class="n">SYM_FUNC_END</span><span class="p">(</span><span class="n">__memset_fast</span><span class="p">)</span>
</pre></div>
</div>
<hr class="docutils" />
<p>以上的函数都给出具体的例子与说明，或者参考的代码等等</p>
<p>可以结合向量指令操作。</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
    <a href="assembly.html" class="btn btn-neutral float-left" title="2.5. 汇编代码与链接脚本" accesskey="p"
      rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
    <a href="../privilege_isa/index.html" class="btn btn-neutral float-right" title="3. 特权态指令" accesskey="n"
      rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>

  <hr />

  <div role="contentinfo">
    <p>&#169; 版权所有 2022-2026, 龙芯中科技术有限公司。
      <span class="lastupdated">最后更新于 2026年2月10日 11:15:08.
      </span>

      <!-- 
      <span class="footer-aside">
        <a href="../../龙芯实验室文档.pdf" class="fa fa-file-pdf-o">&nbsp下载 PDF</a>
      </span>
       -->
    </p>
  </div> 

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>