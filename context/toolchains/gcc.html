<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2.1. GCC &mdash; 龙芯实验室文档 V1.0 文档</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=b01b2dd9" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />

  
    <link rel="shortcut icon" href="../../_static/favicon.jpg"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=3f0bcac8"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script src="../../_static/translations.js?v=beaddf03"></script>
        <script src="../../_static/design-tabs.js?v=f930bc37"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="2.2. Binutils" href="binutils.html" />
    <link rel="prev" title="2. 工具链" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <img src="../../_static/logo.svg" class="logo" alt="Logo"/>
          <a href="../../index.html" class="icon icon-home">
            龙芯实验室文档
          </a>
              <div class="version">
                V1.0
              </div>
<div role="search">
  <form id="evas-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../preparation/index.html">1. 准备工作</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../preparation/preface.html">1.1. 前言</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../preparation/preface.html#id2">1.1.1. 更新说明</a></li>
<li class="toctree-l3"><a class="reference internal" href="../preparation/preface.html#id3">1.1.2. 仓库地址</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../preparation/tools.html">1.2. 工具链说明</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../preparation/tools.html#gcc">1.2.1. GCC</a></li>
<li class="toctree-l3"><a class="reference internal" href="../preparation/tools.html#llvm">1.2.2. LLVM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../preparation/tools.html#rust">1.2.3. Rust</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../preparation/tools.html#id2">1.3. 模拟器</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../preparation/tools.html#qemu">1.3.1. QEMU</a></li>
<li class="toctree-l3"><a class="reference internal" href="../preparation/tools.html#la-emu">1.3.2. LA_EMU</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../preparation/tools.html#id3">1.4. 操作系统编译</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../preparation/tools.html#loongnix">1.4.1. LoongNix</a></li>
<li class="toctree-l3"><a class="reference internal" href="../preparation/tools.html#uos">1.4.2. UOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../preparation/tools.html#deepin">1.4.3. Deepin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../preparation/tools.html#aosc">1.4.4. AOSC(安同)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../preparation/tools.html#linux-kernel">1.4.5. Linux kernel</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">2. 工具链</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">2.1. GCC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">2.1.1. GCC的相关概念</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">2.1.1.1. GCC的基本定义与起源</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">2.1.1.2. GCC支持的语言与平台</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">2.1.1.3. GCC的核心功能与特点</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">2.1.1.4. GCC的最新进展</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">2.1.1.5. GCC的应用场景</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id8">2.1.2. 交叉编译器</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">2.1.3. 常见的类别组合</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">2.1.4. 如何编译交叉编译器</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#loongarch64-linux-gnu-sf">2.1.4.1. 如何编译loongarch64-linux-gnu[sf]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#loongarch64-linux-musl-sf">2.1.4.2. 如何编译loongarch64-linux-musl[sf]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#crtn-crti-crtbegin-crtend">2.1.4.3. crtn, crti, crtbegin, crtend有什么区别</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id22">2.1.5. 常用的参数与选项</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id23">2.1.5.1. GCC常见的参数</a></li>
<li class="toctree-l4"><a class="reference internal" href="#picpie">2.1.5.2. PIC与PIE的区别是什么</a></li>
<li class="toctree-l4"><a class="reference internal" href="#loongarch">2.1.5.3. 与LoongArch相关的选项说明</a></li>
<li class="toctree-l4"><a class="reference internal" href="#c-c">2.1.5.4. C/C++ 预处理器内嵌的宏定义</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="binutils.html">2.2. Binutils</a><ul>
<li class="toctree-l3"><a class="reference internal" href="binutils.html#gnu-binutils">2.2.1. GNU Binutils的相关说明</a><ul>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id1">2.2.1.1. <strong>核心定位与背景</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id2">2.2.1.2. <strong>重要组成部分与功能</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id5">2.2.1.3. <strong>应用场景</strong></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="binutils.html#ld">2.2.2. ld链接器</a><ul>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id6">2.2.2.1. LD的参数说明</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="binutils.html#readelf">2.2.3. 如何正确的使用readelf</a><ul>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id7">2.2.3.1. 基础用法与核心选项</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id11">2.2.3.2. 二、高级用法</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id14">2.2.3.3. 三、实战示例</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id18">2.2.3.4. 四、与其他工具对比</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="binutils.html#objdump">2.2.4. objdump</a><ul>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id19">2.2.4.1. 一、基础用法与核心选项</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id25">2.2.4.2. 二、高级用法</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id31">2.2.4.3. 三、典型应用场景</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id36">2.2.4.4. 四、与其他工具对比</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id37">2.2.4.5. 五、注意事项</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id38">2.2.4.6. 六、实战示例</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="binutils.html#objcopy">2.2.5. objcopy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id42">2.2.5.1. 一、基础用法与核心选项</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id46">2.2.5.2. 二、高级功能</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id51">2.2.5.3. 三、参数详解</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id52">2.2.5.4. 四、典型应用场景</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id56">2.2.5.5. 五、常见问题与解决</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id60">2.2.5.6. 六、与其他工具对比</a></li>
<li class="toctree-l4"><a class="reference internal" href="binutils.html#id61">2.2.5.7. 七、总结</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="rust.html">2.3. Rust</a><ul>
<li class="toctree-l3"><a class="reference internal" href="rust.html#id1">2.3.1. Rust的概念</a><ul>
<li class="toctree-l4"><a class="reference internal" href="rust.html#id2">2.3.1.1. Rust的起源与发展</a></li>
<li class="toctree-l4"><a class="reference internal" href="rust.html#id3">2.3.1.2. Rust的核心特性</a></li>
<li class="toctree-l4"><a class="reference internal" href="rust.html#id4">2.3.1.3. Rust的应用场景</a></li>
<li class="toctree-l4"><a class="reference internal" href="rust.html#id5">2.3.1.4. Rust的最新进展</a></li>
<li class="toctree-l4"><a class="reference internal" href="rust.html#id6">2.3.1.5. Rust的优缺点</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rust.html#loongarchtarget">2.3.2. LoongArch支持的target有哪些</a></li>
<li class="toctree-l3"><a class="reference internal" href="rust.html#loongarch">2.3.3. 与LoongArch相关的具体参数那些</a></li>
<li class="toctree-l3"><a class="reference internal" href="rust.html#laexe">2.3.4. 简单的例子说明如何编译成LA架构的EXE文件</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="builtin.html">2.4. 内嵌的函数与指令包装</a><ul>
<li class="toctree-l3"><a class="reference internal" href="builtin.html#gcc">2.4.1. GCC</a></li>
<li class="toctree-l3"><a class="reference internal" href="builtin.html#llvm">2.4.2. LLVM</a></li>
<li class="toctree-l3"><a class="reference internal" href="builtin.html#rust">2.4.3. Rust</a><ul>
<li class="toctree-l4"><a class="reference internal" href="builtin.html#loongarch">2.4.3.1. LoongArch包的相关内容</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="assembly.html">2.5. 汇编代码与链接脚本</a><ul>
<li class="toctree-l3"><a class="reference internal" href="assembly.html#loongarch">2.5.1. 与LoongArch相关的汇编指令</a><ul>
<li class="toctree-l4"><a class="reference internal" href="assembly.html#id2">2.5.1.1. 伪汇编指令</a></li>
<li class="toctree-l4"><a class="reference internal" href="assembly.html#id3">2.5.1.2. 地址加载指令</a></li>
<li class="toctree-l4"><a class="reference internal" href="assembly.html#id4">2.5.1.3. 内嵌汇编</a></li>
<li class="toctree-l4"><a class="reference internal" href="assembly.html#id5">2.5.1.4. 参考阅读</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="assembly.html#id6">2.5.2. 链接脚本</a><ul>
<li class="toctree-l4"><a class="reference internal" href="assembly.html#id7">2.5.2.1. 一、基础语法结构</a></li>
<li class="toctree-l4"><a class="reference internal" href="assembly.html#id8">2.5.2.2. 二、核心命令与操作</a></li>
<li class="toctree-l4"><a class="reference internal" href="assembly.html#id13">2.5.2.3. 三、高级功能</a></li>
<li class="toctree-l4"><a class="reference internal" href="assembly.html#id17">2.5.2.4. 四、典型应用场景</a></li>
<li class="toctree-l4"><a class="reference internal" href="assembly.html#id21">2.5.2.5. 五、实战示例</a></li>
<li class="toctree-l4"><a class="reference internal" href="assembly.html#id24">2.5.2.6. 六、调试与验证</a></li>
<li class="toctree-l4"><a class="reference internal" href="assembly.html#id25">2.5.2.7. 七、总结</a></li>
<li class="toctree-l4"><a class="reference internal" href="assembly.html#id26">2.5.2.8. 以LoongArch为例说明链接脚本</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="library.html">2.6. 一些常用的库函数</a><ul>
<li class="toctree-l3"><a class="reference internal" href="library.html#glibc">2.6.1. GLIBC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="library.html#id2">2.6.1.1. 一、核心功能与作用</a></li>
<li class="toctree-l4"><a class="reference internal" href="library.html#id3">2.6.1.2. 二、架构与实现细节</a></li>
<li class="toctree-l4"><a class="reference internal" href="library.html#id4">2.6.1.3. 三、版本演进与升级风险</a></li>
<li class="toctree-l4"><a class="reference internal" href="library.html#id5">2.6.1.4. 四、与其他运行库的对比</a></li>
<li class="toctree-l4"><a class="reference internal" href="library.html#id6">2.6.1.5. 五、开发与调试工具</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="library.html#musl">2.6.2. MUSL</a><ul>
<li class="toctree-l4"><a class="reference internal" href="library.html#musl-c">2.6.2.1. Musl C 库详解</a></li>
<li class="toctree-l4"><a class="reference internal" href="library.html#id15">2.6.2.2. 总结</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="library.html#memcpy">2.6.3. memcpy</a></li>
<li class="toctree-l3"><a class="reference internal" href="library.html#memmove">2.6.4. memmove</a></li>
<li class="toctree-l3"><a class="reference internal" href="library.html#memset">2.6.5. memset</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../privilege_isa/index.html">3. 特权态指令</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../privilege_isa/csr.html">3.1. CSR寄存器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../privilege_isa/csr.html#id1">3.2. CSR指令</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../privilege_isa/csr.html#csrrd">3.2.1. CSRRD指令</a></li>
<li class="toctree-l3"><a class="reference internal" href="../privilege_isa/csr.html#csrwr">3.2.2. CSRWR指令</a></li>
<li class="toctree-l3"><a class="reference internal" href="../privilege_isa/csr.html#csrxchg">3.2.3. CSRXCHG指令</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../privilege_isa/csr.html#iocsr">3.3. IOCSR指令</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../privilege_isa/csr.html#iocsrrd">3.3.1. IOCSRRD指令</a></li>
<li class="toctree-l3"><a class="reference internal" href="../privilege_isa/csr.html#iocsrwr">3.3.2. IOCSRWR指令</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../privilege_isa/cacop_insn.html">3.4. CPUCFG 指令</a></li>
<li class="toctree-l2"><a class="reference internal" href="../privilege_isa/cacop_insn.html#cacop">3.5. CACOP 指令</a></li>
<li class="toctree-l2"><a class="reference internal" href="../privilege_isa/tlb_insn.html">3.6. TLB 与页表指令</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../privilege_isa/tlb_insn.html#id1">3.6.1. TLB 相关指令</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../privilege_isa/tlb_insn.html#tlbsrch">3.6.1.1. TLBSRCH</a></li>
<li class="toctree-l4"><a class="reference internal" href="../privilege_isa/tlb_insn.html#tlbrd">3.6.1.2. TLBRD</a></li>
<li class="toctree-l4"><a class="reference internal" href="../privilege_isa/tlb_insn.html#tlbwr">3.6.1.3. TLBWR</a></li>
<li class="toctree-l4"><a class="reference internal" href="../privilege_isa/tlb_insn.html#tlbfill">3.6.1.4. TLBFILL</a></li>
<li class="toctree-l4"><a class="reference internal" href="../privilege_isa/tlb_insn.html#tlbclr">3.6.1.5. TLBCLR</a></li>
<li class="toctree-l4"><a class="reference internal" href="../privilege_isa/tlb_insn.html#tlbflush">3.6.1.6. TLBFLUSH</a></li>
<li class="toctree-l4"><a class="reference internal" href="../privilege_isa/tlb_insn.html#invtlb">3.6.1.7. INVTLB</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../privilege_isa/tlb_insn.html#id2">3.6.2. 页表查找指令</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../privilege_isa/tlb_insn.html#lddir">3.6.2.1. LDDIR</a></li>
<li class="toctree-l4"><a class="reference internal" href="../privilege_isa/tlb_insn.html#ldpte">3.6.2.2. LDPTE</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../privilege_isa/tlb_insn.html#id3">3.6.3. 应用示例</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../privilege_isa/misc_insn.html">3.7. ERTN指令</a></li>
<li class="toctree-l2"><a class="reference internal" href="../privilege_isa/misc_insn.html#idle">3.8. IDLE指令</a></li>
<li class="toctree-l2"><a class="reference internal" href="../privilege_isa/misc_insn.html#syscall">3.9. SysCALL指令</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../mmu/index.html">4. 内存管理</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../mmu/tlb_struct.html">4.1. LoongArch的地址管理</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_struct.html#id2">4.1.1. 直接地址翻译模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_struct.html#id3">4.1.2. 映射地址翻译模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_struct.html#id4">4.1.3. 存储访问的类型</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../mmu/tlb_struct.html#loongarchtlb">4.2. LoongArch的TLB结构</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_struct.html#id5">4.2.1. 逻辑组织结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_struct.html#tlb-cpu">4.2.2. TLB的表项（以CPU的视觉）</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../mmu/tlb_struct.html#tlb">4.3. TLB的管理</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_struct.html#id6">4.3.1. TLB的一些概念区分</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_struct.html#id7">4.3.2. TLB相关的指令</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_struct.html#tlbcsr">4.3.3. TLB相关的CSR</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_struct.html#tlb-excption-handle">4.3.4. TLB相关的例外</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_struct.html#cputlb">4.3.5. CPU内部TLB查找流程示例</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../mmu/dmw.html">4.4. 直接映射翻译模式</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../mmu/dmw.html#csr-dmw-0-3">4.4.1. CSR.DMW[0-3]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/dmw.html#id2">4.4.2. 操作系统中如何使用</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../mmu/dmw.html#dmw">4.4.2.1. DMW的优点</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/dmw.html#id3">4.4.2.2. DMW的缺点</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/dmw.html#id4">4.4.2.3. 代码示例如何在内核中使用</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../mmu/tlb_ptw.html">4.5. 多级页表结构</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_ptw.html#id2">4.5.1. 设计背景与必要性</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id3">4.5.1.1. 多级页表的结构与层级</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id4">4.5.1.2. 地址转换流程</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id5">4.5.1.3. 多级页表的优势</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id6">4.5.1.4. 优化机制</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id7">4.5.1.5. 对比不同架构的页表设计</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_ptw.html#loongarch">4.5.2. LoongArch的多级页表结构</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#kernel">4.5.2.1. Kernel如何初始化设置多级页表结构</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#kb">4.5.2.2. 二级页表，4KB页大小</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id8">4.5.2.3. 二级页表，16KB页大小</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id9">4.5.2.4. 三级页表，4KB页大小</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id10">4.5.2.5. 三级页表，16KB页大小</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id11">4.5.2.6. 四级页表，4KB页大小</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id12">4.5.2.7. 四级页表，16KB页大小</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_ptw.html#id13">4.5.3. 内存中的页表表项（Kernel视角）</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id14">4.5.3.1. 基本页表（叶子节点）</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id15">4.5.3.2. 大页页表（叶子节点）</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#no-leaf-pg-entry">4.5.3.3. 中间指向下一级目录的地址的页表(非叶子节点页表)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_ptw.html#id17">4.5.4. 页表的遍历</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#k">4.5.4.1. 以一个例子4K页为例说明：</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#m">4.5.4.2. 以一个例子2M页为例说明：</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../mmu/tlb_ptw.html#cputlb">4.6. 从内存中的页表表项到CPU中的TLB</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_ptw.html#tlbrefill-softeware-ptw">4.6.1. TLBRefill (Softeware PTW)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#csr">4.6.1.1. 相关的CSR寄存器</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id18">4.6.1.2. 重填示例代码</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id19">4.6.1.3. 两级页表的示例代码</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#three-level-page-table-refill">4.6.1.4. 三级页表的示例代码</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id21">4.6.1.5. 四级页表的示例代码</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_ptw.html#hardware-ptw">4.6.2. Hardware PTW</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/tlb_ptw.html#id22">4.6.3. 页表的刷新</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id23">4.6.3.1. 页表为什么需要刷新</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id24">4.6.3.2. 页表刷新的指令</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mmu/tlb_ptw.html#id25">4.6.3.3. 页表刷新的例子</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../mmu/page_table_in_kernel.html">4.7. Kernel与MMU</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../mmu/page_table_in_kernel.html#id1">4.7.1. 地址翻译相关的初始化</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/page_table_in_kernel.html#id2">4.7.2. 如何从直接地址翻译模式到映射地址翻译模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/page_table_in_kernel.html#id3">4.7.3. 如何建立虚拟地址到物理地址的映射关系</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/page_table_in_kernel.html#id4">4.7.4. 页表的遍历页表</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/page_table_in_kernel.html#tlb">4.7.5. 情况1. 如果TLB中没有映射</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/page_table_in_kernel.html#v-0">4.7.6. 情况2. 如果页表项的V=0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/page_table_in_kernel.html#d-0">4.7.7. 情况3. 如果写操作页表项D=0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/page_table_in_kernel.html#id5">4.7.8. 情况4. 如果权限不合法</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu/page_table_in_kernel.html#ptw">4.7.9. 如果使能硬件PTW</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../trap/index.html">5. 中断与异常系统</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../trap/interrupt.html">5.1. 中断</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../trap/interrupt.html#id2">5.1.1. 线中断</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../trap/interrupt.html#ipi">5.1.1.1. 核间中断IPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../trap/interrupt.html#id3">5.1.1.2. 定时器中断</a></li>
<li class="toctree-l4"><a class="reference internal" href="../trap/interrupt.html#id4">5.1.1.3. 性能计数器中断</a></li>
<li class="toctree-l4"><a class="reference internal" href="../trap/interrupt.html#id5">5.1.1.4. 外部硬中断</a></li>
<li class="toctree-l4"><a class="reference internal" href="../trap/interrupt.html#id6">5.1.1.5. 内部软中断</a></li>
<li class="toctree-l4"><a class="reference internal" href="../trap/interrupt.html#id7">5.1.1.6. 中断号</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../trap/interrupt.html#id8">5.1.2. 消息中断</a></li>
<li class="toctree-l3"><a class="reference internal" href="../trap/interrupt.html#id9">5.1.3. 中断的优先级</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../trap/interrupt.html#id10">5.1.3.1. 线中断的优先级</a></li>
<li class="toctree-l4"><a class="reference internal" href="../trap/interrupt.html#id11">5.1.3.2. 消息中断的优先级</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../trap/interrupt.html#id12">5.1.4. 中断的打开与关闭</a></li>
<li class="toctree-l3"><a class="reference internal" href="../trap/interrupt.html#id13">5.1.5. 中断的入口地址</a></li>
<li class="toctree-l3"><a class="reference internal" href="../trap/interrupt.html#id14">5.1.6. 中断的处理流程</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../trap/exception.html">5.2. 例外</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../trap/exception.html#id2">5.2.1. 例外的优先级</a></li>
<li class="toctree-l3"><a class="reference internal" href="../trap/exception.html#id3">5.2.2. 例外的入口地址</a></li>
<li class="toctree-l3"><a class="reference internal" href="../trap/exception.html#id4">5.2.3. 例外的处理过程</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../trap/exception.html#id5">5.2.3.1. 普通例外的处理过程</a></li>
<li class="toctree-l4"><a class="reference internal" href="../trap/exception.html#tlb">5.2.3.2. TLB 重填例外硬件处理过程</a></li>
<li class="toctree-l4"><a class="reference internal" href="../trap/exception.html#id6">5.2.3.3. 机器错误例外硬件处理过程</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../trap/trap_in_kernel.html">5.3. Kernel与异常</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../trap/trap_in_kernel.html#expection-entry-selection">5.3.1. 异常的入口地址选择</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../trap/trap_in_kernel.html#id2">5.3.1.1. “统一式”的入口地址</a></li>
<li class="toctree-l4"><a class="reference internal" href="../trap/trap_in_kernel.html#id3">5.3.1.2. “分离式”的入口地址</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../trap/trap_in_kernel.html#id4">5.3.2. 异常的初始化</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../trap/trap_in_kernel.html#id5">5.3.2.1. 统一式的初始化</a></li>
<li class="toctree-l4"><a class="reference internal" href="../trap/trap_in_kernel.html#id7">5.3.2.2. 分离式的初始化</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../trap/trap_in_kernel.html#cpu">5.3.3. 异常发生时，CPU做了什么</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../trap/trap_in_kernel.html#id9">5.4. 特殊异常的处理</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../trap/trap_in_kernel.html#id10">5.4.1. 定时器中断</a></li>
<li class="toctree-l3"><a class="reference internal" href="../trap/trap_in_kernel.html#id11">5.4.2. 系统调用</a></li>
<li class="toctree-l3"><a class="reference internal" href="../trap/trap_in_kernel.html#id12">5.4.3. 非对齐访问</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../smp/index.html">6. SMP多核系统</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../smp/smp.html">6.1. SMP与LoongArch</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../smp/smp.html#ipi">6.1.1. IPI中断</a></li>
<li class="toctree-l3"><a class="reference internal" href="../smp/smp.html#id1">6.1.2. 如何通信</a></li>
<li class="toctree-l3"><a class="reference internal" href="../smp/smp.html#id2">6.1.3. 如何初始化</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../smp/smp.html#linuxsmp">6.2. Linux中SMP的处理（与架构相关）</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../abi/index.html">7. 程序二进制接口</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../abi/new_and_old_world.html">7.1. 新旧世界</a></li>
<li class="toctree-l2"><a class="reference internal" href="../abi/new_and_old_world.html#id2">7.2. 旧世界</a></li>
<li class="toctree-l2"><a class="reference internal" href="../abi/new_and_old_world.html#id3">7.3. 新世界</a></li>
<li class="toctree-l2"><a class="reference internal" href="../abi/new_and_old_world.html#id4">7.4. 新旧世界的区分</a></li>
<li class="toctree-l2"><a class="reference internal" href="../abi/abi.html">7.5. ABI 2.0</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../debug/index.html">8. 调试方法与技巧</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../debug/debug_env.html">8.1. LoongArch最小debug环境搭建</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../debug/debug_env.html#linux-ramdisk">8.1.1. 制作Linux RamDisk</a></li>
<li class="toctree-l3"><a class="reference internal" href="../debug/debug_env.html#qemu">8.1.2. 如何在 QEMU 中调试</a></li>
<li class="toctree-l3"><a class="reference internal" href="../debug/debug_env.html#id1">8.1.3. 设置断点</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../debug/debug_gdb.html">8.2. GDB的使用</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../debug/debug_gdb.html#id1">8.2.1. 交叉编译环境中的GDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../debug/debug_gdb.html#id2">8.2.2. 常见的GDB命令示例</a></li>
<li class="toctree-l3"><a class="reference internal" href="../debug/debug_gdb.html#id3">8.2.3. 调试指令常见失效状况</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../platform/index.html">9. 平台相关</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../platform/qemu.html">9.1. QEMU</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../platform/qemu.html#virt">9.1.1. Virt</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/qemu.html#id1">9.1.2. 设备</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../platform/3a5000.html">9.2. 3A5000芯片</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../platform/3a5000.html#id1">9.2.1. 芯片参数</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/3a5000.html#id2">9.2.2. 芯片架构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/3a5000.html#id3">9.2.3. 地址空间</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../platform/3a5000.html#id4">9.2.3.1. 结点间物理地址空间</a></li>
<li class="toctree-l4"><a class="reference internal" href="../platform/3a5000.html#id5">9.2.3.2. 结点内物理地址空间</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../platform/3a6000.html">9.3. 3A6000芯片</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../platform/3a6000.html#id1">9.3.1. 芯片参数</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/3a6000.html#id2">9.3.2. 芯片架构</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../platform/2k3000.html">9.4. 2k3000芯片</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k3000.html#id1">9.4.1. 芯片参数</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../platform/2k1000la.html">9.5. 2k1000LA芯片</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k1000la.html#id1">9.5.1. 芯片参数</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k1000la.html#id2">9.5.2. 芯片架构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k1000la.html#id3">9.5.3. 芯片功能</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k1000la.html#id4">9.5.4. 地址空间</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../platform/2k0500.html">9.6. 2k0500芯片</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k0500.html#id1">9.6.1. 芯片架构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k0500.html#id2">9.6.2. 芯片架构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k0500.html#id3">9.6.3. 芯片架构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k0500.html#id4">9.6.4. 芯片功能</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k0500.html#id5">9.6.5. 地址空间</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k0500.html#id6">9.6.6. 中断配置</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../platform/2k0300.html">9.7. 2k0300芯片</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k0300.html#id1">9.7.1. 芯片参数</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k0300.html#id2">9.7.2. 芯片架构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k0300.html#id3">9.7.3. 芯片功能</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k0300.html#id4">9.7.4. 地址空间</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/2k0300.html#id5">9.7.5. 中断配置及路由</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../simd/index.html">10. 高级应用：SMID与向量指令</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../simd/todo.html">10.1. TODO</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../virt/index.html">11. 高级应用：LVZ与虚拟化扩展</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../virt/todo.html">11.1. TODO</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">12. FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../faq/faq-25.html">12.1. FAQ-25</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">龙芯实验室文档</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html"><span class="section-number">2. </span>工具链</a></li>
      <li class="breadcrumb-item active"><span class="section-number">2.1. </span>GCC</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="gcc">
<h1><span class="section-number">2.1. </span>GCC<a class="headerlink" href="#gcc" title="Link to this heading"></a></h1>
<p>GCC（GNU Compiler Collection）是全球知名的<strong>自由软件编译器套件</strong>，最初为GNU操作系统开发，现已成为跨平台软件开发的核心工具之一。其核心功能是支持多种编程语言的编译与优化，广泛应用于操作系统、嵌入式系统、高性能计算等领域。</p>
<section id="id1">
<h2><span class="section-number">2.1.1. </span>GCC的相关概念<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<section id="id2">
<h3><span class="section-number">2.1.1.1. </span>GCC的基本定义与起源<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<p>GCC全称为GNU Compiler Collection（GNU编译器集合），由GNU项目开发，遵循GNU通用公共许可证（GPL）发布。它的起源可追溯至1984年，当时理查德·斯托曼（Richard Stallman）为开发GNU系统（一套完全自由的操作系统），需要一个能编译C语言的编译器。最初的GCC仅支持C语言，命名为“GNU C Compiler”，但随着需求扩展，逐渐增加了对C++、Fortran、Ada、Go等多种语言的支持，因此更名为“GNU Compiler Collection”（GNU编译器集合）。<a class="footnote-reference brackets" href="#gnu-gcc" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a></p>
</section>
<section id="id4">
<h3><span class="section-number">2.1.1.2. </span>GCC支持的语言与平台<a class="headerlink" href="#id4" title="Link to this heading"></a></h3>
<p>GCC支持<strong>多种编程语言</strong>，包括：</p>
<ul class="simple">
<li><p>系统级语言：C、C++、Fortran、Ada；</p></li>
<li><p>面向对象语言：Objective-C、Objective-C++；</p></li>
<li><p>现代语言：Go、D；</p></li>
<li><p>其他：Java（通过GCJ编译器）、Mercury（逻辑编程）等。</p></li>
</ul>
<p>在<strong>平台支持</strong>方面，GCC具备极强的跨平台能力，可运行于：</p>
<ul class="simple">
<li><p>操作系统：Linux、macOS、Windows（通过MinGW或Cygwin）、Unix（如Solaris、HP-UX）；</p></li>
<li><p>硬件架构：x86、x86-64、ARM、MIPS、PowerPC、RISC-V、LoongArch等。</p></li>
</ul>
</section>
<section id="id5">
<h3><span class="section-number">2.1.1.3. </span>GCC的核心功能与特点<a class="headerlink" href="#id5" title="Link to this heading"></a></h3>
<p>GCC的核心功能是<strong>将源代码转换为可执行文件</strong>，其工作流程分为四个阶段：</p>
<ol class="arabic simple">
<li><p><strong>预处理</strong>：处理宏定义（<code class="docutils literal notranslate"><span class="pre">#define</span></code>）、头文件包含（<code class="docutils literal notranslate"><span class="pre">#include</span></code>）等，生成<code class="docutils literal notranslate"><span class="pre">.i</span></code>文件；</p></li>
<li><p><strong>编译</strong>：将预处理后的代码转换为汇编语言（<code class="docutils literal notranslate"><span class="pre">.s</span></code>文件）；</p></li>
<li><p><strong>汇编</strong>：将汇编代码转换为机器码（<code class="docutils literal notranslate"><span class="pre">.o</span></code>文件，目标文件）；</p></li>
<li><p><strong>链接</strong>：将目标文件与库文件（如C标准库<code class="docutils literal notranslate"><span class="pre">libc</span></code>）链接，生成可执行文件。</p></li>
</ol>
<p>GCC的特点包括：</p>
<ul class="simple">
<li><p><strong>自由软件</strong>：遵循GPL许可证，允许用户自由使用、修改和分发；</p></li>
<li><p><strong>高度可定制</strong>：支持多种优化选项（如<code class="docutils literal notranslate"><span class="pre">-O2</span></code>、<code class="docutils literal notranslate"><span class="pre">-O3</span></code>），可根据需求调整编译策略；</p></li>
<li><p><strong>多语言支持</strong>：通过不同的前端（Frontend）处理不同语言，后端（Backend）生成统一的机器码；</p></li>
<li><p><strong>跨平台性</strong>：支持几乎所有主流操作系统和硬件架构，是嵌入式系统开发的首选编译器。</p></li>
</ul>
</section>
<section id="id6">
<h3><span class="section-number">2.1.1.4. </span>GCC的最新进展<a class="headerlink" href="#id6" title="Link to this heading"></a></h3>
<p>截至2025年，GCC的最新版本为<strong>15.1.0</strong>（2025年5月发布），其主要更新包括：</p>
<ul class="simple">
<li><p><strong>支持C++23特性</strong>：如模块化标准库（<code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">std;</span></code>），简化了标准库的使用；</p></li>
<li><p><strong>性能优化</strong>：改进了代码生成效率，提升了程序的运行速度；</p></li>
<li><p><strong>新架构支持</strong>：增加了对RISC-V、LoongArch等新兴架构的支持。</p></li>
</ul>
</section>
<section id="id7">
<h3><span class="section-number">2.1.1.5. </span>GCC的应用场景<a class="headerlink" href="#id7" title="Link to this heading"></a></h3>
<p>GCC的应用极其广泛，主要包括：</p>
<ul class="simple">
<li><p><strong>操作系统开发</strong>：Linux内核、GNU工具的编译均依赖GCC；</p></li>
<li><p><strong>嵌入式系统</strong>：ARM、MIPS等架构的嵌入式设备（如手机、路由器）的固件开发；</p></li>
<li><p><strong>高性能计算</strong>：科学计算、人工智能（如TensorFlow、PyTorch）的底层代码编译；</p></li>
<li><p><strong>桌面应用</strong>：Windows、macOS平台上的C/C++应用程序开发（通过MinGW或Cygwin）。</p></li>
</ul>
</section>
</section>
<section id="id8">
<h2><span class="section-number">2.1.2. </span>交叉编译器<a class="headerlink" href="#id8" title="Link to this heading"></a></h2>
<p>交叉编译（Cross Compilation）是一种在一种计算机平台（宿主机）上生成另一种不同平台（目标机）可执行程序的技术。其核心在于解决目标平台资源受限或环境不兼容时的开发难题，广泛应用于嵌入式系统、跨平台应用开发等领域。</p>
<p>交叉编译指：在一个平台（Host 架构）上生成另一种平台（Target 架构）可运行的二进制。</p>
<blockquote>
<div><p>Host 架构：当前运行编译工具链的架构；</p>
</div></blockquote>
<blockquote>
<div><p>Target 架构：生成的二进制将运行的目标架构；</p>
</div></blockquote>
<p>比如，我们现在在X86_64的机器上使用GCC编译一个C语言程序，让它能够在ARM的机器上能够运行。
此时Host就是X86_64，Target就是ARM。</p>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>我们经常在编译具有configure配置的项目时，当你输入<code class="docutils literal notranslate"><span class="pre">./configure</span> <span class="pre">--help</span></code>显示如下：</p>
<p>System types:<br />
–build=BUILD     configure for building on BUILD [guessed]<br />
–host=HOST       cross-compile to build programs to run on HOST [BUILD]<br />
–target=TARGET   configure for building compilers for TARGET [HOST]</p>
<p>其中，在大多数情况下，build和host会自动推测，但是target是需要我们手动输入的，比如：<br />
–build=x86_64-cross-linux-gnu<br />
–host=x86_64-cross-linux-gnu<br />
–target=loongarch64-unknown-linux-gnu</p>
<p>此时，会生成LoongArch有关的二进制文件，但是工具链是运行在x86上。</p>
</div>
<p>如果没有特殊的说明，后续我们都是以交叉编译环境为例，即工具链运行在X86_64上面，生产的可执行文件是针对LoongArch架构的，
进行相关的内容介绍。</p>
</section>
<section id="id9">
<h2><span class="section-number">2.1.3. </span>常见的类别组合<a class="headerlink" href="#id9" title="Link to this heading"></a></h2>
<p>我们本节以GCC为例，介绍常用的几种组合。</p>
<p>gcc Target Triplet的格式如下所示<a class="footnote-reference brackets" href="#osdev-gcc" id="id10" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>，</p>
<blockquote>
<div><p>Machine-Vendor-OperatingSystem</p>
</div></blockquote>
<p>比如Machine对于的是架构，如，X86_64, arm, aarch64, riscv, mips, loongarch64等等</p>
<p><code class="docutils literal notranslate"><span class="pre">loongarch64-linux-gnu-gcc</span></code>指的是，LoongArch64架构，vender是空（也可以是unknown），OS是Linux，使用的是
glibc库环境。</p>
<p>我们在在使用</p>
<p>下面我经常使用的组合以及说明：</p>
<table class="docutils align-default" id="id35">
<caption><span class="caption-text">LoongArch GCC Target组合</span><a class="headerlink" href="#id35" title="Link to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>组合（前缀）</strong></p></th>
<th class="head"><p><strong>说明（Description）</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>loongarch64-unknown-elf</p></td>
<td><p>这是最简单的，适用于嵌入式的组合，其中使用的c库大都是newlib等嵌入是!</p></td>
</tr>
<tr class="row-odd"><td><p>loongarch64-unknown-none</p></td>
<td><p>和上面的loongarch64-unknown-elf基本差别不大<a class="footnote-reference brackets" href="#gcc-target-none" id="id11" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>!</p></td>
</tr>
<tr class="row-even"><td><p>loongarch64-linux-gnu</p></td>
<td><p>这是我们常见的组合，OS是Linux，使用的GlibC库，支持生成浮点指令等。</p></td>
</tr>
<tr class="row-odd"><td><p>loongarch64-linux-gnusf</p></td>
<td><p>OS是Linux，使用的GlibC库，不支持生成浮点指令。</p></td>
</tr>
<tr class="row-even"><td><p>loongarch64-linux-musl</p></td>
<td><p>这也是我们常见的组合，OS是Linux，只不过C库使用的是musl C库，支持生成浮点指令等。</p></td>
</tr>
<tr class="row-odd"><td><p>loongarch64-linux-muslsf</p></td>
<td><p>OS是Linux，C库使用的是musl C库，不支持生成浮点指令等。</p></td>
</tr>
</tbody>
</table>
<p>下面我们简单的使用helloworld来简单的说明交叉编译器的使用，以及初级查看生成的可执行文件。</p>
<p>至于工具链的下载和使用，我们后续章节有更加详细的使用说明，这里只是做一个演示。</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
<span class="w">   </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello LoongArch</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>编译成一个使用musl库，禁止使用生成浮点指令，动态的ELF可执行文件，命令如下：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>loongarch64-linux-muslsf-gcc<span class="w"> </span>main.c<span class="w"> </span>-o<span class="w"> </span>mainsf.elf
</pre></div>
</div>
<p>我们可以使用file命令查看生成的可执行文件的类型情况：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>shell&gt;<span class="w"> </span>file<span class="w"> </span>mainsf.elf
mainsf.elf:<span class="w"> </span>ELF<span class="w"> </span><span class="m">64</span>-bit<span class="w"> </span>LSB<span class="w"> </span>executable,<span class="w"> </span>LoongArch,<span class="w"> </span>version<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">(</span>SYSV<span class="o">)</span>,<span class="w"> </span>dynamically<span class="w"> </span>linked,<span class="w"> </span>interpreter<span class="w"> </span>/lib/ld-musl-loongarch64-sf.so.1,<span class="w"> </span>not<span class="w"> </span>stripped
</pre></div>
</div>
<p>注意此时动态ELF的解释器是<code class="docutils literal notranslate"><span class="pre">/lib/ld-musl-loongarch64-sf.so.1</span></code></p>
<p>如果我们使用打开浮点指令生成的交叉编译器时：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>shell&gt;<span class="w"> </span>loongarch64-linux-musl-gcc<span class="w"> </span>main.c<span class="w"> </span>-o<span class="w"> </span>main.elf
shell&gt;<span class="w"> </span>file<span class="w"> </span>main.elf
main.elf:<span class="w"> </span>ELF<span class="w"> </span><span class="m">64</span>-bit<span class="w"> </span>LSB<span class="w"> </span>executable,<span class="w"> </span>LoongArch,<span class="w"> </span>version<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">(</span>SYSV<span class="o">)</span>,<span class="w"> </span>dynamically<span class="w"> </span>linked,<span class="w"> </span>interpreter<span class="w"> </span>/lib/ld-musl-loongarch64.so.1,<span class="w"> </span>not<span class="w"> </span>stripped
</pre></div>
</div>
<p>注意此时动态ELF的解释器是<code class="docutils literal notranslate"><span class="pre">/lib/ld-musl-loongarch64.so.1</span></code></p>
<div class="admonition caution">
<p class="admonition-title">小心</p>
<p>/lib/ld-musl-loongarch64-sf.so.1链接器和/lib/ld-musl-loongarch64.so.1链接器不能混用，一个Linux环境中可以同时存在。</p>
</div>
<p>我们可以使用链接器来判断这个<em><strong>动态的可执行文件ELF</strong></em>是否是支持浮点指令的，但是我们还有更加稳妥的更加常用的方式
使用工具<code class="docutils literal notranslate"><span class="pre">readelf</span></code></p>
<p>查看禁止生成浮点指令的可执行文件：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>shell&gt;<span class="w"> </span>loongarch64-linux-musl-readelf<span class="w"> </span>mainsf.elf

<span class="c1">#显示如下：</span>
ELF<span class="w"> </span>Header:
<span class="w">  </span>Magic:<span class="w">   </span>7f<span class="w"> </span><span class="m">45</span><span class="w"> </span>4c<span class="w"> </span><span class="m">46</span><span class="w"> </span><span class="m">02</span><span class="w"> </span><span class="m">01</span><span class="w"> </span><span class="m">01</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span>
<span class="w">  </span>Class:<span class="w">                             </span>ELF64
<span class="w">  </span>Data:<span class="w">                              </span><span class="m">2</span><span class="se">\&#39;</span>s<span class="w"> </span>complement,<span class="w"> </span>little<span class="w"> </span>endian
<span class="w">  </span>Version:<span class="w">                           </span><span class="m">1</span><span class="w"> </span><span class="o">(</span>current<span class="o">)</span>
<span class="w">  </span>OS/ABI:<span class="w">                            </span>UNIX<span class="w"> </span>-<span class="w"> </span>System<span class="w"> </span>V
<span class="w">  </span>ABI<span class="w"> </span>Version:<span class="w">                       </span><span class="m">0</span>
<span class="w">  </span>Type:<span class="w">                              </span>EXEC<span class="w"> </span><span class="o">(</span>Executable<span class="w"> </span>file<span class="o">)</span>
<span class="w">  </span>Machine:<span class="w">                           </span>LoongArch
<span class="w">  </span>Version:<span class="w">                           </span>0x1
<span class="w">  </span>Entry<span class="w"> </span>point<span class="w"> </span>address:<span class="w">               </span>0x120000540
<span class="w">  </span>Start<span class="w"> </span>of<span class="w"> </span>program<span class="w"> </span>headers:<span class="w">          </span><span class="m">64</span><span class="w"> </span><span class="o">(</span>bytes<span class="w"> </span>into<span class="w"> </span>file<span class="o">)</span>
<span class="w">  </span>Start<span class="w"> </span>of<span class="w"> </span>section<span class="w"> </span>headers:<span class="w">          </span><span class="m">67672</span><span class="w"> </span><span class="o">(</span>bytes<span class="w"> </span>into<span class="w"> </span>file<span class="o">)</span>
<span class="w">  </span>Flags:<span class="w">                             </span>0x41,<span class="w"> </span>SOFT-FLOAT,<span class="w"> </span>OBJ-v1
<span class="w">  </span>Size<span class="w"> </span>of<span class="w"> </span>this<span class="w"> </span>header:<span class="w">               </span><span class="m">64</span><span class="w"> </span><span class="o">(</span>bytes<span class="o">)</span>
<span class="w">  </span>Size<span class="w"> </span>of<span class="w"> </span>program<span class="w"> </span>headers:<span class="w">           </span><span class="m">56</span><span class="w"> </span><span class="o">(</span>bytes<span class="o">)</span>
<span class="w">  </span>Number<span class="w"> </span>of<span class="w"> </span>program<span class="w"> </span>headers:<span class="w">         </span><span class="m">8</span>
<span class="w">  </span>Size<span class="w"> </span>of<span class="w"> </span>section<span class="w"> </span>headers:<span class="w">           </span><span class="m">64</span><span class="w"> </span><span class="o">(</span>bytes<span class="o">)</span>
<span class="w">  </span>Number<span class="w"> </span>of<span class="w"> </span>section<span class="w"> </span>headers:<span class="w">         </span><span class="m">24</span>
<span class="w">  </span>Section<span class="w"> </span>header<span class="w"> </span>string<span class="w"> </span>table<span class="w"> </span>index:<span class="w"> </span><span class="m">23</span>
</pre></div>
</div>
<p>查看支持生成浮点指令的可执行文件：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>shell&gt;<span class="w"> </span>loongarch64-linux-musl-readelf<span class="w"> </span>main.elf
<span class="c1">#显示如下：</span>
ELF<span class="w"> </span>Header:
<span class="w">  </span>Magic:<span class="w">   </span>7f<span class="w"> </span><span class="m">45</span><span class="w"> </span>4c<span class="w"> </span><span class="m">46</span><span class="w"> </span><span class="m">02</span><span class="w"> </span><span class="m">01</span><span class="w"> </span><span class="m">01</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span>
<span class="w">  </span>Class:<span class="w">                             </span>ELF64
<span class="w">  </span>Data:<span class="w">                              </span><span class="m">2</span><span class="se">\&#39;</span>s<span class="w"> </span>complement,<span class="w"> </span>little<span class="w"> </span>endian
<span class="w">  </span>Version:<span class="w">                           </span><span class="m">1</span><span class="w"> </span><span class="o">(</span>current<span class="o">)</span>
<span class="w">  </span>OS/ABI:<span class="w">                            </span>UNIX<span class="w"> </span>-<span class="w"> </span>System<span class="w"> </span>V
<span class="w">  </span>ABI<span class="w"> </span>Version:<span class="w">                       </span><span class="m">0</span>
<span class="w">  </span>Type:<span class="w">                              </span>EXEC<span class="w"> </span><span class="o">(</span>Executable<span class="w"> </span>file<span class="o">)</span>
<span class="w">  </span>Machine:<span class="w">                           </span>LoongArch
<span class="w">  </span>Version:<span class="w">                           </span>0x1
<span class="w">  </span>Entry<span class="w"> </span>point<span class="w"> </span>address:<span class="w">               </span>0x120000540
<span class="w">  </span>Start<span class="w"> </span>of<span class="w"> </span>program<span class="w"> </span>headers:<span class="w">          </span><span class="m">64</span><span class="w"> </span><span class="o">(</span>bytes<span class="w"> </span>into<span class="w"> </span>file<span class="o">)</span>
<span class="w">  </span>Start<span class="w"> </span>of<span class="w"> </span>section<span class="w"> </span>headers:<span class="w">          </span><span class="m">67672</span><span class="w"> </span><span class="o">(</span>bytes<span class="w"> </span>into<span class="w"> </span>file<span class="o">)</span>
<span class="w">  </span>Flags:<span class="w">                             </span>0x43,<span class="w"> </span>DOUBLE-FLOAT,<span class="w"> </span>OBJ-v1
<span class="w">  </span>Size<span class="w"> </span>of<span class="w"> </span>this<span class="w"> </span>header:<span class="w">               </span><span class="m">64</span><span class="w"> </span><span class="o">(</span>bytes<span class="o">)</span>
<span class="w">  </span>Size<span class="w"> </span>of<span class="w"> </span>program<span class="w"> </span>headers:<span class="w">           </span><span class="m">56</span><span class="w"> </span><span class="o">(</span>bytes<span class="o">)</span>
<span class="w">  </span>Number<span class="w"> </span>of<span class="w"> </span>program<span class="w"> </span>headers:<span class="w">         </span><span class="m">8</span>
<span class="w">  </span>Size<span class="w"> </span>of<span class="w"> </span>section<span class="w"> </span>headers:<span class="w">           </span><span class="m">64</span><span class="w"> </span><span class="o">(</span>bytes<span class="o">)</span>
<span class="w">  </span>Number<span class="w"> </span>of<span class="w"> </span>section<span class="w"> </span>headers:<span class="w">         </span><span class="m">24</span>
<span class="w">  </span>Section<span class="w"> </span>header<span class="w"> </span>string<span class="w"> </span>table<span class="w"> </span>index:<span class="w"> </span><span class="m">23</span>
</pre></div>
</div>
<p>上述两者在生成的<code class="docutils literal notranslate"><span class="pre">Flags:</span></code>字段，会显示不同的提示，</p>
<ul class="simple">
<li><p>软浮点（禁止生成浮点指令）Flags： 0x41, SOFT-FLOAT, OBJ-v1</p></li>
<li><p>软浮点（支持生成浮点指令）Flags： 0x43, DOUBLE-FLOAT, OBJ-v1</p></li>
</ul>
</section>
<section id="id12">
<h2><span class="section-number">2.1.4. </span>如何编译交叉编译器<a class="headerlink" href="#id12" title="Link to this heading"></a></h2>
<p>本小节会教大家如何从gcc等源码编译我们使用的交叉编译器。</p>
<section id="loongarch64-linux-gnu-sf">
<h3><span class="section-number">2.1.4.1. </span>如何编译loongarch64-linux-gnu[sf]<a class="headerlink" href="#loongarch64-linux-gnu-sf" title="Link to this heading"></a></h3>
<p>配置说明：</p>
<table class="docutils align-default" id="id36">
<caption><span class="caption-text">相关编译工具链说明</span><a class="headerlink" href="#id36" title="Link to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>版本说明</strong></p></th>
<th class="head"><p><strong>下载链接</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Linux Kernel头文件版本为6.7</p></td>
<td><p><a class="reference external" href="https://mirrors.edge.kernel.org/pub/linux/kernel/v6.x/">https://mirrors.edge.kernel.org/pub/linux/kernel/v6.x/</a></p></td>
</tr>
<tr class="row-odd"><td><p>BINUTILS版本： binutils-2.45</p></td>
<td><p><a class="reference external" href="https://ftp.gnu.org/gnu/binutils/">https://ftp.gnu.org/gnu/binutils/</a></p></td>
</tr>
<tr class="row-even"><td><p>GMP版本： gmp-6.3.0</p></td>
<td><p><a class="reference external" href="https://ftp.gnu.org/gnu/gmp/">https://ftp.gnu.org/gnu/gmp/</a></p></td>
</tr>
<tr class="row-odd"><td><p>MPFR版本： mpfr-4.2.2</p></td>
<td><p><a class="reference external" href="https://ftp.gnu.org/gnu/mpfr/">https://ftp.gnu.org/gnu/mpfr/</a></p></td>
</tr>
<tr class="row-even"><td><p>MPC版本： mpc-1.3.1</p></td>
<td><p><a class="reference external" href="https://ftp.gnu.org/gnu/mpc/">https://ftp.gnu.org/gnu/mpc</a></p></td>
</tr>
<tr class="row-odd"><td><p>GLIBC版本： glibc-2.42</p></td>
<td><p><a class="reference external" href="https://ftp.gnu.org/gnu/glibc/">https://ftp.gnu.org/gnu/glibc/</a></p></td>
</tr>
<tr class="row-even"><td><p>GLIBC版本： gcc-15.2.0</p></td>
<td><p><a class="reference external" href="https://ftp.gnu.org/gnu/gcc/gcc-15.2.0">https://ftp.gnu.org/gnu/gcc/gcc-15.2.0</a></p></td>
</tr>
<tr class="row-odd"><td><p>GDB版本： gdb-16.3</p></td>
<td><p><a class="reference external" href="https://ftp.gnu.org/gnu/gdb/">https://ftp.gnu.org/gnu/gdb/</a></p></td>
</tr>
</tbody>
</table>
<p>下面逐一演示工具链的制作过程。<br />
首先我们定义几个常用的变量（GCC支持生成浮点指令）, 下面显示的命令规则是在Makefile中：</p>
<div class="highlight-Makefile notranslate"><div class="highlight"><pre><span></span><span class="nv">SYSDIR</span><span class="o">=</span><span class="k">$(</span>shell<span class="w"> </span><span class="nb">pwd</span><span class="k">)</span>
<span class="nv">CROSS_HOST</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$MACHTYPE</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s2">&quot;s/</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$MACHTYPE</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d-<span class="w"> </span>-f2<span class="k">)</span><span class="s2">/cross/&quot;</span><span class="k">)</span><span class="w"> </span><span class="c1">#x86_64-cross-linux-gnu</span>
<span class="nv">CROSS_TARGET</span><span class="o">=</span>loongarch64-linux-gnu<span class="w"> </span><span class="c1">#表示我们的目标组合</span>
<span class="nv">MABI</span><span class="o">=</span>lp64d
<span class="nv">BUILD64</span><span class="o">=</span>-mabi<span class="o">=</span>lp64d
<span class="nv">CROSS_BUILD_DIR</span><span class="o">=</span>cross-tools-all-202612<span class="w"> </span><span class="c1">#用于安装交叉编译器的目录在：$(SYSDIR)/$(CROSS_BUILD_DIR)</span>
</pre></div>
</div>
<section id="linux-header">
<h4><span class="section-number">2.1.4.1.1. </span>linux header的安装<a class="headerlink" href="#linux-header" title="Link to this heading"></a></h4>
<div class="highlight-Makefile notranslate"><div class="highlight"><pre><span></span><span class="nv">LINUX_DIR</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span>linux-6.7
<span class="nf">linux_header</span><span class="o">:</span>
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>LINUX_DIR<span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>mrproper
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>LINUX_DIR<span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span><span class="nv">ARCH</span><span class="o">=</span>loongarch<span class="w"> </span><span class="nv">INSTALL_HDR_PATH</span><span class="o">=</span>dest<span class="w"> </span>headers_install
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>LINUX_DIR<span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>find<span class="w"> </span>dest/include<span class="w"> </span>-name<span class="w"> </span><span class="s1">&#39;.*&#39;</span><span class="w"> </span>-delete
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>LINUX_DIR<span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mkdir<span class="w"> </span>-pv<span class="w"> </span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span>/sysroot/usr/include
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>LINUX_DIR<span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>cp<span class="w"> </span>-rv<span class="w"> </span>dest/include/*<span class="w"> </span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span>/sysroot/usr/include
</pre></div>
</div>
<p>编译完成后会在<code class="docutils literal notranslate"><span class="pre">cross-tools-all-202612/sysroot/usr/include</span></code>安装相关的头文件等</p>
</section>
<section id="binutils">
<h4><span class="section-number">2.1.4.1.2. </span>binutils的编译和安装<a class="headerlink" href="#binutils" title="Link to this heading"></a></h4>
<div class="highlight-Makefile notranslate"><div class="highlight"><pre><span></span><span class="nv">BINUTILS</span><span class="w">  </span><span class="o">:=</span><span class="w"> </span>binutils-2.45
<span class="nf">binutils</span><span class="o">:</span>
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>BINUTILS<span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>gdb*<span class="w"> </span>libdecnumber<span class="w"> </span>readline<span class="w"> </span>sim
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>BINUTILS<span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>tools-build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mkdir<span class="w"> </span>tools-build
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>BINUTILS<span class="k">)</span>/tools-build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">CC</span><span class="o">=</span>gcc<span class="w"> </span><span class="nv">AR</span><span class="o">=</span>ar<span class="w"> </span><span class="nv">AS</span><span class="o">=</span>as<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>../configure<span class="w"> </span>--prefix<span class="o">=</span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span><span class="w"> </span>--build<span class="o">=</span><span class="si">${</span><span class="nv">CROSS_HOST</span><span class="si">}</span><span class="w"> </span>--host<span class="o">=</span><span class="si">${</span><span class="nv">CROSS_HOST</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">                    </span>--target<span class="o">=</span><span class="si">${</span><span class="nv">CROSS_TARGET</span><span class="si">}</span><span class="w"> </span>--with-sysroot<span class="o">=</span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span>/sysroot<span class="w"> </span>--disable-nls<span class="w"> </span><span class="se">\</span>
<span class="w">                    </span>--disable-static<span class="w"> </span>--enable-64-bit-bfd
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>BINUTILS<span class="k">)</span>/tools-build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>configure-host<span class="w"> </span><span class="si">${</span><span class="nv">JOBS</span><span class="si">}</span>
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>BINUTILS<span class="k">)</span>/tools-build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span><span class="si">${</span><span class="nv">JOBS</span><span class="si">}</span>
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>BINUTILS<span class="k">)</span>/tools-build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>install-strip
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>BINUTILS<span class="k">)</span>/tools-build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>cp<span class="w"> </span>-v<span class="w"> </span>../include/libiberty.h<span class="w"> </span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span>/sysroot/usr/include
</pre></div>
</div>
</section>
<section id="gmp">
<h4><span class="section-number">2.1.4.1.3. </span>GMP的编译和安装<a class="headerlink" href="#gmp" title="Link to this heading"></a></h4>
<div class="highlight-Makefile notranslate"><div class="highlight"><pre><span></span><span class="nv">GMP</span><span class="w">     </span><span class="o">:=</span><span class="w"> </span>gmp-6.3.0
<span class="nf">gmp</span><span class="o">:</span>
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>GMP<span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>build
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>GMP<span class="k">)</span>/build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>../configure<span class="w"> </span>--prefix<span class="o">=</span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span><span class="w"> </span>--enable-cxx<span class="w"> </span>--disable-static
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>GMP<span class="k">)</span>/build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span><span class="si">${</span><span class="nv">JOBS</span><span class="si">}</span>
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>GMP<span class="k">)</span>/build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>install
</pre></div>
</div>
</section>
<section id="mpfr">
<h4><span class="section-number">2.1.4.1.4. </span>MPFR的编译和安装<a class="headerlink" href="#mpfr" title="Link to this heading"></a></h4>
<div class="highlight-Makefile notranslate"><div class="highlight"><pre><span></span><span class="nv">MPFR</span><span class="w">    </span><span class="o">:=</span><span class="w"> </span>mpfr-4.2.2
<span class="nf">mpfr</span><span class="o">:</span>
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>MPFR<span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>build
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>MPFR<span class="k">)</span>/build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>../configure<span class="w"> </span>--prefix<span class="o">=</span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span><span class="w"> </span>--disable-static<span class="w"> </span>--with-gmp<span class="o">=</span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span>
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>MPFR<span class="k">)</span>/build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span><span class="si">${</span><span class="nv">JOBS</span><span class="si">}</span>
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>MPFR<span class="k">)</span>/build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>install
</pre></div>
</div>
</section>
<section id="mpc">
<h4><span class="section-number">2.1.4.1.5. </span>MPC的编译和安装<a class="headerlink" href="#mpc" title="Link to this heading"></a></h4>
<div class="highlight-Makefile notranslate"><div class="highlight"><pre><span></span><span class="nv">MPC</span><span class="w">     </span><span class="o">:=</span><span class="w"> </span>mpc-1.3.1
<span class="nf">mpc</span><span class="o">:</span>
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>MPC<span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>build
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>MPC<span class="k">)</span>/build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>../configure<span class="w"> </span>--prefix<span class="o">=</span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span><span class="w"> </span>--disable-static<span class="w"> </span>--with-gmp<span class="o">=</span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span>
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>MPC<span class="k">)</span>/build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span><span class="si">${</span><span class="nv">JOBS</span><span class="si">}</span>
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>MPC<span class="k">)</span>/build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>install
</pre></div>
</div>
</section>
<section id="id13">
<h4><span class="section-number">2.1.4.1.6. </span>简易版GCC的编译和安装<a class="headerlink" href="#id13" title="Link to this heading"></a></h4>
<p>制作交叉编译器中的GCC，第一次编译交叉工具链的GCC需要采用精简方式进行编译和安装，否则会因为缺少目标系统的C库而导致部分内容编译链接失败</p>
<div class="highlight-Makefile notranslate"><div class="highlight"><pre><span></span><span class="nv">GCC</span><span class="w">       </span><span class="o">:=</span><span class="w"> </span>gcc-15.2.0
<span class="nf">gcc-simp</span><span class="o">:</span>
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>GCC<span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>tools-build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mkdir<span class="w"> </span>tools-build
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>GCC<span class="k">)</span>/tools-build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">AR</span><span class="o">=</span>ar<span class="w"> </span><span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">&quot;-Wl,-rpath,</span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span><span class="s2">/</span><span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span><span class="s2">/lib&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">   </span>../configure<span class="w"> </span>--prefix<span class="o">=</span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span><span class="w"> </span>--build<span class="o">=</span><span class="si">${</span><span class="nv">CROSS_HOST</span><span class="si">}</span><span class="w"> </span>--host<span class="o">=</span><span class="si">${</span><span class="nv">CROSS_HOST</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--target<span class="o">=</span><span class="si">${</span><span class="nv">CROSS_TARGET</span><span class="si">}</span><span class="w"> </span>--disable-nls<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--with-mpfr<span class="o">=</span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span><span class="w"> </span>--with-gmp<span class="o">=</span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--with-mpc<span class="o">=</span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--with-sysroot<span class="o">=</span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span>/sysroot<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--disable-decimal-float<span class="w"> </span>--disable-libgomp<span class="w"> </span>--disable-libitm<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--disable-libsanitizer<span class="w"> </span>--disable-libquadmath<span class="w"> </span>--enable-threads<span class="o">=</span>posix<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--disable-target-zlib<span class="w"> </span>--with-system-zlib<span class="w"> </span>--enable-checking<span class="o">=</span>release<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--enable-tls<span class="w"> </span>--enable-initfini-array<span class="w"> </span>--enable-__cxa_atexit<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--disable-libgcc<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--with-simd<span class="o">=</span>none<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--enable-default-pie<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--enable-languages<span class="o">=</span>c,c++,fortran,objc,obj-c++,lto
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>GCC<span class="k">)</span>/tools-build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>all-gcc<span class="w"> </span>all-target-libgcc<span class="w"> </span><span class="si">${</span><span class="nv">JOBS</span><span class="si">}</span>
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>GCC<span class="k">)</span>/tools-build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>install-strip-gcc<span class="w"> </span>install-strip-target-libgcc
</pre></div>
</div>
</section>
<section id="glibc">
<h4><span class="section-number">2.1.4.1.7. </span>GlibC的编译和安装<a class="headerlink" href="#glibc" title="Link to this heading"></a></h4>
<div class="highlight-Makefile notranslate"><div class="highlight"><pre><span></span><span class="nv">GLIBC</span><span class="w">     </span><span class="o">:=</span><span class="w"> </span>glibc-2.42
<span class="nf">glibc</span><span class="o">:</span>
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>GLIBC<span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;s@5.15.0@4.15.0@g&quot;</span><span class="w"> </span>sysdeps/unix/sysv/linux/loongarch/configure<span class="o">{</span>,.ac<span class="o">}</span>
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>GLIBC<span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>build-64<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mkdir<span class="w"> </span>-v<span class="w"> </span>build-64
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>GLIBC<span class="k">)</span>/build-64<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">BUILD_CC</span><span class="o">=</span><span class="s2">&quot;gcc&quot;</span><span class="w"> </span><span class="nv">CC</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CROSS_TARGET</span><span class="si">}</span><span class="s2">-gcc </span><span class="si">${</span><span class="nv">BUILD64</span><span class="si">}</span><span class="s2"> -mstrict-align&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span><span class="nv">CXX</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CROSS_TARGET</span><span class="si">}</span><span class="s2">-gcc </span><span class="si">${</span><span class="nv">BUILD64</span><span class="si">}</span><span class="s2"> -mstrict-align&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span><span class="nv">AR</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CROSS_TARGET</span><span class="si">}</span><span class="s2">-ar&quot;</span><span class="w"> </span><span class="nv">RANLIB</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CROSS_TARGET</span><span class="si">}</span><span class="s2">-ranlib&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>../configure<span class="w"> </span>--prefix<span class="o">=</span>/usr<span class="w"> </span>--host<span class="o">=</span><span class="si">${</span><span class="nv">CROSS_TARGET</span><span class="si">}</span><span class="w"> </span>--build<span class="o">=</span><span class="si">${</span><span class="nv">CROSS_HOST</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">                    </span>--libdir<span class="o">=</span>/usr/lib64<span class="w"> </span>--libexecdir<span class="o">=</span>/usr/lib64/glibc<span class="w"> </span><span class="se">\</span>
<span class="w">                    </span>--with-binutils<span class="o">=</span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span>/bin<span class="w"> </span><span class="se">\</span>
<span class="w">                    </span>--with-headers<span class="o">=</span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span>/sysroot/usr/include<span class="w"> </span><span class="se">\</span>
<span class="w">                    </span>--enable-stack-protector<span class="o">=</span>strong<span class="w"> </span><span class="se">\</span>
<span class="w">                    </span>--enable-add-ons<span class="w"> </span><span class="se">\</span>
<span class="w">                    </span>--enable-crypt<span class="w"> </span><span class="se">\</span>
<span class="w">                    </span>--disable-werror<span class="w"> </span><span class="nv">libc_cv_slibdir</span><span class="o">=</span>/usr/lib64<span class="w"> </span><span class="se">\</span>
<span class="w">                    </span>--enable-kernel<span class="o">=</span><span class="m">4</span>.15
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>GLIBC<span class="k">)</span>/build-64<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span><span class="si">${</span><span class="nv">JOBS</span><span class="si">}</span>
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>GLIBC<span class="k">)</span>/build-64<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span><span class="nv">DESTDIR</span><span class="o">=</span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span>/sysroot<span class="w"> </span>install
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>GLIBC<span class="k">)</span>/build-64<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>cp<span class="w"> </span>-v<span class="w"> </span>../nscd/nscd.conf<span class="w"> </span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span>/sysroot/etc/nscd.conf
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>GLIBC<span class="k">)</span>/build-64<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mkdir<span class="w"> </span>-pv<span class="w"> </span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span>/sysroot/var/cache/nscd
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>GLIBC<span class="k">)</span>/build-64<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>install<span class="w"> </span>-v<span class="w"> </span>-Dm644<span class="w"> </span>../nscd/nscd.tmpfiles<span class="w"> </span><span class="se">\</span>
<span class="w">                     </span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span>/sysroot/usr/lib/tmpfiles.d/nscd.conf
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>GLIBC<span class="k">)</span>/build-64<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>install<span class="w"> </span>-v<span class="w"> </span>-Dm644<span class="w"> </span>../nscd/nscd.service<span class="w"> </span><span class="se">\</span>
<span class="w">                        </span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span>/sysroot/usr/lib/systemd/system/nscd.service
</pre></div>
</div>
</section>
<section id="id14">
<h4><span class="section-number">2.1.4.1.8. </span>完整版GCC的编译和安装<a class="headerlink" href="#id14" title="Link to this heading"></a></h4>
<div class="highlight-Makefile notranslate"><div class="highlight"><pre><span></span><span class="nv">GCC</span><span class="w">       </span><span class="o">:=</span><span class="w"> </span>gcc-15.2.0
<span class="nf">gcc</span><span class="o">:</span>
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>GCC<span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>tools-build-all<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mkdir<span class="w"> </span>tools-build-all
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>GCC<span class="k">)</span>/tools-build-all<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">AR</span><span class="o">=</span>ar<span class="w"> </span><span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">&quot;-Wl,-rpath,</span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span><span class="s2">/</span><span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span><span class="s2">/lib&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">      </span>../configure<span class="w"> </span>--prefix<span class="o">=</span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span><span class="w"> </span>--build<span class="o">=</span><span class="si">${</span><span class="nv">CROSS_HOST</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">                   </span>--host<span class="o">=</span><span class="si">${</span><span class="nv">CROSS_HOST</span><span class="si">}</span><span class="w"> </span>--target<span class="o">=</span><span class="si">${</span><span class="nv">CROSS_TARGET</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">                   </span>--with-sysroot<span class="o">=</span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span>/sysroot<span class="w"> </span>--with-mpfr<span class="o">=</span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">                   </span>--with-gmp<span class="o">=</span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span><span class="w"> </span>--with-mpc<span class="o">=</span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">                   </span>--enable-__cxa_atexit<span class="w"> </span>--enable-threads<span class="o">=</span>posix<span class="w"> </span>--with-system-zlib<span class="w"> </span><span class="se">\</span>
<span class="w">                   </span>--enable-libstdcxx-time<span class="w"> </span>--enable-checking<span class="o">=</span>release<span class="w"> </span><span class="se">\</span>
<span class="w">                   </span>--disable-libssp<span class="w"> </span><span class="se">\</span>
<span class="w">                   </span>--with-simd<span class="o">=</span>none<span class="w"> </span><span class="se">\</span>
<span class="w">                   </span>--enable-default-pie<span class="w"> </span><span class="se">\</span>
<span class="w">                   </span>--enable-languages<span class="o">=</span>c,c++,fortran,objc,obj-c++,lto
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>GCC<span class="k">)</span>/tools-build-all<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span><span class="si">${</span><span class="nv">JOBS</span><span class="si">}</span>
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>GCC<span class="k">)</span>/tools-build-all<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>install-strip
</pre></div>
</div>
<p>此时安装的GCC会替换掉我们在上面安装的简易版GCC。</p>
</section>
<section id="gdb">
<h4><span class="section-number">2.1.4.1.9. </span>GDB的编译和安装<a class="headerlink" href="#gdb" title="Link to this heading"></a></h4>
<div class="highlight-Makefile notranslate"><div class="highlight"><pre><span></span><span class="nv">GDB</span><span class="w">       </span><span class="o">:=</span><span class="w"> </span>gdb-16.3
<span class="nf">gdb</span><span class="o">:</span>
<span class="w">   </span>rm<span class="w"> </span>-rf<span class="w"> </span><span class="k">$(</span>GDB<span class="k">)</span>/build
<span class="w">   </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="k">$(</span>GDB<span class="k">)</span>/build
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>GDB<span class="k">)</span>/build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>../configure<span class="w"> </span>--prefix<span class="o">=</span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">                      </span>--build<span class="o">=</span><span class="si">${</span><span class="nv">CROSS_HOST</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">                     </span>--host<span class="o">=</span><span class="si">${</span><span class="nv">CROSS_HOST</span><span class="si">}</span><span class="w"> </span>--target<span class="o">=</span><span class="si">${</span><span class="nv">CROSS_TARGET</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">                     </span>--with-sysroot<span class="o">=</span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="k">$(</span>CROSS_BUILD_DIR<span class="k">)</span>/sysroot<span class="w"> </span>--enable-64-bit-bfd
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>GDB<span class="k">)</span>/build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span><span class="si">${</span><span class="nv">JOBS</span><span class="si">}</span>
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>GDB<span class="k">)</span>/build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span><span class="nv">DESTDIR</span><span class="o">=</span><span class="si">${</span><span class="nv">SYSDIR</span><span class="si">}</span>/<span class="si">${</span><span class="nv">CROSS_BUILD_DIR</span><span class="si">}</span><span class="w"> </span>install
</pre></div>
</div>
</section>
<section id="id15">
<h4><span class="section-number">2.1.4.1.10. </span>特殊说明<a class="headerlink" href="#id15" title="Link to this heading"></a></h4>
<p>LoongArch的GCC上游在版本13以后，再编译GCC的时候，会默认生成向量指令，即产生参数<code class="docutils literal notranslate"><span class="pre">-msimd=lsx</span></code>，
我们可以使用-v来查看验证</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>loongarch64-linux-gnu-gcc<span class="w"> </span>main.c<span class="w"> </span>-o<span class="w"> </span>main<span class="w"> </span>-v
</pre></div>
</div>
<p>生成的详细命令参数如下（省略了不必要的部分）</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gcc<span class="w"> </span>version<span class="w"> </span><span class="m">14</span>.1.0<span class="w"> </span><span class="o">(</span>GCC<span class="o">)</span><span class="w"> </span>
<span class="nv">COLLECT_GCC_OPTIONS</span><span class="o">=</span><span class="s1">&#39;-o&#39;</span><span class="w"> </span><span class="s1">&#39;main&#39;</span><span class="w"> </span><span class="s1">&#39;-v&#39;</span><span class="w"> </span><span class="s1">&#39;-mabi=lp64d&#39;</span><span class="w"> </span><span class="s1">&#39;-march=la64v1.0&#39;</span><span class="w"> </span><span class="s1">&#39;-mfpu=64&#39;</span><span class="w"> </span><span class="s1">&#39;-msimd=none&#39;</span><span class="w"> </span><span class="s1">&#39;-mcmodel=normal&#39;</span><span class="w"> </span><span class="s1">&#39;-mtune=generic&#39;</span>
<span class="w"> </span>/home/airxs/local/gcc-14.1.0-loongarch64-linux-gnu/bin/../libexec/gcc/loongarch64-linux-gnu/14.1.0/cc1<span class="w"> </span>-quiet<span class="w"> </span>-v<span class="w"> </span>-iprefix<span class="w"> </span>/home/airxs/local/gcc-14.1.0-loongarch64-linux-gnu/bin/../lib/gcc/loongarch64-linux-gnu/14.1.0/<span class="w"> </span>-isysroot<span class="w"> </span>/home/airxs/local/gcc-14.1.0-loongarch64-linux-gnu/bin/../sysroot<span class="w"> </span>main.c<span class="w"> </span>-quiet<span class="w"> </span>-dumpbase<span class="w"> </span>main.c<span class="w"> </span>-dumpbase-ext<span class="w"> </span>.c<span class="w"> </span>-mabi<span class="o">=</span>lp64d<span class="w"> </span>-march<span class="o">=</span>la64v1.0<span class="w"> </span>-mfpu<span class="o">=</span><span class="m">64</span><span class="w"> </span>-msimd<span class="o">=</span>none<span class="w"> </span>-mcmodel<span class="o">=</span>normal<span class="w"> </span>-mtune<span class="o">=</span>generic<span class="w"> </span>-version<span class="w"> </span>-o<span class="w"> </span>/tmp/ccaWuA6Z.s
</pre></div>
</div>
<p>如果想在编译GCC的时候，关闭默认向量指令的生成，可以使用参数</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--with-simd<span class="o">=</span>none
</pre></div>
</div>
<p>比如上面我们在编译的时候，默认关闭了向量的生成。</p>
<div class="admonition caution">
<p class="admonition-title">小心</p>
<p>–with-simd=none它只是在编译在<strong>默认情况下</strong>关闭生成向量指令，但是还是可以使用命令参数<code class="docutils literal notranslate"><span class="pre">-msimd=</span></code>来
手动的指定可以产生128位向量。</p>
<p>我们用上面使用<code class="docutils literal notranslate"><span class="pre">--with-simd=none</span></code>生成的交叉编译器，来生成具有向量指令的可执行文件：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>loongarch64-linux-musl-gcc<span class="w"> </span>main.c<span class="w"> </span>-o<span class="w"> </span>main<span class="w"> </span>-msimd<span class="o">=</span>lsx<span class="w"> </span>-v
</pre></div>
</div>
<p>反汇编时，我们可以看见使用了<code class="docutils literal notranslate"><span class="pre">vld和vst</span></code>等向量指令。</p>
</div>
</section>
</section>
<section id="loongarch64-linux-musl-sf">
<h3><span class="section-number">2.1.4.2. </span>如何编译loongarch64-linux-musl[sf]<a class="headerlink" href="#loongarch64-linux-musl-sf" title="Link to this heading"></a></h3>
<p>基于musl-c库的交叉编译器编译顺序和上述的基本一致，我们为了方便，将其做了封装，可以直接使用编译仓库。</p>
<ol class="arabic simple">
<li><p>克隆musl-cross-make仓库</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/lyw19b/musl-cross-make.git
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>复制配置文件</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>musl-cross-make<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>cp<span class="w"> </span>config.mak.loongarch64<span class="w"> </span>config.mak
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>修改配置文件，指令需要编译的工具链版本</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#修改配置文件 config.mak</span>
<span class="nv">BINUTILS_VER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span>.25.1
<span class="nv">GCC_VER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span>.2.0
<span class="nv">GDB_VER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span>.3
<span class="nv">MUSL_VER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>.2.5
<span class="nv">GMP_VER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span>.3.0
<span class="nv">MPC_VER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>.3.1
<span class="nv">MPFR_VER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span>.2.2
<span class="nv">LINUX_VER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span>.7
</pre></div>
</div>
<p>如果不指定版本，会使用默认的版本编译。</p>
<ol class="arabic simple" start="4">
<li><p>定制配置参数
按照需求设置，如果不设置按照默认的参数编译。</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># COMMON_CONFIG 编译各个工具链时都用的配置，比如HOST编译器参数等</span>
<span class="nv">COMMON_CONFIG</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">&quot;-g0 -Os&quot;</span><span class="w"> </span><span class="nv">CXXFLAGS</span><span class="o">=</span><span class="s2">&quot;-g0 -Os&quot;</span><span class="w"> </span><span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">&quot;-s&quot;</span>

<span class="c1"># GCC_CONFIG 特定针对GCC编译时的参数。</span>
<span class="nv">GCC_CONFIG</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>--disable-libquadmath<span class="w"> </span>--disable-decimal-float
<span class="nv">GCC_CONFIG</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>--disable-libitm
<span class="nv">GCC_CONFIG</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>--disable-fixed-point
<span class="nv">GCC_CONFIG</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>--disable-lto

<span class="nv">GCC_CONFIG</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>--enable-languages<span class="o">=</span>c,c++<span class="w"> </span>--enable-checking<span class="o">=</span>release
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>选择支持浮点还是禁止浮点指令</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 修改配置文件 config.mak</span>

<span class="c1"># 1. 如果时禁止浮点使用下面的TARGET </span>
<span class="nv">TARGET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>loongarch64-linux-muslsf

<span class="c1"># 2. 如果使用支持生成浮点指令的编译器使用下面的TARGET</span>
<span class="nv">TARGET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>loongarch64-linux-musl
</pre></div>
</div>
<p>编译之后，会在output中生成我们需要的交叉编译器，可以在out/bin/测试是否正常</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>shell&gt;<span class="w"> </span>./bin/loongarch64-linux-musl-gcc<span class="w"> </span>-v
<span class="c1"># Using built-in specs.</span>
<span class="c1"># COLLECT_GCC=./bin/loongarch64-linux-musl-gcc</span>
<span class="c1"># COLLECT_LTO_WRAPPER=/home/airxs/user/toolchains/musl-cross-make/loongarch64-linux-musl-gcc-15.2.0/bin/../libexec/gcc/loongarch64-linux-musl/15.2.0/lto-wrapper</span>
<span class="c1"># Target: loongarch64-linux-musl</span>
<span class="c1"># Configured with: ../src_gcc/configure --enable-languages=c,c++ --with-simd=none --enable-languages=c,c++ --enable-checking=release --disable-bootstrap --disable-assembly --disable-werror --target=loongarch64-linux-musl --prefix= --libdir=/lib --disable-multilib --with-sysroot=/sysroot --enable-tls --disable-libmudflap --disable-libsanitizer --disable-gnu-indirect-function --disable-libmpx --enable-initfini-array --enable-libstdcxx-time=rt --with-build-sysroot=/home/airxs/user/toolchains/musl-cross-make/build/local/loongarch64-linux-musl/obj_sysroot AR_FOR_TARGET=/home/airxs/user/toolchains/musl-cross-make/build/local/loongarch64-linux-musl/obj_binutils/binutils/ar AS_FOR_TARGET=/home/airxs/user/toolchains/musl-cross-make/build/local/loongarch64-linux-musl/obj_binutils/gas/as-new LD_FOR_TARGET=/home/airxs/user/toolchains/musl-cross-make/build/local/loongarch64-linux-musl/obj_binutils/ld/ld-new NM_FOR_TARGET=/home/airxs/user/toolchains/musl-cross-make/build/local/loongarch64-linux-musl/obj_binutils/binutils/nm-new OBJCOPY_FOR_TARGET=/home/airxs/user/toolchains/musl-cross-make/build/local/loongarch64-linux-musl/obj_binutils/binutils/objcopy OBJDUMP_FOR_TARGET=/home/airxs/user/toolchains/musl-cross-make/build/local/loongarch64-linux-musl/obj_binutils/binutils/objdump RANLIB_FOR_TARGET=/home/airxs/user/toolchains/musl-cross-make/build/local/loongarch64-linux-musl/obj_binutils/binutils/ranlib READELF_FOR_TARGET=/home/airxs/user/toolchains/musl-cross-make/build/local/loongarch64-linux-musl/obj_binutils/binutils/readelf STRIP_FOR_TARGET=/home/airxs/user/toolchains/musl-cross-make/build/local/loongarch64-linux-musl/obj_binutils/binutils/strip-new --build=x86_64-pc-linux-gnu --host=x86_64-pc-linux-gnu</span>
<span class="c1"># Thread model: posix</span>
<span class="c1"># Supported LTO compression algorithms: zlib zstd</span>
<span class="c1"># gcc version 15.2.0 (GCC) </span>
</pre></div>
</div>
</section>
<section id="crtn-crti-crtbegin-crtend">
<h3><span class="section-number">2.1.4.3. </span>crtn, crti, crtbegin, crtend有什么区别<a class="headerlink" href="#crtn-crti-crtbegin-crtend" title="Link to this heading"></a></h3>
<p>在 Linux 系统中，<code class="docutils literal notranslate"><span class="pre">crti.o</span></code>、<code class="docutils literal notranslate"><span class="pre">crtn.o</span></code>、<code class="docutils literal notranslate"><span class="pre">crtbegin.o</span></code> 和 <code class="docutils literal notranslate"><span class="pre">crtend.o</span></code> 是 C/C++ 运行时库（CRT）的核心组件，负责程序启动和终止时的初始化与清理工作。它们的区别主要体现在功能定位、作用阶段和链接顺序上：</p>
<hr class="docutils" />
<section id="id16">
<h4><span class="section-number">2.1.4.3.1. </span>功能定位与作用阶段<a class="headerlink" href="#id16" title="Link to this heading"></a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>文件</strong></p></th>
<th class="head"><p><strong>功能定位</strong></p></th>
<th class="head"><p><strong>作用阶段</strong></p></th>
<th class="head"><p><strong>关联段（Section）</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>crti.o</strong></p></td>
<td><p>定义初始化框架的<strong>入口</strong>（Prologue），设置 <code class="docutils literal notranslate"><span class="pre">.init</span></code> 段的起始代码，用于全局构造函数注册</p></td>
<td><p>程序启动时，<code class="docutils literal notranslate"><span class="pre">main()</span></code> 之前</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">.init</span></code> 段开头</p></td>
</tr>
<tr class="row-odd"><td><p><strong>crtn.o</strong></p></td>
<td><p>定义终止框架的<strong>出口</strong>（Epilogue），设置 <code class="docutils literal notranslate"><span class="pre">.fini</span></code> 段的结束代码，用于全局析构函数注册</p></td>
<td><p>程序退出时，<code class="docutils literal notranslate"><span class="pre">main()</span></code> 之后</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">.fini</span></code> 段结尾</p></td>
</tr>
<tr class="row-even"><td><p><strong>crtbegin.o</strong></p></td>
<td><p>为 C++ 全局构造函数提供支持，将 <code class="docutils literal notranslate"><span class="pre">.ctors</span></code> 段中的构造函数列表插入到 <code class="docutils literal notranslate"><span class="pre">.init</span></code> 段末尾</p></td>
<td><p>全局构造函数注册阶段</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">.ctors</span></code> 段（或 <code class="docutils literal notranslate"><span class="pre">.init_array</span></code>）</p></td>
</tr>
<tr class="row-odd"><td><p><strong>crtend.o</strong></p></td>
<td><p>为 C++ 全局析构函数提供支持，将 <code class="docutils literal notranslate"><span class="pre">.dtors</span></code> 段中的析构函数列表插入到 <code class="docutils literal notranslate"><span class="pre">.fini</span></code> 段开头</p></td>
<td><p>全局析构函数注册阶段</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">.dtors</span></code> 段（或 <code class="docutils literal notranslate"><span class="pre">.fini_array</span></code>）</p></td>
</tr>
</tbody>
</table>
</section>
<hr class="docutils" />
<section id="id17">
<h4><span class="section-number">2.1.4.3.2. </span>具体职责对比<a class="headerlink" href="#id17" title="Link to this heading"></a></h4>
<section id="crti-o-crtn-o">
<h5><span class="section-number">2.1.4.3.2.1. </span>1. <strong>crti.o 与 crtn.o</strong><a class="headerlink" href="#crti-o-crtn-o" title="Link to this heading"></a></h5>
<ul class="simple">
<li><p><strong>crti.o</strong></p>
<ul>
<li><p>提供 <code class="docutils literal notranslate"><span class="pre">.init</span></code> 段的<strong>起始代码</strong>，负责调用 <code class="docutils literal notranslate"><span class="pre">__init</span></code> 函数（由编译器生成），该函数会遍历 <code class="docutils literal notranslate"><span class="pre">.ctors</span></code> 段中的构造函数指针并执行。</p></li>
<li><p>包含平台相关的初始化代码（如设置 CPU 特性、初始化 TLS 等）。</p></li>
</ul>
</li>
<li><p><strong>crtn.o</strong></p>
<ul>
<li><p>提供 <code class="docutils literal notranslate"><span class="pre">.fini</span></code> 段的<strong>结束代码</strong>，负责调用 <code class="docutils literal notranslate"><span class="pre">__fini</span></code> 函数，该函数会逆序执行 <code class="docutils literal notranslate"><span class="pre">.dtors</span></code> 段中的析构函数指针。</p></li>
<li><p>确保程序退出前释放全局资源（如关闭文件描述符、释放静态内存池）。</p></li>
</ul>
</li>
</ul>
</section>
<section id="crtbegin-o-crtend-o">
<h5><span class="section-number">2.1.4.3.2.2. </span>2. <strong>crtbegin.o 与 crtend.o</strong><a class="headerlink" href="#crtbegin-o-crtend-o" title="Link to this heading"></a></h5>
<ul class="simple">
<li><p><strong>crtbegin.o</strong></p>
<ul>
<li><p>在链接时插入到 <code class="docutils literal notranslate"><span class="pre">.init</span></code> 段末尾，收集所有 C++ 全局对象的构造函数地址，形成 <code class="docutils literal notranslate"><span class="pre">.ctors</span></code> 段的函数指针列表。</p></li>
<li><p>支持 C++ 静态对象的初始化（如 <code class="docutils literal notranslate"><span class="pre">static</span> <span class="pre">MyClass</span> <span class="pre">obj;</span></code>）。</p></li>
</ul>
</li>
<li><p><strong>crtend.o</strong></p>
<ul>
<li><p>在链接时插入到 <code class="docutils literal notranslate"><span class="pre">.fini</span></code> 段开头，收集所有 C++ 全局对象的析构函数地址，形成 <code class="docutils literal notranslate"><span class="pre">.dtors</span></code> 段的函数指针列表。</p></li>
<li><p>确保析构函数按与构造函数<strong>相反的顺序</strong>执行（逆序析构规则）。</p></li>
</ul>
</li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="id18">
<h4><span class="section-number">2.1.4.3.3. </span>链接顺序与依赖关系<a class="headerlink" href="#id18" title="Link to this heading"></a></h4>
<p>在标准 Linux 平台下，链接器（<code class="docutils literal notranslate"><span class="pre">ld</span></code>）的默认顺序为：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>crt1.o<span class="w"> </span>→<span class="w"> </span>crti.o<span class="w"> </span>→<span class="w"> </span>crtbegin.o<span class="w"> </span>→<span class="w"> </span>用户目标文件<span class="w"> </span>→<span class="w"> </span>系统库<span class="w"> </span>→<span class="w"> </span>crtend.o<span class="w"> </span>→<span class="w"> </span>crtn.o
</pre></div>
</div>
<ul class="simple">
<li><p><strong>crt1.o</strong>：包含入口符号 <code class="docutils literal notranslate"><span class="pre">_start</span></code>，负责调用 <code class="docutils literal notranslate"><span class="pre">__libc_start_main</span></code> 初始化 libc 并跳转到 <code class="docutils literal notranslate"><span class="pre">main()</span></code>。</p></li>
<li><p><strong>crtbegin.o/crtend.o</strong>：由 GCC 提供，仅参与 C++ 全局对象的构造/析构流程，与 C 语言无关。</p></li>
<li><p><strong>crti.o/crtn.o</strong>：由 glibc 提供，是所有 C/C++ 程序启动和终止的必要组件。</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="id19">
<h4><span class="section-number">2.1.4.3.4. </span>特殊变体与场景<a class="headerlink" href="#id19" title="Link to this heading"></a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>文件</strong></p></th>
<th class="head"><p><strong>变体</strong></p></th>
<th class="head"><p><strong>适用场景</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>crtbegin.o</strong></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">crtbeginS.o</span></code></p></td>
<td><p>用于生成位置无关代码（PIC）的共享库（如 <code class="docutils literal notranslate"><span class="pre">.so</span></code> 文件）。</p></td>
</tr>
<tr class="row-odd"><td><p><strong>crtend.o</strong></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">crtendS.o</span></code></p></td>
<td><p>共享库的终止代码，确保动态加载时析构函数正确注册。</p></td>
</tr>
<tr class="row-even"><td><p><strong>crt1.o</strong></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Scrt1.o</span></code></p></td>
<td><p>生成位置无关可执行文件（PIE）时替代 <code class="docutils literal notranslate"><span class="pre">crt1.o</span></code>。</p></td>
</tr>
</tbody>
</table>
</section>
<hr class="docutils" />
<section id="id20">
<h4><span class="section-number">2.1.4.3.5. </span>实际示例分析<a class="headerlink" href="#id20" title="Link to this heading"></a></h4>
<p>以 C++ 程序为例：</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 全局对象构造函数</span>
<span class="n">__attribute__</span><span class="p">((</span><span class="n">constructor</span><span class="p">))</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* ... */</span><span class="w"> </span><span class="p">}</span>
<span class="c1">// 全局对象析构函数</span>
<span class="n">__attribute__</span><span class="p">((</span><span class="n">destructor</span><span class="p">))</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">cleanup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* ... */</span><span class="w"> </span><span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>链接过程</strong>：</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">crtbegin.o</span></code> 将 <code class="docutils literal notranslate"><span class="pre">init</span></code> 函数地址写入 <code class="docutils literal notranslate"><span class="pre">.ctors</span></code> 段。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">crtend.o</span></code> 将 <code class="docutils literal notranslate"><span class="pre">cleanup</span></code> 函数地址写入 <code class="docutils literal notranslate"><span class="pre">.dtors</span></code> 段。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">crti.o</span></code> 的 <code class="docutils literal notranslate"><span class="pre">.init</span></code> 段代码遍历 <code class="docutils literal notranslate"><span class="pre">.ctors</span></code> 并调用所有构造函数。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">crtn.o</span></code> 的 <code class="docutils literal notranslate"><span class="pre">.fini</span></code> 段代码逆序遍历 <code class="docutils literal notranslate"><span class="pre">.dtors</span></code> 并调用所有析构函数。</p></li>
</ol>
</li>
</ul>
</section>
<hr class="docutils" />
<section id="id21">
<h4><span class="section-number">2.1.4.3.6. </span>跨平台差异<a class="headerlink" href="#id21" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><strong>Windows</strong>：类似机制由 <code class="docutils literal notranslate"><span class="pre">crt0.obj</span></code> 和 <code class="docutils literal notranslate"><span class="pre">crtlib.lib</span></code> 实现，但文件命名和段管理方式不同。</p></li>
<li><p><strong>嵌入式系统</strong>：可能使用精简版 <code class="docutils literal notranslate"><span class="pre">crt0.s</span></code>，省略动态链接支持。</p></li>
</ul>
<p>通过理解这些文件的分工，开发者可以更精准地控制程序的初始化流程（如自定义构造函数顺序）或优化资源管理。</p>
</section>
</section>
</section>
<section id="id22">
<h2><span class="section-number">2.1.5. </span>常用的参数与选项<a class="headerlink" href="#id22" title="Link to this heading"></a></h2>
<p>本小节主要涉及与GCC相关的扩展内容，在调试查看可执行文件，或者理解操作系统底层的时很有帮助。</p>
<section id="id23">
<h3><span class="section-number">2.1.5.1. </span>GCC常见的参数<a class="headerlink" href="#id23" title="Link to this heading"></a></h3>
<p>我们可以使用<code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">gcc</span></code>来查看详细的参数以及说明。</p>
<p>还可以使用<a class="reference external" href="https://gcc.gnu.org/onlinedocs/gcc/Option-Summary.html">在线文档: GCC Option Summary</a></p>
<p>其次，我们如果想要查看具体的更架构相关的参数，可以使用</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>loongarch64-linux-musl-gcc<span class="w"> </span>--target-help
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">following</span> <span class="n">options</span> <span class="n">are</span> <span class="n">target</span> <span class="n">specific</span><span class="p">:</span>
  <span class="o">--</span><span class="n">param</span><span class="o">=</span><span class="n">loongarch</span><span class="o">-</span><span class="n">vect</span><span class="o">-</span><span class="n">issue</span><span class="o">-</span><span class="n">info</span><span class="o">=&lt;</span><span class="mi">1</span><span class="p">,</span><span class="mi">64</span><span class="o">&gt;</span> <span class="n">Indicate</span> <span class="n">how</span> <span class="n">many</span> <span class="n">non</span> <span class="n">memory</span> <span class="n">access</span> <span class="n">vector</span> <span class="n">instructions</span> <span class="n">can</span> <span class="n">be</span> <span class="n">issued</span> <span class="n">per</span> <span class="n">cycle</span><span class="p">,</span>
                              <span class="n">it</span><span class="s1">&#39;s used in unroll factor determination for autovectorizer.  The default value is 4.</span>
  <span class="o">--</span><span class="n">param</span><span class="o">=</span><span class="n">loongarch</span><span class="o">-</span><span class="n">vect</span><span class="o">-</span><span class="n">unroll</span><span class="o">-</span><span class="n">limit</span><span class="o">=&lt;</span><span class="mi">1</span><span class="p">,</span><span class="mi">64</span><span class="o">&gt;</span> <span class="n">Used</span> <span class="n">to</span> <span class="n">limit</span> <span class="n">unroll</span> <span class="n">factor</span> <span class="n">which</span> <span class="n">indicates</span> <span class="n">how</span> <span class="n">much</span> <span class="n">the</span> <span class="n">autovectorizer</span> <span class="n">may</span>
                              <span class="n">unroll</span> <span class="n">a</span> <span class="n">loop</span><span class="o">.</span>  <span class="n">The</span> <span class="n">default</span> <span class="n">value</span> <span class="ow">is</span> <span class="mf">6.</span>
  <span class="o">-</span><span class="n">G</span><span class="o">&lt;</span><span class="n">number</span><span class="o">&gt;</span>                  <span class="n">Put</span> <span class="k">global</span> <span class="ow">and</span> <span class="n">static</span> <span class="n">data</span> <span class="n">smaller</span> <span class="n">than</span> <span class="o">&lt;</span><span class="n">number</span><span class="o">&gt;</span> <span class="nb">bytes</span> <span class="n">into</span> <span class="n">a</span> <span class="n">special</span> <span class="n">section</span> <span class="p">(</span><span class="n">on</span> <span class="n">some</span> <span class="n">targets</span><span class="p">)</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mabi</span><span class="o">=</span><span class="n">BASEABI</span>               <span class="n">Generate</span> <span class="n">code</span> <span class="n">that</span> <span class="n">conforms</span> <span class="n">to</span> <span class="n">the</span> <span class="n">given</span> <span class="n">BASEABI</span><span class="o">.</span>
  <span class="o">-</span><span class="n">maddr</span><span class="o">-</span><span class="n">reg</span><span class="o">-</span><span class="n">reg</span><span class="o">-</span><span class="n">cost</span><span class="o">=</span>        <span class="o">-</span><span class="n">maddr</span><span class="o">-</span><span class="n">reg</span><span class="o">-</span><span class="n">reg</span><span class="o">-</span><span class="n">cost</span><span class="o">=</span><span class="n">COST</span>  <span class="n">Set</span> <span class="n">the</span> <span class="n">cost</span> <span class="n">of</span> <span class="n">ADDRESS_REG_REG</span> <span class="n">to</span> <span class="n">the</span> <span class="n">value</span> <span class="n">calculated</span> <span class="n">by</span> <span class="n">COST</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mandroid</span>                   <span class="n">Generate</span> <span class="n">code</span> <span class="k">for</span> <span class="n">the</span> <span class="n">Android</span> <span class="n">platform</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mannotate</span><span class="o">-</span><span class="n">tablejump</span>        <span class="n">Annotate</span> <span class="n">table</span> <span class="n">jump</span> <span class="n">instruction</span> <span class="p">(</span><span class="n">jr</span> <span class="p">{</span><span class="n">reg</span><span class="p">})</span> <span class="n">to</span> <span class="n">correlate</span> <span class="n">it</span> <span class="k">with</span> <span class="n">the</span> <span class="n">jump</span> <span class="n">table</span><span class="o">.</span>
  <span class="o">-</span><span class="n">march</span><span class="o">=</span><span class="n">PROCESSOR</span>            <span class="n">Generate</span> <span class="n">code</span> <span class="k">for</span> <span class="n">the</span> <span class="n">given</span> <span class="n">PROCESSOR</span> <span class="n">ISA</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mbionic</span>                    <span class="n">Use</span> <span class="n">Bionic</span> <span class="n">C</span> <span class="n">library</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mbranch</span><span class="o">-</span><span class="n">cost</span><span class="o">=</span><span class="n">COST</span>          <span class="n">Set</span> <span class="n">the</span> <span class="n">cost</span> <span class="n">of</span> <span class="n">branches</span> <span class="n">to</span> <span class="n">roughly</span> <span class="n">COST</span> <span class="n">instructions</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mcheck</span><span class="o">-</span><span class="n">zero</span><span class="o">-</span><span class="n">division</span>       <span class="n">Trap</span> <span class="n">on</span> <span class="n">integer</span> <span class="n">divide</span> <span class="n">by</span> <span class="n">zero</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mcmodel</span><span class="o">=</span>                   <span class="n">Specify</span> <span class="n">the</span> <span class="n">code</span> <span class="n">model</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mcond</span><span class="o">-</span><span class="n">move</span><span class="o">-</span><span class="nb">float</span>           <span class="n">Conditional</span> <span class="n">moves</span> <span class="k">for</span> <span class="nb">float</span> <span class="n">are</span> <span class="n">enabled</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mcond</span><span class="o">-</span><span class="n">move</span><span class="o">-</span><span class="nb">int</span>             <span class="n">Conditional</span> <span class="n">moves</span> <span class="k">for</span> <span class="n">integral</span> <span class="n">are</span> <span class="n">enabled</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mdirect</span><span class="o">-</span><span class="n">extern</span><span class="o">-</span><span class="n">access</span>      <span class="n">Avoid</span> <span class="n">using</span> <span class="n">the</span> <span class="n">GOT</span> <span class="n">to</span> <span class="n">access</span> <span class="n">external</span> <span class="n">symbols</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mdiv32</span>                     <span class="n">Support</span> <span class="n">div</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="ow">and</span> <span class="n">mod</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="n">instructions</span> <span class="k">with</span> <span class="n">inputs</span> <span class="ow">not</span> <span class="n">sign</span><span class="o">-</span><span class="n">extended</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mdouble</span><span class="o">-</span><span class="nb">float</span>              <span class="n">Allow</span> <span class="n">hardware</span> <span class="n">floating</span><span class="o">-</span><span class="n">point</span> <span class="n">instructions</span> <span class="n">to</span> <span class="n">cover</span> <span class="n">both</span> <span class="mi">32</span><span class="o">-</span><span class="n">bit</span> <span class="ow">and</span> <span class="mi">64</span><span class="o">-</span><span class="n">bit</span> <span class="n">operations</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mexplicit</span><span class="o">-</span><span class="n">relocs</span>           <span class="n">Use</span> <span class="o">%</span><span class="n">reloc</span><span class="p">()</span> <span class="n">assembly</span> <span class="n">operators</span> <span class="p">(</span><span class="k">for</span> <span class="n">backward</span> <span class="n">compatibility</span><span class="p">)</span><span class="o">.</span>  <span class="n">Same</span> <span class="k">as</span> <span class="o">-</span><span class="n">mexplicit</span><span class="o">-</span><span class="n">relocs</span><span class="o">=.</span>
  <span class="o">-</span><span class="n">mexplicit</span><span class="o">-</span><span class="n">relocs</span><span class="o">=</span>          <span class="n">Use</span> <span class="o">%</span><span class="n">reloc</span><span class="p">()</span> <span class="n">assembly</span> <span class="n">operators</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mfpu</span><span class="o">=</span><span class="n">FPU</span>                   <span class="n">Generate</span> <span class="n">code</span> <span class="k">for</span> <span class="n">the</span> <span class="n">given</span> <span class="n">FPU</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mfpu</span><span class="o">=</span><span class="mi">0</span>                     <span class="n">Same</span> <span class="k">as</span> <span class="o">-</span><span class="n">mfpu</span><span class="o">=</span><span class="n">none</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mfrecipe</span>                   <span class="n">Support</span> <span class="n">frecipe</span><span class="o">.</span><span class="p">{</span><span class="n">s</span><span class="o">/</span><span class="n">d</span><span class="p">}</span> <span class="ow">and</span> <span class="n">frsqrte</span><span class="o">.</span><span class="p">{</span><span class="n">s</span><span class="o">/</span><span class="n">d</span><span class="p">}</span> <span class="n">instructions</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mfused</span><span class="o">-</span><span class="n">madd</span>                <span class="n">Same</span> <span class="k">as</span> <span class="o">-</span><span class="n">ffp</span><span class="o">-</span><span class="n">contract</span><span class="o">=</span><span class="n">fast</span> <span class="p">(</span><span class="ow">or</span><span class="p">,</span> <span class="ow">in</span> <span class="n">negated</span> <span class="n">form</span><span class="p">,</span> <span class="o">-</span><span class="n">ffp</span><span class="o">-</span><span class="n">contract</span><span class="o">=</span><span class="n">off</span><span class="p">)</span><span class="o">.</span>  <span class="n">Uses</span> <span class="n">of</span> <span class="n">this</span> <span class="n">option</span> <span class="n">are</span>
                              <span class="n">diagnosed</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mglibc</span>                     <span class="n">Use</span> <span class="n">GNU</span> <span class="n">C</span> <span class="n">library</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mlam</span><span class="o">-</span><span class="n">bh</span>                    <span class="n">Support</span> <span class="n">am</span><span class="p">{</span><span class="n">swap</span><span class="o">/</span><span class="n">add</span><span class="p">}[</span><span class="n">_db</span><span class="p">]</span><span class="o">.</span><span class="p">{</span><span class="n">b</span><span class="o">/</span><span class="n">h</span><span class="p">}</span> <span class="n">instructions</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mlamcas</span>                    <span class="n">Support</span> <span class="n">amcas</span><span class="p">[</span><span class="n">_db</span><span class="p">]</span><span class="o">.</span><span class="p">{</span><span class="n">b</span><span class="o">/</span><span class="n">h</span><span class="o">/</span><span class="n">w</span><span class="o">/</span><span class="n">d</span><span class="p">}</span> <span class="n">instructions</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mlasx</span>                      <span class="n">Enable</span> <span class="n">LoongArch</span> <span class="n">Advanced</span> <span class="n">SIMD</span> <span class="n">Extension</span> <span class="p">(</span><span class="n">LASX</span><span class="p">,</span> <span class="mi">256</span><span class="o">-</span><span class="n">bit</span><span class="p">)</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mld</span><span class="o">-</span><span class="n">seq</span><span class="o">-</span><span class="n">sa</span>                 <span class="n">Do</span> <span class="ow">not</span> <span class="n">need</span> <span class="n">load</span><span class="o">-</span><span class="n">load</span> <span class="n">barriers</span> <span class="p">(</span><span class="n">dbar</span> <span class="mh">0x700</span><span class="p">)</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mlsx</span>                       <span class="n">Enable</span> <span class="n">LoongArch</span> <span class="n">SIMD</span> <span class="n">Extension</span> <span class="p">(</span><span class="n">LSX</span><span class="p">,</span> <span class="mi">128</span><span class="o">-</span><span class="n">bit</span><span class="p">)</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mmax</span><span class="o">-</span><span class="n">inline</span><span class="o">-</span><span class="n">memcpy</span><span class="o">-</span><span class="n">size</span><span class="o">=</span><span class="n">SIZE</span> <span class="n">Set</span> <span class="n">the</span> <span class="nb">max</span> <span class="n">size</span> <span class="n">of</span> <span class="n">memcpy</span> <span class="n">to</span> <span class="n">inline</span><span class="p">,</span> <span class="n">default</span> <span class="ow">is</span> <span class="mf">1024.</span>
  <span class="o">-</span><span class="n">mmemcpy</span>                    <span class="n">Prevent</span> <span class="n">optimizing</span> <span class="n">block</span> <span class="n">moves</span><span class="p">,</span> <span class="n">which</span> <span class="ow">is</span> <span class="n">also</span> <span class="n">the</span> <span class="n">default</span> <span class="n">behavior</span> <span class="n">of</span> <span class="o">-</span><span class="n">Os</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mmusl</span>                      <span class="n">Use</span> <span class="n">musl</span> <span class="n">C</span> <span class="n">library</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mrecip</span>                     <span class="n">Generate</span> <span class="n">approximate</span> <span class="n">reciprocal</span> <span class="n">divide</span> <span class="ow">and</span> <span class="n">square</span> <span class="n">root</span> <span class="k">for</span> <span class="n">better</span> <span class="n">throughput</span><span class="o">.</span>  <span class="n">Same</span> <span class="k">as</span> <span class="o">-</span><span class="n">mrecip</span><span class="o">=.</span>
  <span class="o">-</span><span class="n">mrecip</span><span class="o">=</span>                    <span class="n">Control</span> <span class="n">generation</span> <span class="n">of</span> <span class="n">reciprocal</span> <span class="n">estimates</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mrelax</span>                     <span class="n">Take</span> <span class="n">advantage</span> <span class="n">of</span> <span class="n">linker</span> <span class="n">relaxations</span> <span class="n">to</span> <span class="n">reduce</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">instructions</span> <span class="n">required</span> <span class="n">to</span>
                              <span class="n">materialize</span> <span class="n">symbol</span> <span class="n">addresses</span><span class="o">.</span>
  <span class="o">-</span><span class="n">msimd</span><span class="o">=</span><span class="n">SIMD</span>                 <span class="n">Generate</span> <span class="n">code</span> <span class="k">for</span> <span class="n">the</span> <span class="n">given</span> <span class="n">SIMD</span> <span class="n">extension</span><span class="o">.</span>
  <span class="o">-</span><span class="n">msingle</span><span class="o">-</span><span class="nb">float</span>              <span class="n">Restrict</span> <span class="n">the</span> <span class="n">use</span> <span class="n">of</span> <span class="n">hardware</span> <span class="n">floating</span><span class="o">-</span><span class="n">point</span> <span class="n">instructions</span> <span class="n">to</span> <span class="mi">32</span><span class="o">-</span><span class="n">bit</span> <span class="n">operations</span><span class="o">.</span>
  <span class="o">-</span><span class="n">msoft</span><span class="o">-</span><span class="nb">float</span>                <span class="n">Prevent</span> <span class="n">the</span> <span class="n">use</span> <span class="n">of</span> <span class="nb">all</span> <span class="n">hardware</span> <span class="n">floating</span><span class="o">-</span><span class="n">point</span> <span class="n">instructions</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mstrict</span><span class="o">-</span><span class="n">align</span>              <span class="n">Do</span> <span class="ow">not</span> <span class="n">generate</span> <span class="n">unaligned</span> <span class="n">memory</span> <span class="n">accesses</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mtls</span><span class="o">-</span><span class="n">dialect</span><span class="o">=</span>              <span class="n">Specify</span> <span class="n">TLS</span> <span class="n">dialect</span><span class="o">.</span>
  <span class="o">-</span><span class="n">mtune</span><span class="o">=</span><span class="n">PROCESSOR</span>            <span class="n">Generate</span> <span class="n">optimized</span> <span class="n">code</span> <span class="k">for</span> <span class="n">PROCESSOR</span><span class="o">.</span>
  <span class="o">-</span><span class="n">muclibc</span>                    <span class="n">Use</span> <span class="n">uClibc</span> <span class="n">C</span> <span class="n">library</span><span class="o">.</span>

  <span class="n">Base</span> <span class="n">ABI</span> <span class="n">types</span> <span class="k">for</span> <span class="n">LoongArch</span><span class="p">:</span>
    <span class="n">lp64d</span> <span class="n">lp64f</span> <span class="n">lp64s</span>

  <span class="n">LoongArch</span> <span class="n">ARCH</span> <span class="n">presets</span><span class="p">:</span>
    <span class="n">abi</span><span class="o">-</span><span class="n">default</span> <span class="n">la464</span> <span class="n">la64v1</span><span class="mf">.0</span> <span class="n">la64v1</span><span class="mf">.1</span> <span class="n">la664</span> <span class="n">loongarch64</span> <span class="n">native</span>

  <span class="n">The</span> <span class="n">code</span> <span class="n">model</span> <span class="n">option</span> <span class="n">names</span> <span class="k">for</span> <span class="o">-</span><span class="n">mcmodel</span><span class="p">:</span>
    <span class="n">extreme</span> <span class="n">large</span> <span class="n">medium</span> <span class="n">normal</span> <span class="n">tiny</span> <span class="n">tiny</span><span class="o">-</span><span class="n">static</span>

  <span class="n">The</span> <span class="n">code</span> <span class="n">model</span> <span class="n">option</span> <span class="n">names</span> <span class="k">for</span> <span class="o">-</span><span class="n">mexplicit</span><span class="o">-</span><span class="n">relocs</span><span class="p">:</span>
    <span class="n">always</span> <span class="n">auto</span> <span class="n">none</span>

  <span class="n">FPU</span> <span class="n">types</span> <span class="n">of</span> <span class="n">LoongArch</span><span class="p">:</span>
    <span class="mi">32</span> <span class="mi">64</span> <span class="n">none</span>

  <span class="n">SIMD</span> <span class="n">extension</span> <span class="n">levels</span> <span class="n">of</span> <span class="n">LoongArch</span><span class="p">:</span>
    <span class="n">lasx</span> <span class="n">lsx</span> <span class="n">none</span>

  <span class="n">The</span> <span class="n">possible</span> <span class="n">TLS</span> <span class="n">dialects</span><span class="p">:</span>
    <span class="n">desc</span> <span class="n">trad</span>

  <span class="n">LoongArch</span> <span class="n">TUNE</span> <span class="n">presets</span><span class="p">:</span>
    <span class="n">generic</span> <span class="n">la464</span> <span class="n">la664</span> <span class="n">loongarch64</span> <span class="n">native</span>

<span class="n">Assembler</span> <span class="n">options</span>
<span class="o">=================</span>

<span class="n">Use</span> <span class="s2">&quot;-Wa,OPTION&quot;</span> <span class="n">to</span> <span class="k">pass</span> <span class="s2">&quot;OPTION&quot;</span> <span class="n">to</span> <span class="n">the</span> <span class="n">assembler</span><span class="o">.</span>

<span class="n">LARCH</span> <span class="n">options</span><span class="p">:</span>
  <span class="o">-</span><span class="n">mthin</span><span class="o">-</span><span class="n">add</span><span class="o">-</span><span class="n">sub</span>    <span class="n">Convert</span> <span class="n">a</span> <span class="n">pair</span> <span class="n">of</span> <span class="n">R_LARCH_ADD32</span><span class="o">/</span><span class="mi">64</span> <span class="ow">and</span> <span class="n">R_LARCH_SUB32</span><span class="o">/</span><span class="mi">64</span> <span class="n">to</span>
           <span class="n">R_LARCH_32</span><span class="o">/</span><span class="mi">64</span><span class="n">_PCREL</span> <span class="k">as</span> <span class="n">much</span> <span class="k">as</span> <span class="n">possible</span>
           <span class="n">The</span> <span class="n">option</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">affect</span> <span class="n">the</span> <span class="n">generation</span> <span class="n">of</span> <span class="n">R_LARCH_32_PCREL</span>
           <span class="n">relocations</span> <span class="ow">in</span> <span class="o">.</span><span class="n">eh_frame</span>
  <span class="o">-</span><span class="n">mignore</span><span class="o">-</span><span class="n">start</span><span class="o">-</span><span class="n">align</span>    <span class="n">Ignore</span> <span class="o">.</span><span class="n">align</span> <span class="k">if</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">at</span> <span class="n">the</span> <span class="n">start</span> <span class="n">of</span> <span class="n">a</span> <span class="n">section</span><span class="o">.</span> <span class="n">This</span> <span class="n">option</span>
           <span class="n">can</span><span class="s1">&#39;t be used when partial linking (ld -r).</span>

<span class="n">Linker</span> <span class="n">options</span>
<span class="o">==============</span>

<span class="n">Use</span> <span class="s2">&quot;-Wl,OPTION&quot;</span> <span class="n">to</span> <span class="k">pass</span> <span class="s2">&quot;OPTION&quot;</span> <span class="n">to</span> <span class="n">the</span> <span class="n">linker</span><span class="o">.</span>

<span class="n">elf64loongarch</span><span class="p">:</span> 
  <span class="o">-</span><span class="n">z</span> <span class="n">pack</span><span class="o">-</span><span class="n">relative</span><span class="o">-</span><span class="n">relocs</span>     <span class="n">Pack</span> <span class="n">relative</span> <span class="n">relocations</span>
  <span class="o">-</span><span class="n">z</span> <span class="n">nopack</span><span class="o">-</span><span class="n">relative</span><span class="o">-</span><span class="n">relocs</span>   <span class="n">Do</span> <span class="ow">not</span> <span class="n">pack</span> <span class="n">relative</span> <span class="n">relocations</span> <span class="p">(</span><span class="n">default</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="picpie">
<h3><span class="section-number">2.1.5.2. </span>PIC与PIE的区别是什么<a class="headerlink" href="#picpie" title="Link to this heading"></a></h3>
<p>PIC（Position Independent Code，位置无关代码）和PIE（Position Independent Executable，位置无关可执行文件）是两种与内存地址无关的技术，但它们的应用场景和实现方式存在显著差异。以下是两者的核心区别及技术细节：</p>
<hr class="docutils" />
<section id="id24">
<h4><span class="section-number">2.1.5.2.1. </span>定义与核心目标<a class="headerlink" href="#id24" title="Link to this heading"></a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>维度</strong></p></th>
<th class="head"><p><strong>PIC</strong></p></th>
<th class="head"><p><strong>PIE</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>全称</strong></p></td>
<td><p>Position Independent Code</p></td>
<td><p>Position Independent Executable</p></td>
</tr>
<tr class="row-odd"><td><p><strong>核心目标</strong></p></td>
<td><p>生成共享库（<code class="docutils literal notranslate"><span class="pre">.so</span></code>文件），允许多个进程共享同一份代码</p></td>
<td><p>生成可执行文件，使其加载地址随机化以提高安全性</p></td>
</tr>
<tr class="row-even"><td><p><strong>主要应用</strong></p></td>
<td><p>动态链接库（如C/C++的<code class="docutils literal notranslate"><span class="pre">.so</span></code>文件）</p></td>
<td><p>可执行文件（如ELF格式的Linux程序）</p></td>
</tr>
</tbody>
</table>
</section>
<hr class="docutils" />
<section id="id25">
<h4><span class="section-number">2.1.5.2.2. </span>技术实现差异<a class="headerlink" href="#id25" title="Link to this heading"></a></h4>
<section id="id26">
<h5><span class="section-number">2.1.5.2.2.1. </span>1. <strong>代码生成方式</strong><a class="headerlink" href="#id26" title="Link to this heading"></a></h5>
<ul>
<li><p><strong>PIC</strong></p>
<ul class="simple">
<li><p>通过**全局偏移表（GOT）<strong>和</strong>过程链接表（PLT）**实现间接寻址，避免使用绝对地址。</p></li>
<li><p>代码段（<code class="docutils literal notranslate"><span class="pre">.text</span></code>）中的函数调用和全局变量访问通过GOT/PLT间接解析。</p></li>
</ul>
</li>
<li><p><strong>PIE</strong></p>
<ul>
<li><p>在PIC基础上进一步要求<strong>代码段可加载到任意地址</strong>，且必须包含<code class="docutils literal notranslate"><span class="pre">main</span></code>函数。</p></li>
<li><p>与PIC共享GOT/PLT机制，但链接时需通过<code class="docutils literal notranslate"><span class="pre">-pie</span></code>选项强制生成可执行文件。</p></li>
<li><p>示例编译命令：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gcc<span class="w"> </span>-fPIE<span class="w"> </span>-pie<span class="w"> </span>-o<span class="w"> </span>program<span class="w"> </span>program.c
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</section>
<section id="id27">
<h5><span class="section-number">2.1.5.2.2.2. </span><strong>编译与链接选项</strong><a class="headerlink" href="#id27" title="Link to this heading"></a></h5>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>选项</strong></p></th>
<th class="head"><p><strong>PIC</strong></p></th>
<th class="head"><p><strong>PIE</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>编译选项</strong></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">-fPIC</span></code>（生成PIC代码）</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">-fPIE</span></code>（生成PIE代码）</p></td>
</tr>
<tr class="row-odd"><td><p><strong>链接选项</strong></p></td>
<td><p>无需特殊选项</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">-pie</span></code>（生成位置无关可执行文件）</p></td>
</tr>
<tr class="row-even"><td><p><strong>对象文件用途</strong></p></td>
<td><p>可用于共享库或PIE可执行文件</p></td>
<td><p>仅用于PIE可执行文件</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<hr class="docutils" />
<section id="id28">
<h4><span class="section-number">2.1.5.2.3. </span>内存布局与加载机制<a class="headerlink" href="#id28" title="Link to this heading"></a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>维度</strong></p></th>
<th class="head"><p><strong>PIC（共享库）</strong></p></th>
<th class="head"><p><strong>PIE（可执行文件）</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>加载地址</strong></p></td>
<td><p>随机化（ASLR启用时）</p></td>
<td><p>随机化（ASLR启用时）</p></td>
</tr>
<tr class="row-odd"><td><p><strong>代码段属性</strong></p></td>
<td><p>只读（<code class="docutils literal notranslate"><span class="pre">.text</span></code>不可修改）</p></td>
<td><p>可执行（包含<code class="docutils literal notranslate"><span class="pre">main</span></code>函数入口）</p></td>
</tr>
<tr class="row-even"><td><p><strong>数据段共享</strong></p></td>
<td><p>多个进程共享同一份代码段</p></td>
<td><p>每个进程独立数据段</p></td>
</tr>
</tbody>
</table>
</section>
<hr class="docutils" />
<section id="id29">
<h4><span class="section-number">2.1.5.2.4. </span>安全性对比<a class="headerlink" href="#id29" title="Link to this heading"></a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>攻击类型</strong></p></th>
<th class="head"><p><strong>PIC（共享库）</strong></p></th>
<th class="head"><p><strong>PIE（可执行文件）</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>缓冲区溢出</strong></p></td>
<td><p>仅保护共享库代码，不影响主程序</p></td>
<td><p>完全随机化主程序地址，提升防御</p></td>
</tr>
<tr class="row-odd"><td><p><strong>ROP攻击</strong></p></td>
<td><p>依赖GOT/PLT的间接跳转，可能被利用</p></td>
<td><p>ROP链构造难度更高</p></td>
</tr>
<tr class="row-even"><td><p><strong>ASLR支持</strong></p></td>
<td><p>必须启用ASLR才能生效</p></td>
<td><p>必须启用ASLR才能生效</p></td>
</tr>
</tbody>
</table>
</section>
<hr class="docutils" />
<section id="id30">
<h4><span class="section-number">2.1.5.2.5. </span>性能影响<a class="headerlink" href="#id30" title="Link to this heading"></a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>维度</strong></p></th>
<th class="head"><p><strong>PIC</strong></p></th>
<th class="head"><p><strong>PIE</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>间接寻址开销</strong></p></td>
<td><p>较高（需频繁访问GOT/PLT）</p></td>
<td><p>较低（部分优化可减少GOT访问）</p></td>
</tr>
<tr class="row-odd"><td><p><strong>代码体积</strong></p></td>
<td><p>较大（需额外GOT/PLT表）</p></td>
<td><p>较小（与PIC共享优化策略）</p></td>
</tr>
<tr class="row-even"><td><p><strong>启动时间</strong></p></td>
<td><p>无显著影响</p></td>
<td><p>可能因地址随机化增加少量时间</p></td>
</tr>
</tbody>
</table>
</section>
<hr class="docutils" />
<section id="id31">
<h4><span class="section-number">2.1.5.2.6. </span>典型使用场景<a class="headerlink" href="#id31" title="Link to this heading"></a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>场景</strong></p></th>
<th class="head"><p><strong>PIC</strong></p></th>
<th class="head"><p><strong>PIE</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>共享库开发</strong></p></td>
<td><p>必须使用（如<code class="docutils literal notranslate"><span class="pre">.so</span></code>文件）</p></td>
<td><p>不适用</p></td>
</tr>
<tr class="row-odd"><td><p><strong>可执行文件</strong></p></td>
<td><p>可选（非必须）</p></td>
<td><p>必须启用（对抗漏洞攻击）</p></td>
</tr>
<tr class="row-even"><td><p><strong>动态加载</strong></p></td>
<td><p>支持（如<code class="docutils literal notranslate"><span class="pre">dlopen</span></code>加载插件）</p></td>
<td><p>不支持</p></td>
</tr>
</tbody>
</table>
</section>
<hr class="docutils" />
<section id="id32">
<h4><span class="section-number">2.1.5.2.7. </span>特殊注意事项<a class="headerlink" href="#id32" title="Link to this heading"></a></h4>
<ol class="arabic simple">
<li><p><strong>符号导出限制</strong></p>
<ul class="simple">
<li><p>PIC共享库需明确导出符号（通过<code class="docutils literal notranslate"><span class="pre">-export-dynamic</span></code>），而PIE可执行文件默认隐藏符号。</p></li>
</ul>
</li>
<li><p><strong>多模块交互</strong></p>
<ul class="simple">
<li><p>PIC代码可被多个进程共享，但PIE代码每个进程独立加载，内存占用更高。</p></li>
</ul>
</li>
<li><p><strong>编译器兼容性</strong></p>
<ul class="simple">
<li><p>某些架构（如ARM）要求PIC和PIE编译选项必须显式指定，否则默认生成位置相关代码。</p></li>
</ul>
</li>
</ol>
</section>
<hr class="docutils" />
<section id="id33">
<h4><span class="section-number">2.1.5.2.8. </span>总结对比表<a class="headerlink" href="#id33" title="Link to this heading"></a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>特性</strong></p></th>
<th class="head"><p><strong>PIC</strong></p></th>
<th class="head"><p><strong>PIE</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>核心用途</strong></p></td>
<td><p>共享库开发</p></td>
<td><p>可执行文件安全加固</p></td>
</tr>
<tr class="row-odd"><td><p><strong>地址随机化</strong></p></td>
<td><p>依赖ASLR</p></td>
<td><p>强制启用ASLR</p></td>
</tr>
<tr class="row-even"><td><p><strong>代码共享</strong></p></td>
<td><p>多进程共享</p></td>
<td><p>单进程独占</p></td>
</tr>
<tr class="row-odd"><td><p><strong>编译选项</strong></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">-fPIC</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">-fPIE</span> <span class="pre">-pie</span></code></p></td>
</tr>
<tr class="row-even"><td><p><strong>安全等级</strong></p></td>
<td><p>中等（保护库代码）</p></td>
<td><p>高（保护主程序）</p></td>
</tr>
</tbody>
</table>
<p>通过合理选择PIC和PIE，开发者可以在性能、安全性和兼容性之间取得平衡。例如，共享库必须使用PIC，而面向安全的关键程序（如浏览器、数据库）应启用PIE以防御内存攻击。</p>
</section>
</section>
<hr class="docutils" />
<section id="loongarch">
<h3><span class="section-number">2.1.5.3. </span>与LoongArch相关的选项说明<a class="headerlink" href="#loongarch" title="Link to this heading"></a></h3>
<p>下面我们将介绍与LoongArch相关的参数，涉及到GCC编译，但不包括链接阶段。<a class="footnote-reference brackets" href="#gcc-loongarch-options" id="id34" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a></p>
<hr class="docutils" />
<p>-march=arch-type:
为特定的arch-type生成相关的指令代码，</p>
<ul class="simple">
<li><p>native： 由编译器自行检测处理器类型</p></li>
<li><p>loongarch64： 通用的64位LoongArch处理器</p></li>
<li><p>la464：基于LA464的处理器，带有LSX, LASX指令集</p></li>
<li><p>la664：基于LA664的处理器，带有LSX, LASX指令集和LoongArch v1.1所有指令集</p></li>
<li><p>la64v1.0： LoongArch64 ISA 版本 v1.0</p></li>
<li><p>la64v1.1： LoongArch64 ISA 版本 v1.1</p></li>
<li><p>la32v1.0： LoongArch32 ISA 版本 v1.0</p></li>
<li><p>la32rv1.0： LoongArch32 精简 ISA 版本 v1.0</p></li>
</ul>
<hr class="docutils" />
<p>-mtune=tune-type:
为类型tune-type产生特定的优化代码，</p>
<ul class="simple">
<li><p>native： 由编译器自行检测处理器类型</p></li>
<li><p>generic： 通用的LoongArch处理器</p></li>
<li><p>loongarch64： 通用的64位LoongArch处理器</p></li>
<li><p>la464：基于LA464的处理器</p></li>
<li><p>la664：基于LA664的处理器</p></li>
<li><p>loongarch32： 通用的32位LoongArch处理器</p></li>
</ul>
<hr class="docutils" />
<p>-mabi=base-abi-type:
为类型为base-abi-type的调用规约(Calling Convention)产生代码，</p>
<ul class="simple">
<li><p>lp64d： 使用64位通用寄存器，32/64位浮点寄存器传递参数，
数据模型是LP64，指的是int是32位，long int和指针都是64位。</p></li>
<li><p>lp64f： 使用64位通用寄存器，32位浮点寄存器传递参数，
数据模型是LP64，指的是int是32位，long int和指针都是64位。</p></li>
<li><p>lp64s： 使用64位通用寄存器，没有浮点寄存器传递参数，
数据模型是LP64，指的是int是32位，long int和指针都是64位。</p></li>
</ul>
<hr class="docutils" />
<p>-mfpu=fpu-type:
为指定的fpu-type类型产生代码，</p>
<ul class="simple">
<li><p>64： 允许32、64位的浮点操作指令。</p></li>
<li><p>32： 允许32位的浮点操作指令。</p></li>
<li><p>‘none’或者’0’:禁止产生浮点指令。</p></li>
</ul>
<hr class="docutils" />
<p>后续待补充。。。</p>
</section>
<section id="c-c">
<h3><span class="section-number">2.1.5.4. </span>C/C++ 预处理器内嵌的宏定义<a class="headerlink" href="#c-c" title="Link to this heading"></a></h3>
<ol class="arabic simple" start="5">
<li><p>与我们LoongArch相关的定义，比如__longarch_等等，全部收集下
最好能把代码也放出来，或者说是引用也放出来。</p></li>
</ol>
<table class="docutils align-default" id="id37">
<caption><span class="caption-text">与LoongArch相关的C/C++预处理器内嵌的宏定义</span><a class="headerlink" href="#id37" title="Link to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>名称</strong></p></th>
<th class="head"><p><strong>可能的值</strong></p></th>
<th class="head"><p><strong>描述说明</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Albatross</p></td>
<td><p>2.99</p></td>
<td><p>On a stick!</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">__loongarch__</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code></p></td>
<td><p>Defined if the target is LoongArch.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">__loongarch_grlen</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">32</span></code> <code class="docutils literal notranslate"><span class="pre">64</span></code></p></td>
<td><p>Bit-width of general purpose registers.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">__loongarch_frlen</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0</span></code> <code class="docutils literal notranslate"><span class="pre">32</span></code> <code class="docutils literal notranslate"><span class="pre">64</span></code></p></td>
<td><p>Bit-width of floating-point registers (<code class="docutils literal notranslate"><span class="pre">0</span></code> if there is no FPU).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">__loongarch_arch</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;loongarch64&quot;</span></code>  <code class="docutils literal notranslate"><span class="pre">&quot;la464&quot;</span></code> <code class="docutils literal notranslate"><span class="pre">&quot;la664&quot;</span></code> <code class="docutils literal notranslate"><span class="pre">&quot;la64v1.0&quot;</span></code> <code class="docutils literal notranslate"><span class="pre">&quot;la64v1.1&quot;</span></code> <code class="docutils literal notranslate"><span class="pre">&quot;la32v1.0&quot;</span></code> <code class="docutils literal notranslate"><span class="pre">&quot;la32rv1.0&quot;</span></code></p></td>
<td><p>Target ISA preset as specified by <code class="docutils literal notranslate"><span class="pre">-march=</span></code>.
If <code class="docutils literal notranslate"><span class="pre">-march=</span></code> is not present, an implementation-defined default value should be
used. If <code class="docutils literal notranslate"><span class="pre">-march=native</span></code> is enabled (user-specified or the default value),
the result is automatically detected by the compiler.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">__loongarch_tune</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;generic&quot;</span></code> <code class="docutils literal notranslate"><span class="pre">&quot;loongarch64&quot;</span></code> <code class="docutils literal notranslate"><span class="pre">&quot;la464&quot;</span></code> <code class="docutils literal notranslate"><span class="pre">&quot;la664&quot;</span></code> <code class="docutils literal notranslate"><span class="pre">&quot;loongarch32&quot;</span></code></p></td>
<td><p>Processor model as specified by <code class="docutils literal notranslate"><span class="pre">-mtune</span></code> or its default value.
If <code class="docutils literal notranslate"><span class="pre">-mtune=native</span></code> is enabled (either explicitly given or set with
<code class="docutils literal notranslate"><span class="pre">-march=native</span></code>), the result is automatically detected by the compiler.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">__loongarch_lp64</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code> or undefined</p></td>
<td><p>Defined if ABI uses the LP64 data model and 64-bit GPRs for parameter passing.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">__loongarch_ilp32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code> or undefined</p></td>
<td><p>Defined if ABI uses the ILP32 data model and 32-bit GPRs for parameter passing.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">__loongarch_hard_float</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code> or undefined</p></td>
<td><p>Defined if floating-point/extended ABI type is <code class="docutils literal notranslate"><span class="pre">single</span></code> or <code class="docutils literal notranslate"><span class="pre">double</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">__loongarch_soft_float</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code> or undefined</p></td>
<td><p>Defined if floating-point/extended ABI type is <code class="docutils literal notranslate"><span class="pre">soft</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">__loongarch_single_float</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code> or undefined</p></td>
<td><p>Defined if floating-point/extended ABI type is <code class="docutils literal notranslate"><span class="pre">single</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">__loongarch_double_float</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code> or undefined</p></td>
<td><p>Defined if floating-point/extended ABI type is <code class="docutils literal notranslate"><span class="pre">double</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">__loongarch_sx</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code> or undefined</p></td>
<td><p>Defined if the compiler enables the <code class="docutils literal notranslate"><span class="pre">lsx</span></code> ISA extension.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">__loongarch_asx</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code> or undefined</p></td>
<td><p>Defined if the compiler enables the <code class="docutils literal notranslate"><span class="pre">lasx</span></code> ISA extension.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">__loongarch_simd_width</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">128</span></code> <code class="docutils literal notranslate"><span class="pre">256</span></code> or undefined</p></td>
<td><p>The maximum SIMD bit-width enabled by the compiler.
(<code class="docutils literal notranslate"><span class="pre">128</span></code> for <code class="docutils literal notranslate"><span class="pre">lsx</span></code>, and <code class="docutils literal notranslate"><span class="pre">256</span></code> for <code class="docutils literal notranslate"><span class="pre">lasx</span></code>)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">__loongarch_frecipe</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code> or undefined</p></td>
<td><p>Defined if <code class="docutils literal notranslate"><span class="pre">-mfrecipe</span></code> is enabled.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">__loongarch_div32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code> or undefined</p></td>
<td><p>Defined if <code class="docutils literal notranslate"><span class="pre">-mdiv32</span></code> is enabled.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">__loongarch_lam_bh</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code> or undefined</p></td>
<td><p>Defined if <code class="docutils literal notranslate"><span class="pre">-mlam-bh</span></code> is enabled.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">__loongarch_lamcas</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code> or undefined</p></td>
<td><p>Defined if <code class="docutils literal notranslate"><span class="pre">-mlamcas</span></code> is enabled.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">__loongarch_ld_seq_sa</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code> or undefined</p></td>
<td><p>Defined if <code class="docutils literal notranslate"><span class="pre">-mld-seq-sa</span></code> is enabled.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">__loongarch_version_major</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code> or undefined</p></td>
<td><p>The minimally required LoongArch ISA version (major) to run the compiled program.
Undefined if no such version is known to the compiler.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">__loongarch_version_minor</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0</span></code> <code class="docutils literal notranslate"><span class="pre">1</span></code> or undefined</p></td>
<td><p>The minimally required LoongArch ISA version (minor) to run the compiled program.
Undefined if and only if <code class="docutils literal notranslate"><span class="pre">__loongarch_version_major</span></code> is undefined.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="gnu-gcc" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">1</a><span class="fn-bracket">]</span></span>
<p>具体可查看<a class="reference external" href="https://gcc.gnu.org/">官网:https://gcc.gnu.org/</a></p>
</aside>
<aside class="footnote brackets" id="osdev-gcc" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id10">2</a><span class="fn-bracket">]</span></span>
<p>具体可参考<a class="reference external" href="https://wiki.osdev.org/Target_Triplet">Target Triplet</a></p>
</aside>
<aside class="footnote brackets" id="gcc-target-none" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id11">3</a><span class="fn-bracket">]</span></span>
<p>目前在LoongArch平台使用较少，后续会增加此类组合。</p>
</aside>
<aside class="footnote brackets" id="gcc-loongarch-options" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id34">4</a><span class="fn-bracket">]</span></span>
<p>https://gcc.gnu.org/onlinedocs/gcc/LoongArch-Options.html</p>
</aside>
</aside>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
    <a href="index.html" class="btn btn-neutral float-left" title="2. 工具链" accesskey="p"
      rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
    <a href="binutils.html" class="btn btn-neutral float-right" title="2.2. Binutils" accesskey="n"
      rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>

  <hr />

  <div role="contentinfo">
    <p>&#169; 版权所有 2022-2026, 龙芯中科技术有限公司。
      <span class="lastupdated">最后更新于 2026年2月10日 11:15:08.
      </span>

      <!-- 
      <span class="footer-aside">
        <a href="../../龙芯实验室文档.pdf" class="fa fa-file-pdf-o">&nbsp下载 PDF</a>
      </span>
       -->
    </p>
  </div> 

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>